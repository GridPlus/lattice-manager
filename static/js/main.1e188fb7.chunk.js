(this["webpackJsonplattice-manager"]=this["webpackJsonplattice-manager"]||[]).push([[0],{13:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"constants",(function(){return c})),n.d(t,"fetchBtcUtxos",(function(){return j})),n.d(t,"fetchBtcTxs",(function(){return p})),n.d(t,"fetchBtcPrice",(function(){return v})),n.d(t,"broadcastBtcTx",(function(){return g})),n.d(t,"harden",(function(){return O})),n.d(t,"getBtcPurpose",(function(){return y})),n.d(t,"getBtcNumTxBytes",(function(){return T})),n.d(t,"buildBtcTxReq",(function(){return _})),n.d(t,"validateBtcAddr",(function(){return S})),n.d(t,"toHexStr",(function(){return E})),n.d(t,"filterUniqueObjects",(function(){return C}));var s=n(37),i=n(397),r=n(428).bech32,a=2147483648,c={DEFAULT_APP_NAME:"Lattice Manager",ENV:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"0.5.1",REACT_APP_NAME:"lattice-manager"}).REACT_APP_ENV||"prod",BASE_SIGNING_URL:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"0.5.1",REACT_APP_NAME:"lattice-manager"}).REACT_APP_BASE_SIGNING_URL||"https://signing.gridpl.us",BTC_PROD_DATA_API:"https://blockchain.info",BTC_BROADCAST_ENDPOINT:"https://blockstream.info/api/tx",HARDENED_OFFSET:a,ASYNC_SDK_TIMEOUT:6e4,ADDRESSES_PER_PAGE:10,ADDRESS_RECORD_TYPE:0,CONTRACTS_PER_PAGE:10,SHORT_TIMEOUT:3e4,BTC_COIN:parseInt(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"0.5.1",REACT_APP_NAME:"lattice-manager"}).REACT_APP_BTC_COIN)||a,SATS_TO_BTC:Math.pow(10,8),BTC_MAIN_GAP_LIMIT:20,BTC_CHANGE_GAP_LIMIT:1,BTC_ADDR_BLOCK_LEN:10,BTC_CHANGE_ADDR_BLOCK_LEN:1,BTC_DEFAULT_FEE_RATE:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"0.5.1",REACT_APP_NAME:"lattice-manager"}).REACT_APP_BTC_DEFAULT_FEE_RATE||10,BTC_TX_BASE_URL:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"0.5.1",REACT_APP_NAME:"lattice-manager"}).REACT_APP_BTC_TX_BASE_URL||"https://www.blockchain.com/btc/tx",PAGE_SIZE:20,CONTRACT_PAGE_SIZE:6,LOST_PAIRING_ERR:"NOT_PAIRED",LOST_PAIRING_MSG:"Cannot find Lattice connection. Please re-connect.",BTC_TESTNET:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"0.5.1",REACT_APP_NAME:"lattice-manager"}).REACT_APP_BTC_TESTNET||null,KEYRING_LOGOUT_MS:parseInt(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"0.5.1",REACT_APP_NAME:"lattice-manager"}).KEYRING_LOGOUT_MS)||2592e6,KEYRING_DATA_PATH:"gridplus_web_wallet_keyring_logins",ABI_PACK_URL:"https://gridplus.github.io/abi-pack-framework",LATTICE_CERT_SIGNER:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"0.5.1",REACT_APP_NAME:"lattice-manager"}).REACT_APP_LATTICE_CERT_SIGNER||"0477816e8e83bb17c4309cc2e5aa134c573a5943154940095a423149f7cc0384ad52d33f1b4cd89c967bf211c039202df3a7899cb7543de4738c96a81cfde4b117",CONTRACTS_HELP_LINK:"https://docs.gridplus.io/gridplus-web-wallet/use-ethereum-smart-contract-abi-function-definitions",TAGS_HELP_LINK:"https://docs.gridplus.io/gridplus-web-wallet/address-tags",PERMISSIONS_HELP_LINK:"https://docs.gridplus.io/gridplus-web-wallet/how-to-set-and-use-spending-limits",POAP_CLAIM_REMOTE_URL:"https://us-central1-lattice-poap.cloudfunctions.net/validate",BTC_WALLET_STORAGE_KEY:"btc_wallet",BTC_PURPOSE_NONE:-1,BTC_PURPOSE_NONE_STR:"Hide BTC Wallet",BTC_PURPOSE_LEGACY:2147483692,BTC_PURPOSE_LEGACY_STR:"Legacy (1)",BTC_PURPOSE_WRAPPED_SEGWIT:2147483697,BTC_PURPOSE_WRAPPED_SEGWIT_STR:"Wrapped Segwit (3)",BTC_PURPOSE_SEGWIT:2147483732,BTC_PURPOSE_SEGWIT_STR:"Segwit (bc1)",BTC_SEGWIT_NATIVE_V0_PREFIX:"bc",BTC_LEGACY_VERSION:0,BTC_WRAPPED_SEGWIT_VERSION:5,RATE_LIMIT:2e3,THROTTLE_RATE_LIMIT:5e3,GET_ABI_URL:"https://api.etherscan.io/api?module=contract&action=getabi&address=",DEFAULT_CONTRACT_NETWORK:"ethereum",CONTRACT_NETWORKS:{ethereum:{label:"Ethereum",url:"https://etherscan.io",baseUrl:"https://api.etherscan.io",apiRoute:"api?module=contract&action=getabi&address="},arbitrum:{label:"Arbitrum",url:"https://arbiscan.io",baseUrl:"https://api.arbiscan.io",apiRoute:"api?module=contract&action=getabi&address="},polygon:{label:"Polygon",url:"https://polygonscan.com",baseUrl:"https://api.polygonscan.com",apiRoute:"api?module=contract&action=getabi&address="},optimism:{label:"Optimism",url:"https://optimistic.etherscan.io",baseUrl:"https://api-optimistic.etherscan.io",apiRoute:"api?module=contract&action=getabi&address="},binance:{label:"Binance",url:"https://bscscan.com/",baseUrl:"https://api.bscscan.com",apiRoute:"api?module=contract&action=getabi&address="},avalanche:{label:"Avalanche",url:"https://snowtrace.io",baseUrl:"https://api.snowtrace.io",apiRoute:"api?module=contract&action=getabi&address="}},PAGE_KEYS:{LANDING:"LANDING",ADDRESS_TAGS:"ADDRESS_TAGS:",SETTINGS:"SETTINGS",WALLET:"WALLET",SEND:"SEND",RECEIVE:"RECEIVE"}};function o(e,t,n){fetch(e,t).then((function(e){return e.json()})).then((function(e){return n(null,e)})).catch((function(e){return n(e)}))}var l=function(e){return new Promise((function(t){return setTimeout(t,e)}))};var d=function(e,t){var n=Promise.resolve();return function(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];var a=n.then((function(){return e.apply(void 0,i)}));return n=n.then((function(){return l(t)})),a}}(o,c.THROTTLE_RATE_LIMIT);function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(0===e.length)return t(null,n);for(var i=20,r=50,a=e.slice(0,i),l="".concat(c.BTC_PROD_DATA_API,"/unspent?active="),d=0;d<a.length;d++)l=0===d?"".concat(l).concat(a[d]):"".concat(l,"|").concat(a[d]);l="".concat(l,"&limit=").concat(r,"&confirmations=1"),s>0&&(l="".concat(l,"&offset=").concat(s)),o(l,null,(function(a,o){return a?t(a):(o.unspent_outputs.forEach((function(e){e.confirmations>0&&n.push({id:e.tx_hash_big_endian,vout:e.tx_output_n,value:e.value,address:m(e.script)})})),o.unspent_outputs.length>=r?setTimeout((function(){u(e,t,n,s+r)}),c.RATE_LIMIT):(e=e.slice(i),void setTimeout((function(){u(e,t,n,0)}),c.RATE_LIMIT)))}))}function h(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=e.pop(),i="".concat(c.BTC_DEV_DATA_API,"/address/").concat(s,"/utxo");o(i,null,(function(i,r){return i?t(i):(r.forEach((function(e){e.status.confirmed&&n.push({id:e.txid,vout:e.vout,value:e.value,address:s})})),0===e.length?t(null,n):void setTimeout((function(){h(e,t,n)}),c.RATE_LIMIT))}))}function j(e,t){if(!e)return t("Cannot fetch UTXOs - bad input");if(e.length<1)return t(null,[]);var n=JSON.parse(JSON.stringify(e));(c.BTC_DEV_DATA_API?h:u)(n,t)}function b(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(0===e.length)return n(null,t);var r="".concat(c.BTC_PROD_DATA_API,"/multiaddr?active="),a=o,l=i&&1===e.length;l&&(r="".concat(c.BTC_PROD_DATA_API,"/rawaddr/"));for(var u=20,h=50,j=e.slice(0,u),f=0;f<j.length;f++)r=0===f?"".concat(r).concat(j[f]):"".concat(r,"|").concat(j[f]);l?(r="".concat(r,"?limit=").concat(h),a=d):r="".concat(r,"&n=").concat(h),s>0&&(r="".concat(r,"&offset=").concat(s)),a(r,null,(function(i,r){if(i)return n(i);var a=0;if(r.txs.forEach((function(e){var n={timestamp:1e3*e.time,confirmed:!!e.block_index,id:e.hash,fee:e.fee,inputs:[],outputs:[]};e.inputs.forEach((function(e){n.inputs.push({addr:e.prev_out.addr,value:e.prev_out.value})})),e.out.forEach((function(e){n.outputs.push({addr:e.addr,value:e.value})})),n.confirmed||(n.timestamp=-1),t.every((function(e){return e.id!==n.id}))&&(t.push(n),a+=1)})),a>=h)return setTimeout((function(){b(e,t,n,s+h,!1)}),c.RATE_LIMIT);e=e.slice(u),setTimeout((function(){b(e,t,n,0,!1)}),c.RATE_LIMIT)}))}function f(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=e.pop(),r="".concat(c.BTC_DEV_DATA_API,"/address/").concat(i,"/txs");s&&(r="".concat(r,"/chain/").concat(s)),o(r,null,(function(s,r){if(s)return n(s);var a=[],o=0;return r.forEach((function(e){var t={timestamp:1e3*e.status.block_time,confirmed:e.status.confirmed,id:e.txid,fee:e.fee,inputs:[],outputs:[]};e.vin.forEach((function(e){t.inputs.push({addr:e.prevout.scriptpubkey_address,value:e.prevout.value})})),e.vout.forEach((function(e){t.outputs.push({addr:e.scriptpubkey_address,value:e.value})})),t.confirmed||(t.timestamp=-1),a.push(t),t.confirmed&&(o+=1)})),t=t.concat(a),o>=25?(e.push(i),f(e,t,n,t[o-1].id)):0===e.length?n(null,t):void setTimeout((function(){f(e,t,n)}),c.RATE_LIMIT)}))}function p(e,t,n){if(!e)return n("Cannot fetch transactions - bad input");if(e.length<1)return n(null,[]);var s=JSON.parse(JSON.stringify(e));(c.BTC_DEV_DATA_API?f:b)(s,t,n)}function v(e){o("https://api.blockchain.com/v3/exchange/tickers/BTC-USD",null,(function(t,n){return t?e(t):n&&n.last_trade_price?e(null,n.last_trade_price):e("Invalid price data returned")}))}function g(e,t){var n={method:"POST",body:e};fetch(c.BTC_BROADCAST_ENDPOINT,n).then((function(e){return e.text()})).then((function(e){return t(null,e)})).catch((function(e){return t(e)}))}function O(e){return e+a}function x(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(s>=e.length)return-1;i+=e[s].value;var r=s+1,a=T(r),c=Math.floor(n*a);return i>=t+c?r:x(e,t,n,s=r,i)}function m(t){var n=y();if(n===c.BTC_PURPOSE_SEGWIT){var s=c.BTC_SEGWIT_NATIVE_V0_PREFIX,a=e.from(t,"hex").slice(-20),o=r.toWords(a);return o.unshift(0),r.encode(s,o)}if(n===c.BTC_PURPOSE_WRAPPED_SEGWIT){var l=c.BTC_WRAPPED_SEGWIT_VERSION,d=e.from(t,"hex").slice(2,22);return i.encode(e.concat([e.from([l]),d]))}if(n===c.BTC_PURPOSE_LEGACY){var u=c.BTC_LEGACY_VERSION,h=e.from(t,"hex").slice(3,23);return i.encode(e.concat([e.from([u]),h]))}}function y(){var e=s.a.getSettings();return e.btcPurpose?e.btcPurpose:c.BTC_PURPOSE_NONE}function T(e){var t,n,s,i=y();i===c.BTC_PURPOSE_LEGACY?(t=148,n=32,s=0):i===c.BTC_PURPOSE_SEGWIT?(t=91,n=32,s=107):(t=67.75,n=31,s=107);var r=i===c.BTC_PURPOSE_LEGACY?0:.75;return 3*r+(10+r+t*e+2*n)+s*e}function _(e,t,n,s,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:c.BTC_DEFAULT_FEE_RATE,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!s||!i||s.length<1||i.length<1)return{error:"No addresses (or change addresses). Please wait to sync."};var o=Math.round(Number(t)*c.SATS_TO_BTC),l=a?n.length:x(n,o,r);if(l<0)return{error:"Balance too low."};if(l>n.length)return{error:"Failed to build transaction."};for(var d=T(l),u=Math.floor(d*r),h=[y(),c.BTC_COIN,c.HARDENED_OFFSET],j=[],b=0;b<l;b++){var f=n[b],p=null;if(s.indexOf(f.address)>-1)p=h.concat([0,s.indexOf(f.address)]);else{if(!(i.indexOf(f.address)>-1))return{error:"Failed to find holder of UTXO. Syncing issue likely."};p=h.concat([1,i.indexOf(f.address)])}var v={txHash:f.id,value:f.value,index:f.vout,signerPath:p};j.push(v)}var g={prevOuts:j,recipient:e,value:o,fee:u,changePath:h.concat([1,i.length-1])};return{currency:"BTC",data:g}}function S(e){if(""===e)return null;try{return i.decode(e),!0}catch(t){try{return r.decode(e),!0}catch(t){return!1}}}function E(e){var t=e.toString(16),n=t.length%2===0?t:"0".concat(t);return"0x".concat(n)}function C(e,t){var n=[];return JSON.parse(JSON.stringify(e)).reverse().forEach((function(e){var s=!1;n.forEach((function(n){var i=0;t.forEach((function(t){n[t]===e[t]&&(i+=1)})),i>=t.length&&(s=!0)})),s||n.push(e)})),n.reverse()}}.call(this,n(58).Buffer)},151:function(e,t,n){},238:function(e,t,n){"use strict";(function(e){var s=n(10),i=n(11),r=n(21),a=n(16),c=n(17),o=n(0),l=n.n(o),d=(n(57),n(151),n(129)),u=n(103),h=n(48),j=n(84),b=n(507),f=n(509),p=n(510),v=n(511),g=n(512),O=n(513),x=n(514),m=n(515),y=n(516),T=n(237),_=n(517),S=n(236),E=n(313),C=n(54),A=n(13),P=n(37),k=n(42),B=n(4),R=d.a.Content,w=d.a.Footer,I=d.a.Sider,N="loginCache",L=A.constants.PAGE_KEYS,D=L.LANDING,M=function(t){Object(a.a)(o,t);var n=Object(c.a)(o);function o(e){var t;Object(s.a)(this,o),(t=n.call(this,e)).context=t.context;var i=new URLSearchParams(window.location.search).get("keyring");return t.state={name:A.constants.DEFAULT_APP_NAME,menuItem:D,session:null,collapsed:!1,error:{msg:null,cb:null},loading:!1,pendingMsg:null,waiting:!1,onCancel:null,deviceID:null,password:null,lastUpdated:new Date,windowWidth:window.innerWidth,walletIsExternal:null,keyringName:i,openedByKeyring:!!i,hwCheck:null},t.handleMenuChange=t.handleMenuChange.bind(Object(r.a)(t)),t.handleLogout=t.handleLogout.bind(Object(r.a)(t)),t.handleKeyringOpener=t.handleKeyringOpener.bind(Object(r.a)(t)),t.syncActiveWalletState=t.syncActiveWalletState.bind(Object(r.a)(t)),t.cancelConnect=t.cancelConnect.bind(Object(r.a)(t)),t.connectSession=t.connectSession.bind(Object(r.a)(t)),t.handlePair=t.handlePair.bind(Object(r.a)(t)),t.fetchBtcData=t.fetchBtcData.bind(Object(r.a)(t)),t.setError=t.setError.bind(Object(r.a)(t)),t.refreshWallets=t.refreshWallets.bind(Object(r.a)(t)),t.handlePageTurn=t.handlePageTurn.bind(Object(r.a)(t)),t.retry=t.retry.bind(Object(r.a)(t)),t.updateWidth=t.updateWidth.bind(Object(r.a)(t)),t}return Object(i.a)(o,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.updateWidth),this.isMobile()&&this.setState({collapsed:!0});var t=new URLSearchParams(window.location.search),n=this.state.keyringName,s=t.get("hwCheck"),i=t.get("forceLogin");if(t.get(N))this.setState({waiting:!0,pendingMsg:"Connecting..."});else if(n)window.onload=this.handleKeyringOpener(),this.setState({keyringName:n},(function(){var t=P.a.getKeyringItem(n),s=(new Date).getTime()-A.constants.KEYRING_LOGOUT_MS;!i&&t&&t.lastLogin>s?e.connect(t.deviceID,t.password,(function(){return e.connectSession(t)})):P.a.removeKeyringItem(n)}));else if(s)this.setState({hwCheck:s});else{var r=P.a.getLogin(),a=r.deviceID,c=r.password;a&&c&&this.connect(a,c,(function(){return e.connectSession()}))}}},{key:"componentDidUpdate",value:function(){this.context.session&&this.syncActiveWalletState()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWidth)}},{key:"updateWidth",value:function(){this.setState({windowWidth:window.innerWidth}),this.isMobile()&&!this.state.collapsed?this.setState({collapsed:!0}):!this.isMobile()&&this.state.collapsed&&this.setState({collapsed:!1})}},{key:"isMobile",value:function(){return this.context.isMobile}},{key:"connect",value:function(e,t,n){var s={deviceID:e,password:t},i=this.state.keyringName?this.state.keyringName:this.state.name;if(!this.context.session){var r=P.a.getSettings();this.context.setSession(new E.a(e,this.setError,i,r))}this.setState(s,n)}},{key:"cancelConnect",value:function(){this.context.session&&this.context.session.client&&this.context.session.client.pair("",(function(){})),this.setState({deviceID:null,password:null,session:null}),this.unwait()}},{key:"isConnected",value:function(){return!!this.context.session&&this.context.session.isConnected()}},{key:"handleKeyringOpener",value:function(){this.setState({openedByKeyring:!0})}},{key:"returnKeyringData",value:function(){if(this.state.openedByKeyring){P.a.setKeyringItem(this.state.keyringName,{deviceID:this.state.deviceID,password:this.state.password,lastLogin:(new Date).getTime()});var t={deviceID:this.state.deviceID,password:this.state.password,endpoint:A.constants.BASE_SIGNING_URL},n=P.a.getSettings();if(n.customEndpoint&&""!==n.customEndpoint&&(t.endpoint=n.customEndpoint),this.handleLogout(),window.opener)window.opener.postMessage(JSON.stringify(t),"*"),window.close();else{var s=e.from(JSON.stringify(t)).toString("base64");window.location.href="".concat(window.location.href,"&").concat(N,"=").concat(s)}}}},{key:"wait",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.setState({pendingMsg:e,waiting:!0,onCancel:t})}},{key:"unwait",value:function(){this.setState({pendingMsg:null,waiting:!1,onCancel:null})}},{key:"handlePageTurn",value:function(e){this.context.session.setPage(e)}},{key:"handleMenuChange",value:function(e){var t={menuItem:e.key};this.isMobile()&&(t.collapsed=!0),this.setState(t)}},{key:"handleLogout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.unwait(),this.context.session.disconnect(),this.setState({session:null}),P.a.removeLogin(),P.a.removeAddresses(),e&&e===A.constants.LOST_PAIRING_MSG&&this.setError({err:e})}},{key:"setError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{msg:null,cb:null};if(e.msg===A.constants.LOST_PAIRING_ERR)return this.handleLostPairing();this.setState({error:e,loading:!1})}},{key:"connectSession",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=t.deviceID,i=t.password;if(!s||!i)return this.setError({msg:"You must provide a deviceID and password. Please refresh and log in again. "});this.setError(),this.connect(s,i,(function(){!0===n&&e.wait("Looking for your Lattice",e.cancelConnect),e.context.session.connect(s,i).then((function(t){if(e.unwait(),e.context.session&&e.state.deviceID===s)return e.state.openedByKeyring||P.a.setLogin({deviceID:s,password:i}),e.setError(),t&&e.state.openedByKeyring?e.returnKeyringData():void 0})).catch((function(n){e.setError({msg:n.message,cb:function(){e.connectSession(t)}})}))}))}},{key:"fetchBtcData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.unwait(),this.setError(),this.wait("Fetching addresses"),this.context.session.fetchBtcAddresses((function(n,s){if(n)return console.error("Error fetching BTC addresses",n),e.unwait(),void e.setError({msg:"Failed to fetch BTC addresses. Please try again.",cb:e.fetchBtcData});if(e.unwait(),!(t&&0===s.regular&&0===s.change)){t||e.context.session.clearUtxos(),e.wait("Syncing chain data");var i=t?s:null;e.context.session.fetchBtcStateData(i,(function(t){if(t)return console.error("Error fetching BTC state data",t),e.unwait(),void e.setError({msg:"Failed to fetch BTC state data. Please try again.",cb:e.fetchBtcData});e.fetchBtcData(!0)}))}}))}},{key:"handleLostPairing",value:function(){var e=this;this.context.session.client.pair("x",(function(){e.handleLogout(A.constants.LOST_PAIRING_MSG)}))}},{key:"refreshWallets",value:function(){var e=this;!0!==this.state.waiting&&(this.wait("Refreshing wallets"),this.setState({waiting:!0}),this.context.session.refreshWallets((function(t){return t===A.constants.LOST_PAIRING_ERR?e.handleLostPairing():(e.syncActiveWalletState(!0),e.unwait(),t?e.setError({msg:t,cb:e.refreshWallets}):(e.setError(),void(A.constants.BTC_PURPOSE_NONE!==Object(A.getBtcPurpose)()&&e.fetchBtcData())))})))}},{key:"syncActiveWalletState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.context.session.getActiveWallet();if(t){var n=t.external;if(this.state.walletIsExternal!==n){var s=null!==this.state.walletIsExternal;this.setState({walletIsExternal:n}),!0===s&&!0!==e&&this.refreshWallets()}}}},{key:"handlePair",value:function(e){var t=this;"_"!==e[0]&&"["!==e[0]||(e=e.slice(1)),this.wait("Establishing connection with your Lattice"),this.context.session.client.pair(e).then((function(){t.unwait(),t.state.openedByKeyring&&t.returnKeyringData()})).catch((function(e){t.setError({msg:"Failed to pair. You either entered the wrong code or have already connected to this app.",cb:t.connectSession})}))}},{key:"renderMenu",value:function(){var e=A.constants.BTC_PURPOSE_NONE===Object(A.getBtcPurpose)();return Object(B.jsx)(I,{collapsed:this.state.collapsed,collapsedWidth:0,children:Object(B.jsx)(u.a,{theme:"dark",mode:"inline",onSelect:this.handleMenuChange,items:function(){var t=[{key:L.LANDING,label:"Home",icon:Object(B.jsx)(p.a,{})},{key:L.ADDRESS_TAGS,label:"Address Tags",icon:Object(B.jsx)(v.a,{})},{key:L.SETTINGS,label:"Settings",icon:Object(B.jsx)(g.a,{})}];return e||t.push({key:"submenu-wallet",label:"BTC Wallet",children:[{key:L.WALLET,label:"History",icon:Object(B.jsx)(O.a,{})},{key:L.SEND,label:"Send",icon:Object(B.jsx)(x.a,{})},{key:L.RECEIVE,label:"Receive",icon:Object(B.jsx)(m.a,{})}]}),t}(),selectedKeys:[this.state.menuItem]})})}},{key:"renderSidebar",value:function(){if(this.state.name===A.constants.DEFAULT_APP_NAME)return this.isConnected()?this.renderMenu():void 0}},{key:"renderHeaderText",value:function(){var e=this;return Object(B.jsxs)(B.Fragment,{children:[this.isMobile()?Object(B.jsx)(h.a,{onClick:function(){return e.setState({collapsed:!e.state.collapsed})},type:"text",size:"large",icon:Object(B.jsx)(y.a,{}),style:{backgroundColor:"transparent",marginRight:"5px"}}):null,Object(B.jsx)("a",{className:"lattice-a",href:"https://gridplus.io",target:"_blank",rel:"noopener noreferrer",children:Object(B.jsx)("img",{alt:"GridPlus",src:"/gridplus-logo.png",style:{height:"3em"}})})]})}},{key:"renderHeader",value:function(){if(this.state.name===A.constants.DEFAULT_APP_NAME){var e=[];if(this.isConnected()){var t=null,n=this.isMobile()?"small":"middle",s=this.context.session.getActiveWallet();return(t=s?!0===s.external?Object(B.jsxs)(h.a,{type:"primary",ghost:!0,onClick:this.refreshWallets,size:n,children:[Object(B.jsx)(_.a,{})," SafeCard ",Object(B.jsx)(T.a,{})]}):Object(B.jsxs)(h.a,{type:"default",ghost:!0,onClick:this.refreshWallets,size:n,children:[Object(B.jsx)(S.a,{})," Lattice ",Object(B.jsx)(T.a,{})]}):Object(B.jsxs)(h.a,{type:"danger",ghost:!0,onClick:this.refreshWallets,size:n,children:["No Wallet ",Object(B.jsx)(T.a,{})]}))&&e.push(Object(B.jsx)(j.a,{title:"Refresh",children:t},"WalletTagTooltip")),e.push(Object(B.jsx)(h.a,{type:"primary",onClick:this.handleLogout,size:n,children:"Logout"},"logout-button")),Object(B.jsx)(b.a,{title:this.renderHeaderText(),ghost:!0,extra:this.state.waiting?null:e})}}}},{key:"renderErrorHeader",value:function(){if(this.state.error.msg){var e=Object(B.jsx)(C.c,{msg:this.state.error.msg,retryCb:this.state.error.cb});return Object(B.jsx)(C.g,{content:e})}}},{key:"retry",value:function(e){return this.setError(),e()}},{key:"renderPage",value:function(){var e=this;switch(this.state.menuItem){case L.WALLET:return Object(B.jsx)(C.m,{session:this.context.session,refreshData:this.fetchBtcData,lastUpdated:this.state.lastUpdated,pageTurnCb:this.handlePageTurn});case L.RECEIVE:return Object(B.jsx)(C.i,{session:this.context.session});case L.SEND:return Object(B.jsx)(C.j,{session:this.context.session});case L.SETTINGS:return Object(B.jsx)(C.k,{});case L.ADDRESS_TAGS:return Object(B.jsx)(C.a,{});case D:return Object(B.jsx)(C.d,{goToPage:function(t){return e.handleMenuChange({key:t})}});default:return}}},{key:"renderContent",value:function(){var e=this,t=!!this.context.session&&null!==this.context.session.getActiveWallet();if(this.state.waiting)return Object(B.jsx)(C.e,{msg:this.state.pendingMsg,onCancel:this.state.onCancel});if(this.isConnected()){if(this.context.session.isPaired()){if(this.state.openedByKeyring)return Object(B.jsx)(C.e,{msg:"Successfully connected to your Lattice! You may close this window.",spin:!1});if(t)return this.renderPage();var n=this.context.session?this.refreshWallets:null;return Object(B.jsx)(C.c,{msg:"No active wallet present for device!",retryCb:n})}return Object(B.jsx)(C.h,{submit:this.handlePair,hide:!!this.state.error.msg})}return Object(B.jsx)(C.b,{submitCb:this.connectSession,cancelConnect:this.cancelConnect,name:this.state.name,keyringName:this.state.keyringName,setKeyringName:function(t){return e.setState({keyringName:t})},errMsg:this.state.error.msg})}},{key:"renderFooter",value:function(){return Object(B.jsxs)(w,{style:{textAlign:"center",color:"#969696"},children:["\xa9 ",(new Date).getFullYear()," GridPlus, Inc. \xa0\xa0 | \xa0\xa0 v","0.5.1","dev"===A.constants.ENV?Object(B.jsx)(f.a,{color:"blue",style:{margin:"0 0 0 10px"},children:"DEV"}):null]})}},{key:"renderPageContainer",value:function(){return null!==this.state.hwCheck?Object(B.jsx)(C.l,{data:this.state.hwCheck}):this.renderContent()}},{key:"render",value:function(){return Object(B.jsxs)(d.a,{style:{minHeight:"100vh"},children:[this.renderHeader(),Object(B.jsxs)(d.a,{id:"main-content-outer",children:[this.renderSidebar(),Object(B.jsxs)(d.a,{id:"main-content-inner",children:[Object(B.jsxs)(R,{style:{margin:"0 0 0 0"},children:[this.renderErrorHeader(),Object(B.jsx)("div",{children:this.renderPageContainer()})]}),this.renderFooter()]})]})]})}}]),o}(l.a.Component);M.contextType=k.a,t.a=M}).call(this,n(58).Buffer)},287:function(e,t,n){"use strict";(function(e){var s=n(10),i=n(11),r=n(16),a=n(17),c=n(0),o=n.n(c),l=(n(57),n(508)),d=n(504),u=n(506),h=n(319),j=n(48),b=n(141),f=n(13),p=n(42),v=n(4),g=n(276).default,O=n(480).ec,x=function(t){Object(r.a)(c,t);var n=Object(a.a)(c);function c(e){var t;return Object(s.a)(this,c),(t=n.call(this,e)).context=t.context,t.isLoading=void 0,t.poapToClaim=void 0,t.isValid=void 0,t.message=void 0,t.state={isLoading:!1,poapToClaim:"",isValid:"",message:""},t}return Object(i.a)(c,[{key:"componentDidMount",value:function(){this.setState({isValid:this.validateSig()}),this.setState({message:this.getMessageForPoap()})}},{key:"getMessageForPoap",value:function(){return this.getPreimage().toLocaleLowerCase().replace(/[^|x00-\x7F]/g,"")}},{key:"shouldShowClaimCard",value:function(){return this.state.isValid&&("poap"===this.state.message||"poop"===this.state.message)}},{key:"_validate",value:function(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"secp256k1",i=new g,r=new O(s),a=i.createHash("sha256").update(e).digest(),c=r.keyFromPublic(t,"hex");return c.verify(a,n)}},{key:"getPreimage",value:function(){return Object(b.decode)(this.props.data).slice(0,32).toString()}},{key:"getCert",value:function(){var t=Object(b.decode)(this.props.data).slice(106,253),n=t.slice(2,73),s=e.from(t.slice(8,73)).toString("hex"),i=e.from(t.slice(73,147));return{pubkey:s,preimage:n,sig:i.slice(0,2+i[1])}}},{key:"validateCert",value:function(){var e=this.getCert();return this._validate(e.preimage,f.constants.LATTICE_CERT_SIGNER,e.sig)}},{key:"validateSig",value:function(){try{if(!this.validateCert())return!1;var t=this.getPreimage(),n=this.getCert(),s=e.from(Object(b.decode)(this.props.data).slice(32,106)),i=s.slice(0,2+s[1]);return this._validate(t,n.pubkey,i)}catch(r){return console.error("Encountered error validating signature: ".concat(r.message)),!1}}},{key:"claimPoap",value:function(){var e=this,t=f.constants.POAP_CLAIM_REMOTE_URL;this.setState({isLoading:!0});var n=this.props.data;fetch(t,{method:"POST",body:JSON.stringify({data:n})}).then((function(e){return e.json()})).then((function(t){e.setState({poapToClaim:t})})).catch(console.error).finally((function(){e.setState({isLoading:!1})}))}},{key:"renderResult",value:function(){var e={status:"warning",title:"Could not Verify Authenticity",subTitle:"We could not verify the authenticity of this signature or signer."};return this.state.isValid&&(e.status="success",e.title="Verified",e.subTitle="The signer is authentic!"),Object(v.jsx)(l.a,{status:e.status,title:e.title,subTitle:e.subTitle})}},{key:"render",value:function(){var e=this,t=this.context.isMobile?18:10,n=this.context.isMobile?3:7;return Object(v.jsx)(d.a,{children:Object(v.jsx)(u.a,{span:t,offset:n,children:Object(v.jsxs)("center",{children:[Object(v.jsxs)(h.a,{title:"Validate Hardware",bordered:!0,children:[this.renderResult(),Object(v.jsxs)("p",{children:[Object(v.jsx)("b",{children:"Message:"})," ",this.getPreimage()]})]}),this.shouldShowClaimCard()&&Object(v.jsxs)(h.a,{title:"Claim POAP",bordered:!0,style:{marginTop:"20px"},children:[Object(v.jsx)("p",{children:"GridPlus is offering POAPs to all valid Lattice1 owners."}),Object(v.jsx)(j.a,{disabled:this.state.isLoading,loading:this.state.isLoading,onClick:function(){e.claimPoap()},children:"Claim"}),Object(v.jsx)("div",{style:{paddingTop:"20px"},children:Object(v.jsx)("a",{href:this.state.poapToClaim,children:this.state.poapToClaim})})]})]})})})}}]),c}(o.a.Component);x.contextType=p.a,t.a=x}).call(this,n(58).Buffer)},313:function(e,t,n){"use strict";var s=n(12),i=n(23),r=n(1),a=n(10),c=n(11),o=n(293),l=n(13),d=n(37),u=function(){function e(t,n){Object(a.a)(this,e),this.data=void 0,this.store=void 0,this.data=null,this.store=d.a.getRootStore()}return Object(c.a)(e,[{key:"isObject",value:function(e){try{return e&&"object"===typeof e&&!Array.isArray(e)}catch(t){return!1}}},{key:"updateBranch",value:function(e,t,n){var s=this;this.isObject(t)&&(this.isObject(e[n])&&!t[n]&&(t[n]={}),this.isObject(e[n])?Object.keys(e[n]).forEach((function(i){s.isObject(e[n][i])?s.updateBranch(e[n],t[n],i):t[n][i]=e[n][i]})):t[n]=e[n])}},{key:"save",value:function(e,t,n){var s=this;this.store[e]||(this.store[e]={}),this.store[e][t]||(this.store[e][t]={}),Object.keys(n).forEach((function(i){s.updateBranch(n,s.store[e][t],i)})),d.a.setRootStore(this.store)}},{key:"getWalletData",value:function(e,t){return this.store[e]||(this.store[e]={}),this.store[e][t]||(this.store[e][t]={}),this.store[e][t]}}]),e}(),h=n(58).Buffer,j=n(276).default,b=function(){function e(t,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(a.a)(this,e),this.client=void 0,this.crypto=void 0,this.name=void 0,this.storageSession=void 0,this.deviceID=void 0,this.stateUpdateHandler=void 0,this.page=void 0,this.baseUrl=void 0,this.addresses=void 0,this.btcTxs=void 0,this.btcUtxos=void 0,this.lastFetchedBtcData=void 0,this.btcPrice=void 0,this.client=null,this.crypto=null,this.name=s||l.constants.DEFAULT_APP_NAME,this.storageSession=null,this.deviceID=t,this.stateUpdateHandler=n,this.page=1,this.baseUrl=i.customEndpoint?i.customEndpoint:l.constants.BASE_SIGNING_URL,this.addresses={},this.btcTxs=[],this.btcUtxos=[],this.lastFetchedBtcData=0,this.btcPrice=0,this.getBtcWalletData()}return Object(c.a)(e,[{key:"disconnect",value:function(){this.client=null,this.saveBtcWalletData(),this.storageSession=null,this.deviceID=null}},{key:"isConnected",value:function(){return null!==this.client}},{key:"isPaired",value:function(){return this.client.isPaired||!1}},{key:"resetStateData",value:function(){this.addresses={},this.btcTxs=[],this.btcUtxos=[]}},{key:"getBtcDisplayAddress",value:function(){var e=this._getLastUsedBtcAddrIdx();return e>-1&&this.addresses.BTC[e+1]?this.addresses.BTC[e+1]:this.addresses.BTC&&this.addresses.BTC.length>0?this.addresses.BTC[0]:null}},{key:"getActiveWallet",value:function(){return this.client?this.client.getActiveWallet():null}},{key:"setPage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.page=e}},{key:"getPage",value:function(){return this.page}},{key:"dryAddresses",value:function(){var e={},t=this.addresses.BTC&&this.addresses.BTC.length>0,n=this.addresses.BTC_CHANGE&&this.addresses.BTC_CHANGE.length>0,s=Object(l.getBtcPurpose)();return s===l.constants.BTC_PURPOSE_NONE||(t&&(e.BTC={},e.BTC[s]=this.addresses.BTC||[]),n&&(e.BTC_CHANGE={},e.BTC_CHANGE[s]=this.addresses.BTC_CHANGE||[])),e}},{key:"rehydrateAddresses",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},n=Object(l.getBtcPurpose)();if(n===l.constants.BTC_PURPOSE_NONE)return t;e.BTC&&(t.BTC=e.BTC[n]),e.BTC_CHANGE&&(t.BTC_CHANGE=e.BTC_CHANGE[n]),this.addresses=t}},{key:"saveBtcWalletData",value:function(){var e;if(this.deviceID&&this.storageSession){var t=Object(l.getBtcPurpose)();if(t!==l.constants.BTC_PURPOSE_NONE){var n=Object(r.a)({},l.constants.BTC_WALLET_STORAGE_KEY,(e={},Object(r.a)(e,t,{addresses:this.dryAddresses(),btcTxs:this.btcTxs,btcUtxos:this.btcUtxos,lastFetchedBtcData:this.lastFetchedBtcData}),Object(r.a)(e,"btcPrice",this.btcPrice),e)),s=this.client?this.client.getActiveWallet():null;if(this.client&&null!==s){var i=s.uid.toString("hex");this.storageSession.save(this.deviceID,i,n)}}else console.error("Cannot save BTC wallet data when wallet is hidden")}}},{key:"getBtcWalletData",value:function(){if(this.deviceID&&!this.storageSession&&(this.storageSession=new u(this.deviceID)),this.client){var e=Object(l.getBtcPurpose)();if(e===l.constants.BTC_PURPOSE_NONE)return void console.error("Cannot get wallet data when wallet is hidden.");var t=this.getActiveWallet();if(null===t)this.addresses={};else{var n=t.uid.toString("hex"),s=this.storageSession.getWalletData(this.deviceID,n);if(!s||!s[l.constants.BTC_WALLET_STORAGE_KEY])return;var i=s[l.constants.BTC_WALLET_STORAGE_KEY];i.btcPrice&&(this.btcPrice=i.btcPrice);var r=i[e];if(!r)return;r.addresses&&this.rehydrateAddresses(r.addresses),r.btcTxs&&(this.btcTxs=r.btcTxs),r.btcUtxos&&(this.btcUtxos=r.btcUtxos),r.lastFetchedBtcData&&(this.lastFetchedBtcData=r.lastFetchedBtcData)}}}},{key:"_tryConnect",value:function(e,t,n){var s=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.baseUrl,a=l.constants.SHORT_TIMEOUT;!1===i&&(r="http://lattice-".concat(e,".local:8080"),a=5e3);var c,d=this._genPrivKey(e,t,this.name);try{c=new o.a({name:this.name,privKey:d,baseUrl:r,timeout:a,skipRetryOnWrongWallet:!1})}catch(u){return n?n(u.toString()):u.toString()}return c.connect(e).then((function(t){return c.timeout=l.constants.ASYNC_SDK_TIMEOUT,s.client=c,s.deviceID=e,s.getBtcWalletData(),n?n(null,t):t})).catch((function(r){if(r)return!1===i?(console.warn("Failed to connect to Lattice over LAN. Falling back to cloud routing."),s._tryConnect(e,t,n,!0)):(console.error("Failed to connect via cloud routing."),n?n(r):r);!1===i&&console.log("Successfully connected to Lattice over LAN.")}))}},{key:"connect",value:function(e,t,n){return this._tryConnect(e,t,n,!0)}},{key:"refreshWallets",value:function(){var e=Object(i.a)(Object(s.a)().mark((function e(t){var n,i;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.client){e.next=13;break}return n=JSON.stringify(this.client.getActiveWallet()),e.next=4,this.client.connect(this.deviceID).catch(t);case 4:if(i=e.sent,!1!==this.client.isPaired){e.next=7;break}return e.abrupt("return",t(l.constants.LOST_PAIRING_ERR));case 7:return JSON.stringify(this.client.getActiveWallet())!==n&&this.resetStateData(),this.getBtcWalletData(),e.abrupt("return",t(null,i));case 13:return e.abrupt("return",t("Lost connection to Lattice. Please refresh."));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sign",value:function(){var e=Object(i.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.sign(t).then((function(e){if(!e||!e.tx)throw new Error("Signing transaction invalid.");Object(l.broadcastBtcTx)(e.tx,(function(e,t){if(e)throw new Error("Error broadcasting transaction: ".concat(e.message));return t}))})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_genPrivKey",value:function(e,t,n){var s=h.concat([h.from(t),h.from(e),h.from(n)]);return this.crypto=new j(s),this.crypto.createHash("sha256").update(s).digest()}},{key:"getBtcTxs",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=[];return this.btcTxs.forEach((function(n){e&&n.confirmed?t.push(n):e||n.confirmed||t.push(n)})),t}},{key:"getBtcUtxos",value:function(){return this.btcUtxos}},{key:"getBtcBalance",value:function(){var e=0;return this.btcUtxos.forEach((function(t){e+=t.value})),e}},{key:"fetchBtcAddresses",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{regular:0,change:0},i=Object(l.getBtcPurpose)();if(i===l.constants.BTC_PURPOSE_NONE)return e("Cannot request BTC addresses while wallet is hidden.");var r=this._getLastUsedBtcAddrIdx(n),a=(n?this.addresses.BTC_CHANGE:this.addresses.BTC)||[],c=n?l.constants.BTC_CHANGE_GAP_LIMIT:l.constants.BTC_MAIN_GAP_LIMIT,o=r+1+c,d=o-a.length,u=Math.min(l.constants.BTC_ADDR_BLOCK_LEN,d);if(u>0){var h=n?1:0,j={startPath:[i,l.constants.BTC_COIN,Object(l.harden)(0),h,a.length],n:u,skipCache:!0};this._getAddresses(j,(function(i,r){if(i)return e(i);n?s.change+=u:s.regular+=u,n?t.addresses.BTC_CHANGE=a.concat(r):t.addresses.BTC=a.concat(r),console.log("Fetched BTC",t.addresses.BTC),console.log("Fetched BTC_CHANGE",t.addresses.BTC_CHANGE),d>u?t.fetchBtcAddresses(e,n,s):n?(t.saveBtcWalletData(),e(null,s)):t.fetchBtcAddresses(e,!0,s)}))}else n?(this.saveBtcWalletData(),e(null,s)):this.fetchBtcAddresses(e,!0,s)}},{key:"clearUtxos",value:function(){this.btcUtxos=[]}},{key:"fetchBtcStateData",value:function(e,t){var n=this,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=(s?this.addresses.BTC_CHANGE:this.addresses.BTC)||[];e&&e.regular>0?(a=this.addresses.BTC.slice(-e.regular),e.regular=0):e&&e.change>0&&(s=!0,a=this.addresses.BTC_CHANGE.slice(-e.change),e.change=0),Object(l.fetchBtcPrice)((function(c,o){c&&(console.error("Failed to fetch price:",c),o=0),Object(l.fetchBtcTxs)(a,i,(function(c,d){return c?t(c):d?(i=i.concat(d),void Object(l.fetchBtcUtxos)(a,(function(a,c){if(a)return t(a);if(!c)return t("Failed to fetch UTXOs");if(r=r.concat(c),s){n.btcPrice=o,n.lastFetchedBtcData=Math.floor(Date.now());var d=n.btcTxs.concat(i);n.btcTxs=Object(l.filterUniqueObjects)(d,["id"]),n._processBtcTxs();var u=n.btcUtxos.concat(r);n.btcUtxos=Object(l.filterUniqueObjects)(u,["id","vout"]).sort((function(e,t){return t.value-e.value})),n.saveBtcWalletData(),t(null)}else n.fetchBtcStateData(e,t,!0,i,r)}))):t("Failed to fetch transactions")}))}))}},{key:"_getAddresses",value:function(){var e=Object(i.a)(Object(s.a)().mark((function e(t,n){var i,r=this;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.getAddresses(t).catch((function(e){if(e){if("Device Busy"===e)return r._getAddresses(t,n);setTimeout((function(){return n(e)}),2e3)}}));case 2:return i=e.sent,e.abrupt("return",n(null,i));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getLastUsedBtcAddrIdx",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?"BTC_CHANGE":"BTC",n=this.addresses[t]||[],s=this.btcTxs||[],i=-1,r=0;r<s.length;r++)s[r].confirmed&&function(){var e=i;s[r].inputs.forEach((function(t){n.indexOf(t.addr)>e&&(e=n.indexOf(t.addr))})),s[r].outputs.forEach((function(t){n.indexOf(t.addr)>e&&(e=n.indexOf(t.addr))})),e>i&&(i=e)}();return i}},{key:"_processBtcTxs",value:function(){var e=this.addresses.BTC.concat(this.addresses.BTC_CHANGE),t=[];JSON.parse(JSON.stringify(this.btcTxs)).forEach((function(n){if(n.incoming=n.inputs.every((function(t){return-1===e.indexOf(t.addr)})),n.incoming?(n.outputs.forEach((function(t){!n.recipient&&e.indexOf(t.addr)>-1&&(n.recipient=e[e.indexOf(t.addr)])})),n.recipient||(n.recipient=n.outputs[0].addr)):n.recipient=n.outputs[0].addr,n.value=0,n.incoming)n.outputs.forEach((function(t){e.indexOf(t.addr)>-1&&(n.value+=t.value)}));else{var s=0;n.inputs.forEach((function(e){s+=e.value}));var i=0,r=0;n.outputs.forEach((function(t){e.indexOf(t.addr)>-1?i+=t.value:r+=t.value})),s===i+n.fee?n.value=0:n.value=r}t.push(n)}));var n=t.sort((function(e,t){return t.timestamp-e.timestamp}));this.btcTxs=n}}]),e}();t.a=b},37:function(e,t,n){"use strict";var s=n(1),i=n(2),r=n(127),a=n.n(r),c="gridplus_web_wallet_id",o="gridplus_web_wallet_password",l="gridplus_addresses",d="gridplus_contracts",u="gridplus_contracts_packs",h=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"0.5.1",REACT_APP_NAME:"lattice-manager"}).REACT_APP_ROOT_STORE||"gridplus",j=function(e){var t=window.localStorage.getItem(e);try{return JSON.parse(t)}catch(n){return JSON.parse(JSON.stringify(t))}},b=function(e,t){return window.localStorage.setItem(e,JSON.stringify(t))},f=function(e){return window.localStorage.removeItem(e)},p=function(){var e;return null!==(e=j(h))&&void 0!==e?e:{}},v=function(e){var t,n;return null!==(t=null===(n=j(h))||void 0===n?void 0:n[e])&&void 0!==t?t:{}},g=function(e,t){return window.localStorage.setItem(h,JSON.stringify(Object(i.a)(Object(i.a)({},p()),{},Object(s.a)({},"".concat(e),t))))},O=function(){return v("keyring")},x=function(e){var t,n;return null!==(t=null===(n=v("keyring"))||void 0===n?void 0:n[e])&&void 0!==t?t:{}},m=function(e,t){return g("keyring",Object(s.a)({},"".concat(e),t))},y=function(e){return g("keyring",a()(O(),e))},T=function(){return j(c)},_=function(e){return b(c,e)},S=function(){return f(c)},E=function(){return j(o)},C=function(e){return b(o,e)},A=function(){return f(o)},P=function(e){var t,n=T();if(n)return null===(t=v(n))||void 0===t?void 0:t[e]},k=function(e,t){var n=T();if(n&&t)return g(n,Object(i.a)(Object(i.a)({},v(n)),{},Object(s.a)({},"".concat(e),t)))},B=function(e){var t=T();if(t)return g(t,a()(v(t),e))},R={getItem:j,setItem:b,removeItem:f,getRootStore:p,setRootStore:function(e){return window.localStorage.setItem(h,JSON.stringify(Object(i.a)(Object(i.a)({},p()),e)))},removeRootStore:function(){return f(h)},getRootStoreItem:v,setRootStoreItem:g,removeRootStoreItem:function(e){return window.localStorage.setItem(h,JSON.stringify(a()(p(),e)))},getSettings:function(){return v("settings")},setSettings:function(e){return g("settings",e)},getLoginId:T,setLoginId:_,removeLoginId:S,getLoginPassword:E,setLoginPassword:C,removeLoginPassword:A,getKeyring:O,setKeyring:function(e){return g("keyring",e)},getKeyringItem:x,setKeyringItem:m,removeKeyringItem:y,renameKeyringItem:function(e,t){if(e!==t){var n=Object(i.a)({},x(e));m(t,n),y(e)}},getLogin:function(){return{deviceID:T(),password:E()}},setLogin:function(e){var t=e.deviceID,n=e.password;_(t),C(n)},removeLogin:function(){S(),A()},getDeviceIndexedItem:P,setDeviceIndexedItem:k,removeDeviceIndexedItem:B,getAddresses:function(){return P(l)},setAddresses:function(e){return k(l,e)},removeAddresses:function(){return B(l)},getContracts:function(){return P(d)},setContracts:function(e){return k(d,e)},removeContracts:function(){return B(d)},getContractPacks:function(){var e;return null!==(e=j(u))&&void 0!==e?e:[]},setContractPacks:function(e){return b(u,e)},removeContractPacks:function(){return f(u)}};t.a=R},401:function(e,t){},403:function(e,t){},417:function(e,t){},419:function(e,t){},42:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return j}));var s=n(2),i=n(6),r=n(0),a=n(294),c=n.n(a),o=n(295),l=n.n(o),d=n(37),u=n(4),h=Object(r.createContext)(void 0),j=function(e){var t,n=e.children,a=e.overrides,o=Object(r.useState)(window.innerWidth<500),j=Object(i.a)(o,2),b=j[0],f=j[1],p=Object(r.useState)(null),v=Object(i.a)(p,2),g=v[0],O=v[1],x=Object(r.useState)(!1),m=Object(i.a)(x,2),y=m[0],T=m[1],_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",n=Object(r.useState)(e),s=Object(i.a)(n,2),a=s[0],o=s[1];return[a,function(e){return o((function(n){return l()(n,e,t)}))},function(e){return o((function(n){return c()(n,e,t)}))},function(){return o([])}]}(null!==(t=d.a.getAddresses())&&void 0!==t?t:[]),S=Object(i.a)(_,4),E=S[0],C=S[1],A=S[2],P=S[3],k={isMobile:b,session:g,setSession:O,isLoadingAddresses:y,setIsLoadingAddresses:T,addresses:E,addAddressesToState:C,removeAddressesFromState:A,resetAddressesInState:P};return Object(r.useEffect)((function(){d.a.setAddresses(E)}),[E]),Object(r.useEffect)((function(){window.addEventListener("resize",(function(){var e=window.innerWidth<500;e&&!b&&f(!0),!e&&b&&f(!1)}))}),[b]),Object(u.jsx)(h.Provider,{value:Object(s.a)(Object(s.a)({},k),a),children:n})}},482:function(e,t){},483:function(e,t){},503:function(e,t,n){"use strict";n.r(t);n(0),n(57);var s=n(54),i=n(42),r=n(4);var a=function(){return Object(r.jsx)("div",{className:"App",children:Object(r.jsx)(i.b,{children:Object(r.jsx)(s.f,{})})})},c=n(306),o=document.getElementById("root");Object(c.createRoot)(o).render(Object(r.jsx)(a,{}))},54:function(e,t,n){"use strict";n.d(t,"f",(function(){return s.a})),n.d(t,"g",(function(){return f})),n.d(t,"b",(function(){return k})),n.d(t,"h",(function(){return R})),n.d(t,"k",(function(){return Z})),n.d(t,"a",(function(){return Ie})),n.d(t,"d",(function(){return Ve})),n.d(t,"e",(function(){return Ye})),n.d(t,"c",(function(){return ze})),n.d(t,"l",(function(){return Je.a})),n.d(t,"m",(function(){return ct})),n.d(t,"i",(function(){return Pt})),n.d(t,"j",(function(){return yt}));var s=n(238),i=n(10),r=n(11),a=n(16),c=n(17),o=n(0),l=n.n(o),d=(n(57),n(504)),u=n(506),h=n(42),j=n(4),b=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(i.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).context=e.context,e}return Object(r.a)(n,[{key:"render",value:function(){if(this.props.children||this.props.content)return this.context.isMobile?this.props.children?this.props.children:this.props.content:Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(u.a,{span:14,children:this.props.children||this.props.content})})}}]),n}(l.a.Component);b.contextType=h.a;var f=b,p=n(21),v=n(48),g=n(307),O=n(522),x=n(525),m=n(319),y=n(528),T=n(529),_=n(13),S=n(6),E=n(527),C=n(520),A=function(e){var t=e.name,n=e.setName,s=Object(o.useState)(!1),i=Object(S.a)(s,2),r=i[0],a=i[1],c=Object(o.useState)(!1),l=Object(S.a)(c,2),d=l[0],u=l[1],h=C.a.useForm(),b=Object(S.a)(h,1)[0];return r?Object(j.jsxs)(C.a,{form:b,name:"formData",layout:"inline",onFinish:function(e){a(!1),n(e.name)},style:{justifyContent:"center"},children:[Object(j.jsx)(C.a.Item,{name:"name",initialValue:t,rules:[{required:!0,message:"Name is required."}],children:Object(j.jsx)(g.a,{"data-testid":"".concat(t,"-input")})}),Object(j.jsxs)(C.a.Item,{children:[Object(j.jsx)(v.a,{type:"text",onClick:function(){b.resetFields(),a(!1)},"data-testid":"".concat(t,"-cancel"),children:"Cancel"}),Object(j.jsx)(v.a,{type:"ghost",htmlType:"submit","data-testid":"".concat(t,"-save"),children:"Save"})]})]}):Object(j.jsx)(v.a,{type:"text",size:"large",icon:d?Object(j.jsx)(E.a,{}):null,style:{fontSize:"24px"},"data-testid":"".concat(t,"-edit"),onClick:function(){return a(!0)},onMouseEnter:function(){return u(!0)},onMouseLeave:function(){return u(!1)},children:t})},P=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).context=s.context,s.state={errMsg:null,isLoading:!1,modal:!1,showSettings:!1},s.handleCancel=s.handleCancel.bind(Object(p.a)(s)),s.handleSubmit=s.handleSubmit.bind(Object(p.a)(s)),s.renderMsg=s.renderMsg.bind(Object(p.a)(s)),s.showModal=s.showModal.bind(Object(p.a)(s)),s}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.input&&this.input.focus(),this.setState({isLoading:!1})}},{key:"componentDidUpdate",value:function(){this.props.name!==_.constants.DEFAULT_APP_NAME&&"Lattice Connector"!==document.title&&(document.title="Lattice Connector")}},{key:"componentWillUnmount",value:function(){this.setState({isLoading:!1})}},{key:"handleSubmit",value:function(){var e=document.getElementById("deviceIdInput").value,t=document.getElementById("passwordInput").value;t.length<8?this.setState({isLoading:!0,errMsg:"Your password must be at least 8 characters."}):(this.setState({isLoading:!0,errMsg:null}),this.props.submitCb({deviceID:e,password:t},!1))}},{key:"handleCancel",value:function(){this.props.cancelConnect(),this.setState({isLoading:!1,errMsg:null})}},{key:"renderConnectButton",value:function(){return this.state.isLoading&&null===this.state.errMsg&&null===this.props.errMsg?Object(j.jsxs)("div",{children:[Object(j.jsx)(v.a,{type:"primary",style:{margin:"20px 0 0 0"},loading:!0,children:"Connecting..."}),Object(j.jsx)("br",{}),Object(j.jsx)(v.a,{type:"link",onClick:this.handleCancel,children:"Cancel"})]}):Object(j.jsx)(v.a,{type:"primary",onClick:this.handleSubmit,style:{margin:"20px 0 0 0"},children:"Connect"})}},{key:"renderForm",value:function(e){var t=this;return Object(j.jsxs)("div",{children:[Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(g.a,{placeholder:"DeviceID",id:"deviceIdInput",ref:function(e){t.input=e},style:{margin:"10px 0 0 0",width:"70%"}})}),Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(g.a.Password,{placeholder:"Password (create for new logins)",id:"passwordInput",onPressEnter:this.handleSubmit,style:{margin:"20px 0 0 0",width:"70%"}})}),Object(j.jsx)(d.a,{justify:"center",children:this.renderConnectButton()})]})}},{key:"showModal",value:function(){this.setState({modal:!0})}},{key:"hideModal",value:function(){this.setState({modal:!1,showSettings:!1})}},{key:"renderSetupInfo",value:function(){return Object(j.jsxs)("div",{children:[Object(j.jsx)("center",{children:Object(j.jsx)("h3",{children:Object(j.jsx)("b",{children:"New User Setup"})})}),Object(j.jsxs)("p",{children:["You can use this page to establish a connection between ",Object(j.jsx)("b",{children:this.props.name}),"\xa0 and your Lattice hardware wallet device.\xa0",Object(j.jsxs)("i",{children:["For more general device setup information, please see the\xa0",Object(j.jsx)("a",{className:"lattice-a",href:"https://gridplus.io/setup",target:"_blank",rel:"noopener noreferrer",children:"Lattice setup page"}),"."]})]}),Object(j.jsx)("h3",{children:Object(j.jsx)("b",{children:"Step 1:"})}),Object(j.jsxs)("p",{children:["Unlock your Lattice and find its ",Object(j.jsx)("b",{children:"Device ID"})," on the main menu. This is a six-character code."]}),Object(j.jsx)("h3",{children:Object(j.jsx)("b",{children:"Step 2:"})}),Object(j.jsxs)("p",{children:["Once you have your Device ID, specify a ",Object(j.jsx)("b",{children:"password"}),". This does ",Object(j.jsx)("i",{children:"not"})," secure any value and is ",Object(j.jsx)("i",{children:"not"})," associated with your wallet seed - it is only used to send secure requests to your device. If you lose your password, you can remove the permission on your device and re-connect with a new one."]}),Object(j.jsx)("h3",{children:Object(j.jsx)("b",{children:"Step 3:"})}),Object(j.jsxs)("p",{children:["Please ensure your Lattice is ",Object(j.jsx)("b",{children:"online"}),' and click "Connect". Your device is online if there is a single wifi signal icon on the top-right of the screen.']})]})}},{key:"renderModal",value:function(){return this.state.showSettings?Object(j.jsx)(O.a,{title:"Settings",footer:null,visible:this.state.modal,onOk:this.hideModal.bind(this),onCancel:this.hideModal.bind(this),children:Object(j.jsx)(Z,{inModal:!0})}):Object(j.jsx)("div",{children:Object(j.jsx)(O.a,{title:this.props.name===_.constants.DEFAULT_APP_NAME?this.props.name:"Lattice Connector \ud83d\udd17",footer:null,visible:this.state.modal,onOk:this.hideModal.bind(this),onCancel:this.hideModal.bind(this),children:this.renderSetupInfo()})})}},{key:"renderMsg",value:function(){var e;if(this.state.errMsg?e=this.state.errMsg:this.props.errMsg&&(e=this.props.errMsg),e)return Object(j.jsx)(x.a,{message:Object(j.jsxs)("p",{children:[Object(j.jsx)("b",{children:"Error:"}),Object(j.jsx)("br",{}),e]}),type:"error",style:{margin:"20px 0 0 0"},closable:!0})}},{key:"render",value:function(){var e=this,t=this.context.isMobile?24:10,n=this.context.isMobile?0:7,s=null!==this.props.keyringName&&this.props.keyringName.length<5;return Object(j.jsxs)(d.a,{children:[this.renderModal(),Object(j.jsx)(u.a,{span:t,offset:n,children:Object(j.jsxs)("center",{children:[this.renderMsg(),Object(j.jsxs)(m.a,{bordered:!0,children:[Object(j.jsx)("a",{className:"lattice-a",href:"https://gridplus.io/lattice",target:"_blank",rel:"noopener noreferrer",children:this.props.keyringName?Object(j.jsxs)("h2",{style:{margin:"10px 0 0 0"},children:["Lattice Connector ",Object(j.jsx)(y.a,{})]}):Object(j.jsxs)("h2",{style:{margin:"10px 0 0 0"},children:["Lattice Manager",Object(j.jsx)("br",{}),Object(j.jsx)(T.a,{})]})}),this.props.keyringName?Object(j.jsxs)("div",{style:{margin:"2em"},children:[Object(j.jsx)("br",{}),Object(j.jsx)("i",{children:Object(j.jsx)("h3",{children:"Connect to:"})}),Object(j.jsx)(A,{name:this.props.keyringName,setName:this.props.setKeyringName})]}):null,s?Object(j.jsx)("p",{children:Object(j.jsx)("b",{children:"Error: App name must be more than 4 characters."})}):this.renderForm()]}),Object(j.jsx)(v.a,{type:"link",onClick:this.showModal.bind(this),style:{margin:"20px 0 0 0"},children:"New User Info"}),Object(j.jsx)("br",{}),Object(j.jsx)(v.a,{type:"link",onClick:function(){e.setState({showSettings:!0},e.showModal)},children:"Settings"}),Object(j.jsx)("br",{}),Object(j.jsx)(v.a,{type:"link",href:"https://gridplus.io/lattice",target:"_blank",rel:"noopener noreferrer",children:"About the Lattice"})]})})]})}}]),n}(l.a.Component);P.contextType=h.a;var k=P,B=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).context=s.context,s.state={code:""},s}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.setState({code:""}),this.input&&this.input.focus()}},{key:"componentWillUnmount",value:function(){this.setState({code:""})}},{key:"handleUpdate",value:function(e){var t=this;try{this.setState({code:e.target.value.toUpperCase()},(function(){t.state.code.length>=8&&t.props.submit(t.state.code)}))}catch(n){}}},{key:"getBoxWidth",value:function(){var e=document.getElementById("secret-card");if(e)return.8*e.clientWidth}},{key:"getBoxFontHeight",value:function(){var e=this.getBoxWidth();if(e)return e/8*.6}},{key:"render",value:function(){var e=this;if(this.props.hide)return null;var t=this.context.isMobile?"small":"large",n=this.getBoxWidth(),s=this.getBoxFontHeight(),i=Object(j.jsx)("center",{children:Object(j.jsxs)(m.a,{title:"Enter Secret",bordered:!0,id:"secret-card",children:[Object(j.jsx)("p",{}),Object(j.jsx)("p",{children:"Please enter the pairing secret displayed on your Lattice screen:"}),Object(j.jsx)(g.a,{className:"lattice-pairing-box",size:t,id:"secret",ref:function(t){e.input=t},onChange:this.handleUpdate.bind(this),style:{width:n,fontSize:s},value:this.state.code})]})});return Object(j.jsx)(f,{content:i})}}]),n}(l.a.Component);B.contextType=h.a;var R=B,w=n(187),I=n(149),N=n(103),L=n(188),D=n(75),M=n(317),U=(n(151),n(467)),W=3600,G={ETH:{name:"ETH",decimals:18},BTC:{name:"BTC",decimals:8}},F=(l.a.Component,n(194)),K=n(315),V=n(523),H=n(519),Y=n(530),z=n(127),J=n.n(z),q=n(37),X=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).state={settings:q.a.getSettings(),keyring:q.a.getKeyring()},s.getBtcPurposeName=s.getBtcPurposeName.bind(Object(p.a)(s)),s}return Object(r.a)(n,[{key:"submit",value:function(){q.a.setSettings(this.state.settings),window.location.reload()}},{key:"updateUseCustomEndpoint",value:function(e){var t=this.state.settings;!0!==e&&(t.customEndpoint=""),this.setState({settings:t})}},{key:"updateCustomEndpoint",value:function(e){var t=this.state.settings;t.customEndpoint=e.target.value,this.setState({settings:t})}},{key:"removeKeyring",value:function(e){var t=e.name;q.a.removeKeyringItem(t),this.setState({keyring:J()(this.state.keyring,t)})}},{key:"resetState",value:function(){q.a.removeRootStore(),window.location.reload()}},{key:"renderCustomEndpointSetting",value:function(){var e=this.state.settings.customEndpoint,t=void 0===e?"":e;return Object(j.jsx)(m.a,{children:Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsxs)(u.a,{span:20,children:[Object(j.jsx)("h3",{children:"Connection Endpoint:"}),Object(j.jsxs)("p",{children:["If you wish to route messages and connections through your own endpoint, you may specify it here.\xa0 Otherwise leave blank.\xa0 See\xa0",Object(j.jsx)("a",{href:"https://github.com/GridPlus/lattice-connect",className:"lattice-a",target:"_blank",rel:"noopener noreferrer",children:"this"})," for more information."]}),Object(j.jsx)("div",{children:Object(j.jsx)(g.a,{placeholder:"host:port",defaultValue:t,onChange:this.updateCustomEndpoint.bind(this)})})]})})})}},{key:"handleChangeBitcoinVersionSetting",value:function(e){var t=this.state.settings;t.btcPurpose=parseInt(e.target.value),this.setState({settings:t},this.submit)}},{key:"getBtcPurposeName",value:function(){var e=this.state.settings.btcPurpose?this.state.settings.btcPurpose:Object(_.getBtcPurpose)();return e===_.constants.BTC_PURPOSE_NONE?_.constants.BTC_PURPOSE_NONE_STR:e===_.constants.BTC_PURPOSE_LEGACY?_.constants.BTC_PURPOSE_LEGACY_STR:e===_.constants.BTC_PURPOSE_WRAPPED_SEGWIT?_.constants.BTC_PURPOSE_WRAPPED_SEGWIT_STR:e===_.constants.BTC_PURPOSE_SEGWIT?_.constants.BTC_PURPOSE_SEGWIT_STR:"Error finding BTC version"}},{key:"renderBitcoinVersionSetting",value:function(){var e=Object(_.getBtcPurpose)()||_.constants.BTC_PURPOSE_NONE;return Object(j.jsxs)(m.a,{children:[Object(j.jsx)("h4",{children:"Bitcoin Wallet Type"}),Object(j.jsx)(F.a.Group,{onChange:this.handleChangeBitcoinVersionSetting.bind(this),defaultValue:e,children:Object(j.jsxs)(K.b,{direction:"vertical",children:[Object(j.jsx)(F.a,{value:_.constants.BTC_PURPOSE_NONE,children:"Hide BTC Wallet"}),Object(j.jsx)(F.a,{value:_.constants.BTC_PURPOSE_SEGWIT,children:_.constants.BTC_PURPOSE_SEGWIT_STR}),Object(j.jsx)(F.a,{value:_.constants.BTC_PURPOSE_WRAPPED_SEGWIT,children:_.constants.BTC_PURPOSE_WRAPPED_SEGWIT_STR}),Object(j.jsx)(F.a,{value:_.constants.BTC_PURPOSE_LEGACY,children:_.constants.BTC_PURPOSE_LEGACY_STR})]})})]})}},{key:"renderDebugSettings",value:function(){return Object(j.jsxs)(m.a,{children:[Object(j.jsx)("h4",{children:"Debug Settings"}),Object(j.jsx)(d.a,{justify:"center",style:{margin:"10px 0 0 0"},children:Object(j.jsxs)(v.a,{type:"link",onClick:this.resetState,className:"warning-a",children:[Object(j.jsx)(Y.a,{}),"\xa0Reset App State"]})})]})}},{key:"renderKeyringsSetting",value:function(){var e=this,t=q.a.getKeyring(),n=[{title:"App Name",dataIndex:"name",key:"name"},{title:"Action",dataIndex:"action",key:"action",render:function(t,n){return Object(j.jsx)(v.a,{type:"link",onClick:function(){e.removeKeyring(n)},children:"Forget"})}}],s=[];return Object.keys(t).sort((function(e,t){return e.toLowerCase()>t.toLowerCase()?1:-1})).forEach((function(e){s.push({name:e,key:e})})),Object(j.jsx)(m.a,{children:Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsxs)(u.a,{span:20,children:[Object(j.jsx)("h3",{children:"Third Party Connections"}),Object(j.jsx)("p",{children:"Manage connections to your Lattice. Third party apps should be listed here if they are connected to your device."}),Object(j.jsx)(V.a,{children:Object(j.jsx)(V.a.Panel,{header:"Connections List (".concat(s.length,")"),children:Object(j.jsx)(H.a,{dataSource:s,columns:n})},"third-party")})]})})})}},{key:"renderCard",value:function(){return Object(j.jsxs)("div",{children:[this.renderKeyringsSetting(),this.renderCustomEndpointSetting(),this.renderBitcoinVersionSetting(),this.renderDebugSettings(),Object(j.jsx)("br",{}),Object(j.jsx)(v.a,{type:"primary",onClick:this.submit.bind(this),children:"Update and Reload"})]})}},{key:"render",value:function(){var e=Object(j.jsx)("center",{children:Object(j.jsx)(m.a,{title:"Settings",bordered:!0,children:this.renderCard()})});return this.props.inModal?Object(j.jsx)("center",{children:this.renderCard()}):Object(j.jsx)(f,{content:e})}}]),n}(l.a.Component),Z=X,Q=n(190),$=n.n(Q),ee=n(318),te=n(2),ne=n(12),se=n(23),ie=n(299),re=n(233),ae=n.n(re),ce=n(316),oe=function(e){var t=e.message,n=e.description,s=e.onClick,i=e.onClose,r="error-".concat(Date.now()),a=s&&Object(j.jsx)(v.a,{danger:!0,size:"small",onClick:function(){s(),ce.a.close(r)},children:"Retry"});ce.a.open({message:t,description:n,placement:"top",btn:a,key:r,type:"error",onClose:i})},le=_.constants.ADDRESSES_PER_PAGE,de=_.constants.ADDRESS_RECORD_TYPE,ue=function(){var e=Object(o.useContext)(h.a),t=e.session,n=e.isLoadingAddresses,s=e.setIsLoadingAddresses,i=e.addresses,r=e.addAddressesToState,a=e.removeAddressesFromState,c=e.resetAddressesInState,l=Object(o.useCallback)(Object(se.a)(Object(ne.a)().mark((function e(){var n,i=arguments;return Object(ne.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>0&&void 0!==i[0]?i[0]:0,s(!0),e.abrupt("return",t.client.getKvRecords({start:n,n:le}).then(function(){var e=Object(se.a)(Object(ne.a)().mark((function e(t){var s;return Object(ne.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r(t.records),s=t.fetched+n,!(t.total-s>0)){e.next=6;break}return e.next=6,l(n+t.fetched);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){oe(Object(te.a)(Object(te.a)({},e),{},{onClick:l}))})).finally((function(){s(!1)})));case 3:case"end":return e.stop()}}),e)}))),[r,t,s]),d=function(){var e=Object(se.a)(Object(ne.a)().mark((function e(n){var i;return Object(ne.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(!0),i=ae.a.chain(n).chunk(le).map((function(e){return ae.a.chain(e).keyBy("key").mapValues("val").value()})).value(),e.abrupt("return",new Promise(function(){var e=Object(se.a)(Object(ne.a)().mark((function e(n,s){var r,a,c,o,l,d;return Object(ne.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!1,a=!1,e.prev=2,o=Object(ie.a)(i);case 4:return e.next=6,o.next();case 6:if(!(r=!(l=e.sent).done)){e.next=13;break}return d=l.value,e.next=10,t.client.addKvRecords({caseSensitive:!1,type:de,records:d}).catch((function(e){oe(e),s(e)}));case 10:r=!1,e.next=4;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),a=!0,c=e.t0;case 19:if(e.prev=19,e.prev=20,!r||null==o.return){e.next=24;break}return e.next=24,o.return();case 24:if(e.prev=24,!a){e.next=27;break}throw c;case 27:return e.finish(24);case 28:return e.finish(19);case 29:n();case 30:case"end":return e.stop()}}),e,null,[[2,15,19,29],[20,,24,28]])})));return function(t,n){return e.apply(this,arguments)}}()).then(Object(se.a)(Object(ne.a)().mark((function e(){return Object(ne.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l();case 2:case"end":return e.stop()}}),e)})))).catch(oe).finally((function(){s(!1)})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{fetchAddresses:l,addresses:i,addAddresses:d,addAddressesToState:r,removeAddresses:function e(n){var i=n.map((function(e){return parseInt(e.id)}));if(!$()(i))return s(!0),t.client.removeKvRecords({ids:i}).then((function(){a(n)})).catch((function(t){oe(Object(te.a)(Object(te.a)({},t),{},{onClick:function(){return e(n)}}))})).finally((function(){s(!1)}))},removeAddressesFromState:a,resetAddressesInState:c,isLoadingAddresses:n}},he=function(e){var t=e.showModal,n=ue().isLoadingAddresses;return Object(j.jsx)(v.a,{type:"ghost",onClick:t,disabled:n,icon:Object(j.jsx)(ee.a,{}),children:"Add"})},je=n(14),be=n(531),fe=["key","name"],pe=function(e){var t=e.isModalVisible,n=e.setIsModalVisible,s=e.initialAddresses,i=ue(),r=i.addresses,a=i.addAddresses,c=i.isLoadingAddresses,o=C.a.useForm(),l=Object(S.a)(o,1)[0],d=function(){n(!1)},u=function(){d()};return Object(j.jsx)(j.Fragment,{children:Object(j.jsx)(O.a,{title:"Add Address Tags",visible:t,maskClosable:!1,onOk:l.submit,onCancel:u,destroyOnClose:!0,footer:[Object(j.jsx)(v.a,{type:"link",onClick:u,children:"Cancel"},"cancel"),Object(j.jsx)(v.a,{type:"primary",loading:c,onClick:l.submit,children:"Add"},"add")],children:Object(j.jsx)(K.b,{direction:"vertical",style:{width:"100%"},children:Object(j.jsx)(C.a,{form:l,name:"formData",onFinish:function(){l.validateFields().then((function(e){var t=e.addressesToAdd;return a(t).then(d)}))},onFinishFailed:function(){oe({message:"Unable to submit",description:"Please fix errors in form and try again."})},autoComplete:"off",preserve:!1,layout:"vertical",children:Object(j.jsx)(C.a.List,{name:"addressesToAdd",initialValue:s,children:function(e,t){var n=t.add,s=t.remove;return Object(j.jsxs)(j.Fragment,{children:[e.map((function(e){e.key;var t=e.name,n=Object(je.a)(e,fe);return Object(j.jsxs)("div",{style:{display:"flex",flexDirection:"row",marginBottom:"1em",width:"100%"},children:[Object(j.jsxs)("div",{style:{display:"flex",flexDirection:"column",flexGrow:1},children:[Object(j.jsx)(C.a.Item,Object(te.a)(Object(te.a)({},n),{},{name:[t,"key"],validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"Address is required."},{max:63,type:"string",message:"Must be shorter than ".concat(63," characters.")},{validator:function(e,t){return null!==r&&void 0!==r&&r.some((function(e){return e.key===t}))?Promise.reject(new Error("You already have a tag with this address on your device.")):Promise.resolve()},validateTrigger:["onChange","onBlur"]},{validator:function(e,t){var n;return(null===(n=l.getFieldsValue().addressesToAdd)||void 0===n?void 0:n.filter((function(e){return e.key===t}))).length>1?Promise.reject(new Error("You are already trying to add a tag with this address.")):Promise.resolve()},validateTrigger:["onChange","onBlur"]}],children:Object(j.jsx)(g.a,{addonBefore:"Address","data-testid":"".concat(t,"-address-input"),disabled:c})})),Object(j.jsx)(C.a.Item,Object(te.a)(Object(te.a)({},n),{},{name:[t,"val"],validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"Name is required"},{max:63,type:"string",message:"Must be shorter than ".concat(63," characters.")},{validator:function(e,t){return null!==r&&void 0!==r&&r.some((function(e){return e.val===t}))?Promise.reject(new Error("You already have a tag with this name on your device.")):Promise.resolve()},validateTrigger:["onChange","onBlur"]},{validator:function(e,t){var n;return(null===(n=l.getFieldsValue().addressesToAdd)||void 0===n?void 0:n.filter((function(e){return e.val===t}))).length>1?Promise.reject(new Error("You are already trying to add a tag with this name.")):Promise.resolve()},validateTrigger:["onChange","onBlur"]}],children:Object(j.jsx)(g.a,{addonBefore:"Name","data-testid":"".concat(t,"-name-input"),disabled:c})}))]}),t>0?Object(j.jsx)(v.a,{type:"text",icon:Object(j.jsx)(be.a,{}),disabled:c,style:{height:"auto",marginLeft:"1em",marginBottom:"1.2em"},onClick:function(){s(t),l.validateFields()}}):null]},"".concat(t,"-inputs"))})),Object(j.jsx)(C.a.Item,{children:Object(j.jsx)(v.a,{type:"dashed",block:!0,icon:Object(j.jsx)(ee.a,{}),disabled:c,onClick:n,children:"Add Another Address Tag"})})]})}})})})})})},ve=n(300),ge=n.n(ve),Oe=n(301),xe=n.n(Oe),me=_.constants.ADDRESSES_PER_PAGE,ye=function(){var e=ue(),t=e.isLoadingAddresses,n=e.addresses,s=e.removeAddresses,i=Object(o.useState)(""),r=Object(S.a)(i,2),a=r[0],c=r[1],l=Object(o.useState)([]),d=Object(S.a)(l,2),u=d[0],h=d[1],b=Object(o.useState)([]),f=Object(S.a)(b,2),p=f[0],O=f[1];Object(o.useEffect)((function(){c(""),h(n)}),[n,t]);var x=Object(o.useCallback)((function(e){return ge.a.go(e,n,{keys:["key","val"]}).map((function(e){return e.obj}))}),[n]);return Object(j.jsxs)("div",{children:[Object(j.jsxs)("div",{style:{display:"flex"},children:[Object(j.jsx)(g.a,{value:a,placeholder:"Filter",disabled:t,onChange:function(e){var t=e.target.value;c(t);var s=t?x(t):n;h(s),O(xe()(p,s,"key"))},style:{marginBottom:"1em"},allowClear:!0}),Object(j.jsx)(v.a,{danger:!0,type:"text",disabled:0===p.length,onClick:function(){return s(p).then((function(){O([])}))},style:{marginLeft:"1em"},children:"Remove Selected"})]}),Object(j.jsxs)(H.a,{dataSource:u,tableLayout:"fixed",loading:{spinning:t,tip:"Loading...",indicator:Object(j.jsx)(D.a,{})},pagination:{position:["bottomCenter"],pageSize:me,defaultCurrent:1,showSizeChanger:!1},rowSelection:{type:"checkbox",onSelect:function(e,t,n){O(n)},onSelectAll:function(e,t){O(t)},selectedRowKeys:p.map((function(e){return e.key}))},children:[Object(j.jsx)(H.a.Column,{title:"Name",dataIndex:"val",defaultSortOrder:"ascend",sorter:function(e,t){return e.val.localeCompare(t.val)}},"val"),Object(j.jsx)(H.a.Column,{title:"Address",dataIndex:"key",render:function(e){return(t=e)&&t.length>24?"".concat(t.slice(0,10),"...").concat(t.slice(t.length-8,t.length)):null!==t&&void 0!==t?t:"";var t},sorter:function(e,t){return e.key.localeCompare(t.key)}},"key")]})]})},Te=n(532),_e=n(234),Se=n.n(_e),Ee=function(e){return e.Name?e.Name:e.name?e.name:e.Key?e.Key:e.key?e.key:""},Ce=function(e){return e.Address?e.Address:e.address?e.address:e.Val?e.Val:e.val?e.val:""},Ae=function(){var e=ue(),t=e.isLoadingAddresses,n=e.addresses;return Object(j.jsx)(v.a,{type:"default",icon:Object(j.jsx)(Te.a,{}),disabled:t,onClick:function(){var e,t=function(e){var t=e.map((function(e){return{name:e.key,address:e.val}}));return Se.a.unparse(t)}(n),s=new Blob([t],{type:"text/csv;charset=utf-8;"});e=window.URL.createObjectURL(s);var i=document.createElement("a");i.href=e,i.setAttribute("download","SavedAddresses.csv"),i.click()},children:"Export"})},Pe=n(533),ke=function(e){var t=e.showModal,n=ue().isLoadingAddresses;return Object(j.jsx)(v.a,{type:"default",icon:Object(j.jsx)(Pe.a,{}),disabled:n,onClick:t,children:"Import"})},Be=function(e){var t=e.isModalVisible,n=e.setIsModalVisible,s=e.setIsAddAddressesModalVisible,i=e.setInitialAddresses,r=ue().isLoadingAddresses,a=Object(o.useState)(),c=Object(S.a)(a,2),l=c[0],d=c[1],u=new FileReader,h=function(){n(!1)},b=function(){h()},f=function(e){e.preventDefault(),l&&(u.onload=function(e){var t=function(e){var t=Se.a.parse(e,{header:!0});return null===t||void 0===t?void 0:t.data.map((function(e){return{key:Ee(e),val:Ce(e)}}))}(e.target.result);i(t),h(),s(!0)},u.readAsText(l))};return Object(j.jsx)(O.a,{title:"Add Address Tags",visible:t,maskClosable:!1,onOk:f,onCancel:b,destroyOnClose:!0,footer:[Object(j.jsx)(v.a,{type:"link",onClick:b,children:"Cancel"},"cancel"),Object(j.jsx)(v.a,{type:"primary",loading:r,onClick:f,children:"Import"},"add")],children:Object(j.jsx)(K.b,{direction:"vertical",style:{width:"100%"},children:Object(j.jsx)("input",{type:"file",id:"csvFileInput",accept:".csv",onChange:function(e){d(e.target.files[0])}})})})},Re=n(534),we=function(){var e=ue(),t=e.fetchAddresses,n=e.isLoadingAddresses,s=e.resetAddressesInState;return Object(j.jsx)(v.a,{type:"link",icon:Object(j.jsx)(Re.a,{}),disabled:n,onClick:function(){s(),t()},children:"Sync"})},Ie=function(){var e=ue(),t=e.fetchAddresses,n=e.isLoadingAddresses,s=e.addresses,i=Object(o.useState)(!1),r=Object(S.a)(i,2),a=r[0],c=r[1],l=Object(o.useState)(!1),d=Object(S.a)(l,2),u=d[0],h=d[1],b=Object(o.useState)([{key:null,val:null}]),p=Object(S.a)(b,2),v=p[0],g=p[1];Object(o.useEffect)((function(){$()(s)&&!n&&t()}),[]);var O=[Object(j.jsx)(we,{},"sync-addresses-button"),Object(j.jsx)(he,{showModal:function(){return c(!0)}},"add-addresses-button"),Object(j.jsx)(ke,{showModal:function(){return h(!0)}},"import-addresses-button"),Object(j.jsx)(Ae,{},"export-addresses-button")];return Object(j.jsxs)(f,{children:[Object(j.jsx)(m.a,{title:"Address Tags",extra:O,bordered:!0,children:Object(j.jsx)(ye,{})}),Object(j.jsx)(pe,{isModalVisible:a,setIsModalVisible:c,initialAddresses:v}),Object(j.jsx)(Be,{isModalVisible:u,setIsAddAddressesModalVisible:c,setIsModalVisible:h,setInitialAddresses:g})]})},Ne=n(511),Le=n(535),De=n(536),Me=n(125),Ue=n(517),We=n(302),Ge=n(314),Fe=_.constants.PAGE_KEYS,Ke=function(e){var t=e.icon,n=e.title,s=e.body,i=e.link,r=e.goToPage;return Object(j.jsx)("div",{style:{flexGrow:1,flexBasis:0},children:Object(j.jsx)("a",{onClick:function(e){"settings"===i&&(e.preventDefault(),_.constants.BTC_PURPOSE_NONE!==Object(_.getBtcPurpose)()?r(Fe.WALLET):r(Fe.SETTINGS)),"address-tags"===i&&(e.preventDefault(),r(Fe.ADDRESS_TAGS))},href:i,className:"lattice-a",target:"_blank",rel:"noopener noreferrer",children:Object(j.jsxs)(m.a,{style:{height:"100%",width:"100%"},hoverable:!0,children:[Object(j.jsxs)("b",{style:{color:"#94B3FD"},children:[t,"\xa0",n]}),Object(j.jsx)("p",{children:Object(j.jsx)("i",{children:s})})]})})})},Ve=function(e){var t=e.goToPage,n=function(){var e=Object(o.useContext)(h.a).session.client.getFwVersion(),t=e.fix,n=e.minor,s=e.major;return Object.fromEntries(Object.entries({CAN_VIEW_CONTRACTS:[0,14,0],USES_AUTO_ABI:[0,15,0]}).map((function(e){var i=Object(S.a)(e,2),r=i[0],a=Object(S.a)(i[1],3),c=a[0],o=a[1],l=a[2];return[r,t>=c&&n>=o&&s>=l]})))}(),s=n.USES_AUTO_ABI;return Object(j.jsx)(f,{children:Object(j.jsxs)(m.a,{style:{textAlign:"center"},headStyle:{fontSize:"32px"},title:"Lattice Manager",children:[Object(j.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"30px",margin:"25px"},children:[Object(j.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center"},children:[Object(j.jsx)("div",{style:{width:"200px"},children:Object(j.jsx)("p",{style:{fontSize:"1.2em"},children:"Manage secure data on your Lattice hardware wallet device for a better web3 experience"})}),Object(j.jsx)("img",{src:"lattice-landing.png",style:{maxWidth:"250px"},alt:"lattice-one-device"})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h2",{children:"Features"}),Object(j.jsxs)("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[Object(j.jsx)(Ke,{title:"Address Tags",body:"Tag your favorite contracts or addresses",icon:Object(j.jsx)(Ne.a,{}),link:"address-tags",goToPage:t}),Object(j.jsx)(Ke,{title:"Bitcoin Wallet",body:"Check balances and send BTC transactions",icon:Object(j.jsx)(Ge.a,{icon:We.a}),link:"settings",goToPage:t})]})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h2",{children:"Resources"}),Object(j.jsxs)("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[Object(j.jsx)(Ke,{title:"@GridPlus",body:"Follow GridPlus on Twitter",icon:Object(j.jsx)(Le.a,{}),link:"https://twitter.com/GridPlus",goToPage:t}),Object(j.jsx)(Ke,{title:"GridPlus",body:"Subscribe to GridPlus on YouTube",icon:Object(j.jsx)(De.a,{}),link:"https://youtube.com/GridPlus",goToPage:t}),Object(j.jsx)(Ke,{title:"Documentation",body:"Learn more about your Lattice",icon:Object(j.jsx)(Me.a,{}),link:"https://docs.gridplus.io",goToPage:t}),Object(j.jsx)(Ke,{title:"SafeCards",body:"Backup or create new wallets",icon:Object(j.jsx)(Ue.a,{}),link:"https://gridplus.io/safecards",goToPage:t})]})]})]}),s?null:Object(j.jsx)(x.a,{style:{maxWidth:"500px",margin:"auto"},message:"Lattice firmware is out of date",description:Object(j.jsxs)("div",{style:{padding:"0 25px 0 25px"},children:[Object(j.jsx)("p",{children:"Please update immediately to receive automatic contract decoding, which ensures you know what you're signing."}),Object(j.jsxs)("div",{style:{margin:"auto",width:"66%",textAlign:"left"},children:[Object(j.jsx)("p",{children:"To update your firmware:"}),Object(j.jsxs)("ol",{children:[Object(j.jsx)("li",{children:"Unlock your device"}),Object(j.jsxs)("li",{children:["Tap ",Object(j.jsx)("strong",{children:"Settings"})]}),Object(j.jsxs)("li",{children:["Tap ",Object(j.jsx)("strong",{children:"Software Update"})]}),Object(j.jsxs)("li",{children:["Tap ",Object(j.jsx)("strong",{children:"Update"})]})]})]})]}),type:"warning",showIcon:!0})]})})},He=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"render",value:function(){var e=Object(j.jsx)("center",{children:Object(j.jsxs)(m.a,{title:"Loading",bordered:!0,children:[!1!==this.props.spin?Object(j.jsx)(w.a,{indicator:Object(j.jsx)(D.a,{})}):null,Object(j.jsx)("p",{children:this.props.msg?this.props.msg:"Waiting for data from your Lattice"}),this.props.onCancel?Object(j.jsx)(v.a,{type:"link",onClick:this.props.onCancel,children:"Cancel"}):null]})});return Object(j.jsx)(f,{content:e})}}]),n}(l.a.Component),Ye=He,ze=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).keyPressListener=s.keyPressListener.bind(Object(p.a)(s)),s.submit=s.submit.bind(Object(p.a)(s)),s}return Object(r.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("keypress",this.keyPressListener)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keypress",this.keyPressListener)}},{key:"keyPressListener",value:function(e){"Enter"===e.key&&this.submit()}},{key:"submit",value:function(){this.props.retryCb()}},{key:"render",value:function(){return Object(j.jsx)("center",{children:Object(j.jsxs)(m.a,{title:"Error",bordered:!0,children:[Object(j.jsx)("p",{children:this.props.msg}),this.props.retryCb?Object(j.jsx)(v.a,{id:"submitButton",onClick:this.submit,type:"danger",children:this.props.btnMsg||"Retry"}):null]})})}}]),n}(l.a.Component),Je=n(287),qe=n(526),Xe=n(309),Ze=n(509),Qe=n(524),$e=n(518),et=n(515),tt=n(514),nt=n(537),st=n(538),it=n(539),rt=n(237),at=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(i.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).context=e.context,e}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.props.session&&this.props.session.getBtcWalletData()}},{key:"getInnerWidth",value:function(){var e;return null===(e=document.getElementById("main-content-inner"))||void 0===e?void 0:e.offsetWidth}},{key:"ensureTrimmedText",value:function(e){if(!this.context.isMobile)return e;var t=this.getInnerWidth()/22;return e.length>t?"".concat(e.slice(0,t),"..."):e}},{key:"renderListItem",value:function(e){var t=Object(j.jsxs)("div",{align:this.context.isMobile?"left":"right",children:[e.confirmed?Object(j.jsxs)("p",{children:[e.incoming?"Received ":"Sent ",ot(e.timestamp)," ago"]}):null,Object(j.jsx)(v.a,{size:"small",href:"".concat(_.constants.BTC_TX_BASE_URL,"/").concat(e.id),target:"_blank",children:"View"})]});if(0===e.value)return Object(j.jsxs)(qe.b.Item,{children:[Object(j.jsx)(qe.b.Item.Meta,{avatar:Object(j.jsx)(Xe.a,{src:"/BTC.png"}),title:"Internal Transaction",description:"This transaction sender and recipient are your addresses."}),t]},e.hash);var n="".concat(e.value/Math.pow(10,8)," BTC"),s="\t".concat(this.ensureTrimmedText(e.recipient)),i=Object(j.jsx)(qe.b.Item.Meta,{avatar:Object(j.jsx)(Xe.a,{src:"/BTC.png"}),title:e.confirmed?Object(j.jsx)("p",{children:"".concat(n)}):Object(j.jsx)("p",{children:Object(j.jsx)("i",{children:"".concat(n)})}),description:e.confirmed?Object(j.jsxs)("p",{children:[e.incoming?Object(j.jsx)(et.a,{}):Object(j.jsx)(tt.a,{}),"".concat(s)]}):Object(j.jsxs)("p",{children:[e.incoming?Object(j.jsx)(et.a,{}):Object(j.jsx)(tt.a,{}),Object(j.jsx)("i",{children:"".concat(s)})]})});return this.context.isMobile?Object(j.jsxs)(qe.b.Item,{children:[Object(j.jsx)(d.a,{justify:"center",children:i}),Object(j.jsx)(d.a,{justify:"center",children:t})]},e.hash):Object(j.jsxs)(qe.b.Item,{children:[i,t]},e.hash)}},{key:"renderLastUpdatedTag",value:function(){if(this.props.session){var e=this.props.session.lastFetchedBtcData;if(!e)return Object(j.jsx)(Ze.a,{color:"red",children:"Never"});var t,n,s,i=Math.floor((new Date-e)/1e3);return i<60?(t="",n="seconds",s="green"):i<3600?(n=1===(t=Math.floor(i/60))?"min":"mins",s="green"):i<172800?(n=1===(t=Math.floor(i/3600))?"hour":"hours",s="orange"):(t=Math.floor(i/86400),n="days",s="red"),Object(j.jsx)(Ze.a,{color:s,children:"".concat(t," ").concat(n," ago")})}}},{key:"renderList",value:function(){var e=this,t={confirmed:this.props.session.getBtcTxs(),pending:this.props.session.getBtcTxs(!1)};return Object(j.jsxs)("div",{children:[t.pending.length>0?Object(j.jsx)(m.a,{title:Object(j.jsxs)("p",{children:[Object(j.jsx)(nt.a,{})," Pending"]}),bordered:!0,style:{margin:"0 0 30px 0"},children:Object(j.jsx)(qe.b,{itemLayout:"horizontal",dataSource:t.pending,renderItem:function(t){return e.renderListItem(t)}})}):null,Object(j.jsx)(m.a,{title:"Transactions",bordered:!0,children:Object(j.jsx)(qe.b,{itemLayout:"horizontal",dataSource:t.confirmed,renderItem:function(t){return e.renderListItem(t)}})})]})}},{key:"renderHeader",value:function(){var e=this.props.session.getBtcBalance()/_.constants.SATS_TO_BTC,t=this.props.session.btcPrice;return Object(j.jsxs)("div",{children:[Object(j.jsx)(d.a,{justify:"center",style:{margin:"20px 0 0 0"},children:Object(j.jsx)(Qe.a,{title:"Balance",value:"".concat(e," BTC")})}),Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(Qe.a,{title:"USD Value",value:e*t,precision:2})})]})}},{key:"renderPages",value:function(){var e=this,t=this.props.session.getPage(),n=this.props.session.getBtcTxs();return Object(j.jsxs)("center",{style:{margin:"20px 0 0 0"},children:[t>1?Object(j.jsx)(v.a,{onClick:function(){e.props.pageTurnCb(t-1)},children:Object(j.jsx)(st.a,{})}):null,n.length>=_.constants.PAGE_SIZE?Object(j.jsx)(v.a,{onClick:function(){e.props.pageTurnCb(t+1)},children:Object(j.jsx)(it.a,{})}):null]})}},{key:"renderStartCard",value:function(){var e=this;return Object(j.jsx)(m.a,{title:"BTC Wallet",bordered:!0,children:Object(j.jsxs)("center",{children:[Object(j.jsx)("p",{children:"You have not loaded any addresses yet."}),Object(j.jsx)(v.a,{size:"large",type:"primary",ghost:!0,onClick:function(){e.props.refreshData()},children:"Start"})]})})}},{key:"renderContent",value:function(){var e=this;return this.props.session.lastFetchedBtcData?Object(j.jsxs)("div",{children:[Object(j.jsxs)(m.a,{title:"BTC Wallet",bordered:!0,children:[Object(j.jsxs)(d.a,{justify:"center",children:["Last Update\xa0",this.renderLastUpdatedTag(),Object(j.jsxs)(v.a,{size:"small",type:"primary",ghost:!0,onClick:function(){e.props.refreshData()},children:["Refresh ",Object(j.jsx)(rt.a,{})]})]}),Object(j.jsx)(d.a,{justify:"center",style:{margin:"20px 0 0 0"},children:this.renderHeader()})]}),Object(j.jsx)($e.a,{}),Object(j.jsxs)("div",{children:[this.renderList(),this.renderPages()]})]}):this.renderStartCard()}},{key:"render",value:function(){var e=Object(j.jsx)("center",{children:this.renderContent()});return Object(j.jsx)(f,{content:e})}}]),n}(l.a.Component);at.contextType=h.a;var ct=at;function ot(e){var t=new Date(e),n=6e4,s=60*n,i=24*s,r=7*i,a=4*r,c=12*a,o=new Date-t;return o/n<1?"seconds":o/s<1?"".concat(Math.floor(o/n)," minutes"):o/i<1?"".concat(Math.floor(o/s)," hours"):o/r<1?"".concat(Math.floor(o/i)," days"):o/a<1?"".concat(Math.floor(o/r)," weeks"):o/c<1?"".concat(Math.floor(o/a)," months"):"".concat(Math.floor(o/c)," years")}var lt=n(521),dt=n(87),ut=n(124),ht=n(126),jt=n(58).Buffer,bt=n(13).validateBtcAddr,ft={ETH:{full:function(e){return pt(e,vt)},recipient:vt,value:gt},BTC:{full:function(e){return pt(e,bt)},recipient:bt,value:gt}};function pt(e,t){return!0===t(e.recipient)&&!0===gt(e.value)}function vt(e){if(""===e)return null;try{var t="0x"===e.slice(0,2),n=20===jt.from(e.slice(2),"hex").length;return!0===t&&!0===n}catch(s){return!1}}function gt(e){if(""===e)return!1;try{var t=Number(e);return!isNaN(t)&&t>=0}catch(n){return!1}}var Ot="recipient",xt="value",mt=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).context=s.context,s.state={recipient:"",value:null,recipientCheck:null,valueCheck:null,error:null,isLoading:!1,txHash:null,btcFeeRate:_.constants.BTC_DEFAULT_FEE_RATE,ensResolvedAddress:null},s.handleENSResolution=s.handleENSResolution.bind(Object(p.a)(s)),s.renderBanner=s.renderBanner.bind(Object(p.a)(s)),s.renderSubmitButton=s.renderSubmitButton.bind(Object(p.a)(s)),s.renderValueLabel=s.renderValueLabel.bind(Object(p.a)(s)),s.submit=s.submit.bind(Object(p.a)(s)),s.buildBtcRequest=s.buildBtcRequest.bind(Object(p.a)(s)),s.updateBtcFeeRate=s.updateBtcFeeRate.bind(Object(p.a)(s)),s}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this;fetch("https://blockstream.info/api/fee-estimates").then((function(e){return e.json()})).then((function(t){t[1]&&e.setState({btcFeeRate:Math.ceil(Number(t[1]))}),e.props.session&&e.props.session.getBtcWalletData()})).catch((function(e){console.error("Error from fetching fee rates: ".concat(e.toString()))}))}},{key:"handleENSResolution",value:function(e,t){return e||null===t?this.setState({recipientCheck:!1,ensResolvedAddress:null}):this.setState({recipientCheck:!0,ensResolvedAddress:t})}},{key:"updateRecipient",value:function(e){var t=e.target.value,n=ft.BTC.recipient(t);this.setState({recipient:t,ensResolvedAddress:null,recipientCheck:n})}},{key:"checkValue",value:function(e){var t=this.props.session.getBtcBalance()/_.constants.SATS_TO_BTC;return""===e||null===e||void 0===e?null:Number(t)>=Number(e)}},{key:"updateValue",value:function(e){var t=e.target.value,n=Number(t),s="0"===t[0],i=s&&"."===t[1];if("0"===t);else if(isNaN(n)){if("."!==t)return;t="0"+t}else s&&!i&&(t=t.slice(1));this.setState({value:t,valueCheck:this.checkValue(t)})}},{key:"updateBtcFeeRate",value:function(e){this.setState({btcFeeRate:e})}},{key:"buildBtcRequest",value:function(){var e=Object(_.buildBtcTxReq)(this.state.recipient,this.state.value,this.props.session.btcUtxos,this.props.session.addresses.BTC,this.props.session.addresses.BTC_CHANGE,this.state.btcFeeRate,this.state.value===this.calculateMaxValue());return e.error?(this.setState({error:e.error}),null):e.data?e:(this.setState({error:"Invalid response when building BTC transaction request. "}),null)}},{key:"submit",value:function(){var e=this,t=this.buildBtcRequest();t&&(ce.a.open({message:"Waiting for signature...",key:"signNotification",description:"We have sent the transaction to your Lattice for signing.\n                      After approval, the transaction will be broadcast.",duration:0}),this.setState({isLoading:!0}),this.props.session.sign(t).then((function(t){e.setState({recipient:"",recipientCheck:null,value:null,valueCheck:null,txHash:t,error:null,isLoading:!1})})).catch((function(t){e.setState({error:t,isLoading:!1,txHash:null}),console.error(t)})).finally((function(){ce.a.close("signNotification")})))}},{key:"getUrl",value:function(){return"".concat(_.constants.BTC_TX_BASE_URL,"/").concat(this.state.txHash)}},{key:"renderValueLabelTitle",value:function(){var e=this;return Object(j.jsxs)("p",{style:{textAlign:"left"},children:[Object(j.jsx)("b",{children:"Value"}),Object(j.jsx)(v.a,{type:"link",onClick:function(){e.updateValue({target:{value:e.calculateMaxValue()}})},children:"Max"}),this.renderIcon(xt)]})}},{key:"renderValueLabel",value:function(){var e=Object(j.jsx)(g.a,{type:"text",id:xt,value:this.state.value,onChange:this.updateValue.bind(this)});return Object(j.jsxs)(d.a,{justify:"center",children:[this.renderValueLabelTitle(),e]})}},{key:"renderRecipientLabel",value:function(){return Object(j.jsxs)(d.a,{justify:"center",children:[Object(j.jsxs)("p",{style:{textAlign:"left"},children:[Object(j.jsx)("b",{children:"Recipient"}),"\xa0\xa0\xa0",this.renderIcon(Ot)]}),Object(j.jsx)(g.a,{type:"text",id:Ot,value:this.state.recipient,onChange:this.updateRecipient.bind(this)})]})}},{key:"renderIcon",value:function(e){var t="".concat(e,"Check"),n=this.state[t];return!0===n?Object(j.jsx)(ut.a,{style:{color:"green"}}):!1===n?Object(j.jsx)(ht.a,{style:{color:"red"}}):void 0}},{key:"renderBanner",value:function(){var e=this;if(this.state.error){var t,n=null!==(t=this.state.error)&&void 0!==t&&t.message?this.state.error.message:this.state.error;return Object(j.jsx)(x.a,{message:"Failed to Send Transaction",description:n,type:"error",closable:!0,onClose:function(){e.setState({error:null})}})}if(this.state.txHash){var s=this.context.isMobile?Object(j.jsxs)("p",{children:["Transaction signed and broadcast successfully.\xa0",Object(j.jsx)("a",{className:"lattice-a",target:"_blank",rel:"noopener noreferrer",href:this.getUrl(),children:"View"})]}):Object(j.jsx)("p",{children:"Your transaction was signed and broadcast successfully. Please return to your History tab and refresh to see status."});return Object(j.jsx)(x.a,{type:"success",message:"Success",description:s})}}},{key:"renderExtra",value:function(){return Object(j.jsxs)("div",{children:[Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)("b",{children:Object(j.jsx)("p",{children:"Fee (sat/byte):"})})}),Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(lt.a,{min:1,max:100,onChange:this.updateBtcFeeRate,value:this.state.btcFeeRate})})]})}},{key:"calculateMaxValue",value:function(){var e=this.props.session.getBtcBalance(),t=this.props.session.getBtcUtxos(),n=Object(_.getBtcNumTxBytes)(t.length),s=Math.floor(this.state.btcFeeRate*n);return Math.max(((e-s)/_.constants.SATS_TO_BTC).toFixed(8),0)}},{key:"renderSubmitButton",value:function(){var e=!0===this.state.valueCheck&&(ft.BTC.full(this.state)||null!==this.state.ensResolvedAddress);return this.state.isLoading?Object(j.jsx)(v.a,{type:"primary",style:{margin:"30px 0 0 0"},loading:!0,children:"Waiting..."}):e?Object(j.jsx)(v.a,{type:"primary",onClick:this.submit,style:{margin:"30px 0 0 0"},children:"Send"}):Object(j.jsx)(v.a,{type:"primary",style:{margin:"30px 0 0 0"},disabled:!0,children:"Send"})}},{key:"renderBalance",value:function(){var e=this.props.session.getBtcBalance()/_.constants.SATS_TO_BTC;return Object(j.jsx)(d.a,{justify:"center",style:{margin:"0 0 20px 0"},children:Object(j.jsx)(Qe.a,{title:"Balance",value:"".concat(e," BTC")})})}},{key:"renderCard",value:function(){return!!this.props.session.addresses.BTC&&this.props.session.addresses.BTC.length>0?Object(j.jsxs)("div",{children:[this.renderBalance(),Object(j.jsx)("div",{children:this.renderRecipientLabel()}),Object(j.jsx)("div",{style:{margin:"20px 0 0 0"},children:this.renderValueLabel()}),Object(j.jsx)("div",{style:{margin:"20px 0 0 0"},children:this.renderExtra()}),this.renderSubmitButton()]}):Object(j.jsxs)("div",{children:[Object(j.jsx)("p",{children:"No addresses found from your Lattice. If you have your wallet setup, please try logging out and reconnecting."}),Object(j.jsx)(dt.a,{image:dt.a.PRESENTED_IMAGE_SIMPLE})]})}},{key:"render",value:function(){var e=Object(j.jsxs)("center",{children:[this.renderBanner(),Object(j.jsx)(m.a,{title:"Send BTC",bordered:!0,children:this.renderCard()})]});return Object(j.jsx)(f,{content:e})}}]),n}(l.a.Component);mt.contextType=h.a;var yt=mt,Tt=n(540),_t=n(305),St=g.a.Search,Et=g.a.TextArea,Ct="address-data",At=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s,r;return Object(i.a)(this,n),(r=t.call(this,e)).context=r.context,r.state={address:null,windowWidth:null===(s=document.getElementById("main-content-inner"))||void 0===s?void 0:s.offsetWidth},r.updateWidth=r.updateWidth.bind(Object(p.a)(r)),r}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.updateDisplayAddress(),this.props.session&&this.props.session.getBtcWalletData(),window.addEventListener("resize",this.updateWidth)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWidth)}},{key:"updateWidth",value:function(){var e;this.setState({windowWidth:null===(e=document.getElementById("main-content-inner"))||void 0===e?void 0:e.offsetWidth})}},{key:"updateDisplayAddress",value:function(){var e=this.props.session.getBtcDisplayAddress();e&&this.setState({address:e})}},{key:"copyAddress",value:function(){document.getElementById(Ct).select(),document.execCommand("copy")}},{key:"renderAddrBox",value:function(){return this.context.isMobile?Object(j.jsxs)("div",{children:[Object(j.jsx)(Et,{id:Ct,value:this.state.address,autoSize:{minRows:1,maxRows:3},style:{margin:"30px 0 0 0",textAlign:"center"}}),Object(j.jsxs)(v.a,{type:"primary",style:{margin:"20px 0 0 0"},onClick:this.copyAddress,children:["Copy ",Object(j.jsx)(Tt.a,{})]})]}):Object(j.jsx)(St,{type:"text",id:Ct,value:this.state.address,enterButton:Object(j.jsx)(Tt.a,{}),onSearch:this.copyAddress,style:{margin:"30px 0 0 0",textAlign:"center"}})}},{key:"renderCard",value:function(){if(this.state.address){var e;if(!Object(_.validateBtcAddr)(this.state.address))return;var t=null===(e=document.getElementById("receive-card"))||void 0===e?void 0:e.offsetWidth,n=Math.min(300,.8*t);return Object(j.jsxs)("div",{children:[Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(_t.a,{value:this.state.address,size:n,style:{margin:"30px 0 0 0"}})}),Object(j.jsx)(d.a,{justify:"center",children:this.renderAddrBox()})]})}return Object(j.jsxs)("div",{children:[Object(j.jsx)("p",{children:"No addresses found"}),Object(j.jsx)(dt.a,{image:dt.a.PRESENTED_IMAGE_SIMPLE})]})}},{key:"render",value:function(){var e=Object(j.jsx)("center",{children:Object(j.jsx)(m.a,{title:"Receive BTC",bordered:!0,id:"receive-card",children:Object(j.jsx)("center",{children:this.renderCard()})})});return Object(j.jsx)(f,{content:e})}}]),n}(l.a.Component);At.contextType=h.a;var Pt=At}},[[503,1,2]]]);
//# sourceMappingURL=main.1e188fb7.chunk.js.map