(this["webpackJsonplattice-manager"]=this["webpackJsonplattice-manager"]||[]).push([[0],{13:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"constants",(function(){return c})),n.d(t,"fetchBtcUtxos",(function(){return b})),n.d(t,"fetchBtcTxs",(function(){return p})),n.d(t,"fetchBtcPrice",(function(){return g})),n.d(t,"broadcastBtcTx",(function(){return O})),n.d(t,"harden",(function(){return x})),n.d(t,"getBtcPurpose",(function(){return T})),n.d(t,"getBtcNumTxBytes",(function(){return _})),n.d(t,"buildBtcTxReq",(function(){return S})),n.d(t,"validateBtcAddr",(function(){return C})),n.d(t,"toHexStr",(function(){return E})),n.d(t,"filterUniqueObjects",(function(){return B}));var s=n(35),i=n(279),r=n(278).bech32,a=2147483648,c={DEFAULT_APP_NAME:"Lattice Manager",ENV:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENV||"prod",BASE_SIGNING_URL:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BASE_SIGNING_URL||"https://signing.gridpl.us",BTC_PROD_DATA_API:"https://blockchain.info",BTC_BROADCAST_ENDPOINT:"https://blockstream.info/api/tx",HARDENED_OFFSET:a,ASYNC_SDK_TIMEOUT:6e4,ADDRESSES_PER_PAGE:10,CONTRACTS_PER_PAGE:10,SHORT_TIMEOUT:3e4,BTC_COIN:parseInt(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BTC_COIN)||a,SATS_TO_BTC:Math.pow(10,8),BTC_MAIN_GAP_LIMIT:20,BTC_CHANGE_GAP_LIMIT:1,BTC_ADDR_BLOCK_LEN:10,BTC_CHANGE_ADDR_BLOCK_LEN:1,BTC_DEFAULT_FEE_RATE:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BTC_DEFAULT_FEE_RATE||10,BTC_TX_BASE_URL:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BTC_TX_BASE_URL||"https://www.blockchain.com/btc/tx",PAGE_SIZE:20,CONTRACT_PAGE_SIZE:6,LOST_PAIRING_ERR:"NOT_PAIRED",LOST_PAIRING_MSG:"Cannot find Lattice connection. Please re-connect.",BTC_TESTNET:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BTC_TESTNET||null,KEYRING_LOGOUT_MS:parseInt(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).KEYRING_LOGOUT_MS)||2592e6,KEYRING_DATA_PATH:"gridplus_web_wallet_keyring_logins",ABI_PACK_URL:"https://gridplus.github.io/abi-pack-framework",LATTICE_CERT_SIGNER:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_LATTICE_CERT_SIGNER||"0477816e8e83bb17c4309cc2e5aa134c573a5943154940095a423149f7cc0384ad52d33f1b4cd89c967bf211c039202df3a7899cb7543de4738c96a81cfde4b117",CONTRACTS_HELP_LINK:"https://docs.gridplus.io/gridplus-web-wallet/use-ethereum-smart-contract-abi-function-definitions",TAGS_HELP_LINK:"https://docs.gridplus.io/gridplus-web-wallet/address-tags",PERMISSIONS_HELP_LINK:"https://docs.gridplus.io/gridplus-web-wallet/how-to-set-and-use-spending-limits",BTC_WALLET_STORAGE_KEY:"btc_wallet",BTC_PURPOSE_NONE:-1,BTC_PURPOSE_NONE_STR:"Hide BTC Wallet",BTC_PURPOSE_LEGACY:2147483692,BTC_PURPOSE_LEGACY_STR:"Legacy (1)",BTC_PURPOSE_WRAPPED_SEGWIT:2147483697,BTC_PURPOSE_WRAPPED_SEGWIT_STR:"Wrapped Segwit (3)",BTC_PURPOSE_SEGWIT:2147483732,BTC_PURPOSE_SEGWIT_STR:"Segwit (bc1)",BTC_SEGWIT_NATIVE_V0_PREFIX:"bc",BTC_LEGACY_VERSION:0,BTC_WRAPPED_SEGWIT_VERSION:5,RATE_LIMIT:2e3,THROTTLE_RATE_LIMIT:5e3,GET_ABI_URL:"https://api.etherscan.io/api?module=contract&action=getabi&address=",DEFAULT_CONTRACT_NETWORK:"ethereum",CONTRACT_NETWORKS:{ethereum:{label:"Ethereum",url:"https://etherscan.io",baseUrl:"https://api.etherscan.io",apiRoute:"api?module=contract&action=getabi&address="},arbitrum:{label:"Arbitrum",url:"https://arbiscan.io",baseUrl:"https://api.arbiscan.io",apiRoute:"api?module=contract&action=getabi&address="},polygon:{label:"Polygon",url:"https://polygonscan.com",baseUrl:"https://api.polygonscan.com",apiRoute:"api?module=contract&action=getabi&address="},optimism:{label:"Optimism",url:"https://optimistic.etherscan.io",baseUrl:"https://api-optimistic.etherscan.io",apiRoute:"api?module=contract&action=getabi&address="},binance:{label:"Binance",url:"https://bscscan.com/",baseUrl:"https://api.bscscan.com",apiRoute:"api?module=contract&action=getabi&address="},avalanche:{label:"Avalanche",url:"https://snowtrace.io",baseUrl:"https://api.snowtrace.io",apiRoute:"api?module=contract&action=getabi&address="}}},o={BTC_DEV_DATA_API:"https://blockstream.info/testnet/api",BTC_BROADCAST_ENDPOINT:"https://blockstream.info/testnet/api/tx",BASE_SIGNING_URL:"https://signing.staging-gridpl.us",BTC_COIN:2147483649,BTC_DEFAULT_FEE_RATE:10,BTC_TX_BASE_URL:"https://www.blockchain.com/btc-testnet/tx",BTC_TESTNET:"Testnet3",LATTICE_CERT_SIGNER:"045cfdf77a00b4b6b4a5b8bb26b5497dbc7a4d01cbefd7aaeaf5f6f8f8865976e7941ab0ec1651209c444009fd48d925a17de5040ba47eaf3f5b51720dd40b2f9d",BTC_SEGWIT_NATIVE_V0_PREFIX:"tb",BTC_LEGACY_VERSION:111,BTC_WRAPPED_SEGWIT_VERSION:196};function l(e,t,n){fetch(e,t).then((function(e){return e.json()})).then((function(e){return n(null,e)})).catch((function(e){return n(e)}))}s.a.getSettings().devLattice&&Object.keys(o).forEach((function(e){c[e]=o[e]}));var d=function(e){return new Promise((function(t){return setTimeout(t,e)}))};var u=function(e,t){var n=Promise.resolve();return function(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];var a=n.then((function(){return e.apply(void 0,i)}));return n=n.then((function(){return d(t)})),a}}(l,c.THROTTLE_RATE_LIMIT);function h(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(0===e.length)return t(null,n);for(var i=20,r=50,a=e.slice(0,i),o="".concat(c.BTC_PROD_DATA_API,"/unspent?active="),d=0;d<a.length;d++)o=0===d?"".concat(o).concat(a[d]):"".concat(o,"|").concat(a[d]);o="".concat(o,"&limit=").concat(r,"&confirmations=1"),s>0&&(o="".concat(o,"&offset=").concat(s)),l(o,null,(function(a,o){return a?t(a):(o.unspent_outputs.forEach((function(e){e.confirmations>0&&n.push({id:e.tx_hash_big_endian,vout:e.tx_output_n,value:e.value,address:m(e.script)})})),o.unspent_outputs.length>=r?setTimeout((function(){h(e,t,n,s+r)}),c.RATE_LIMIT):(e=e.slice(i),void setTimeout((function(){h(e,t,n,0)}),c.RATE_LIMIT)))}))}function j(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=e.pop(),i="".concat(c.BTC_DEV_DATA_API,"/address/").concat(s,"/utxo");l(i,null,(function(i,r){return i?t(i):(r.forEach((function(e){e.status.confirmed&&n.push({id:e.txid,vout:e.vout,value:e.value,address:s})})),0===e.length?t(null,n):void setTimeout((function(){j(e,t,n)}),c.RATE_LIMIT))}))}function b(e,t){if(!e)return t("Cannot fetch UTXOs - bad input");if(e.length<1)return t(null,[]);var n=JSON.parse(JSON.stringify(e));(c.BTC_DEV_DATA_API?j:h)(n,t)}function f(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(0===e.length)return n(null,t);var r="".concat(c.BTC_PROD_DATA_API,"/multiaddr?active="),a=l,o=i&&1===e.length;o&&(r="".concat(c.BTC_PROD_DATA_API,"/rawaddr/"));for(var d=20,h=50,j=e.slice(0,d),b=0;b<j.length;b++)r=0===b?"".concat(r).concat(j[b]):"".concat(r,"|").concat(j[b]);o?(r="".concat(r,"?limit=").concat(h),a=u):r="".concat(r,"&n=").concat(h),s>0&&(r="".concat(r,"&offset=").concat(s)),a(r,null,(function(i,r){if(i)return n(i);var a=0;if(r.txs.forEach((function(e){var n={timestamp:1e3*e.time,confirmed:!!e.block_index,id:e.hash,fee:e.fee,inputs:[],outputs:[]};e.inputs.forEach((function(e){n.inputs.push({addr:e.prev_out.addr,value:e.prev_out.value})})),e.out.forEach((function(e){n.outputs.push({addr:e.addr,value:e.value})})),n.confirmed||(n.timestamp=-1),t.every((function(e){return e.id!==n.id}))&&(t.push(n),a+=1)})),a>=h)return setTimeout((function(){f(e,t,n,s+h,!1)}),c.RATE_LIMIT);e=e.slice(d),setTimeout((function(){f(e,t,n,0,!1)}),c.RATE_LIMIT)}))}function v(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=e.pop(),r="".concat(c.BTC_DEV_DATA_API,"/address/").concat(i,"/txs");s&&(r="".concat(r,"/chain/").concat(s)),l(r,null,(function(s,r){if(s)return n(s);var a=[],o=0;return r.forEach((function(e){var t={timestamp:1e3*e.status.block_time,confirmed:e.status.confirmed,id:e.txid,fee:e.fee,inputs:[],outputs:[]};e.vin.forEach((function(e){t.inputs.push({addr:e.prevout.scriptpubkey_address,value:e.prevout.value})})),e.vout.forEach((function(e){t.outputs.push({addr:e.scriptpubkey_address,value:e.value})})),t.confirmed||(t.timestamp=-1),a.push(t),t.confirmed&&(o+=1)})),t=t.concat(a),o>=25?(e.push(i),v(e,t,n,t[o-1].id)):0===e.length?n(null,t):void setTimeout((function(){v(e,t,n)}),c.RATE_LIMIT)}))}function p(e,t,n){if(!e)return n("Cannot fetch transactions - bad input");if(e.length<1)return n(null,[]);var s=JSON.parse(JSON.stringify(e));(c.BTC_DEV_DATA_API?v:f)(s,t,n)}function g(e){l("https://api.blockchain.com/v3/exchange/tickers/BTC-USD",null,(function(t,n){return t?e(t):n&&n.last_trade_price?e(null,n.last_trade_price):e("Invalid price data returned")}))}function O(e,t){var n={method:"POST",body:e};fetch(c.BTC_BROADCAST_ENDPOINT,n).then((function(e){return e.text()})).then((function(e){return t(null,e)})).catch((function(e){return t(e)}))}function x(e){return e+a}function y(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(s>=e.length)return-1;i+=e[s].value;var r=s+1,a=_(r),c=Math.floor(n*a);return i>=t+c?r:y(e,t,n,s=r,i)}function m(t){var n=T();if(n===c.BTC_PURPOSE_SEGWIT){var s=c.BTC_SEGWIT_NATIVE_V0_PREFIX,a=e.from(t,"hex").slice(-20),o=r.toWords(a);return o.unshift(0),r.encode(s,o)}if(n===c.BTC_PURPOSE_WRAPPED_SEGWIT){var l=c.BTC_WRAPPED_SEGWIT_VERSION,d=e.from(t,"hex").slice(2,22);return i.encode(e.concat([e.from([l]),d]))}if(n===c.BTC_PURPOSE_LEGACY){var u=c.BTC_LEGACY_VERSION,h=e.from(t,"hex").slice(3,23);return i.encode(e.concat([e.from([u]),h]))}}function T(){var e=s.a.getSettings();return e.btcPurpose?e.btcPurpose:c.BTC_PURPOSE_NONE}function _(e){var t,n,s,i=T();i===c.BTC_PURPOSE_LEGACY?(t=148,n=32,s=0):i===c.BTC_PURPOSE_SEGWIT?(t=91,n=32,s=107):(t=67.75,n=31,s=107);var r=i===c.BTC_PURPOSE_LEGACY?0:.75;return 3*r+(10+r+t*e+2*n)+s*e}function S(e,t,n,s,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:c.BTC_DEFAULT_FEE_RATE,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!s||!i||s.length<1||i.length<1)return{error:"No addresses (or change addresses). Please wait to sync."};var o=Math.round(Number(t)*c.SATS_TO_BTC),l=a?n.length:y(n,o,r);if(l<0)return{error:"Balance too low."};if(l>n.length)return{error:"Failed to build transaction."};for(var d=_(l),u=Math.floor(d*r),h=[T(),c.BTC_COIN,c.HARDENED_OFFSET],j=[],b=0;b<l;b++){var f=n[b],v=null;if(s.indexOf(f.address)>-1)v=h.concat([0,s.indexOf(f.address)]);else{if(!(i.indexOf(f.address)>-1))return{error:"Failed to find holder of UTXO. Syncing issue likely."};v=h.concat([1,i.indexOf(f.address)])}var p={txHash:f.id,value:f.value,index:f.vout,signerPath:v};j.push(p)}var g={prevOuts:j,recipient:e,value:o,fee:u,changePath:h.concat([1,i.length-1])};return{currency:"BTC",data:g}}function C(e){if(""===e)return null;try{return i.decode(e),!0}catch(t){try{return r.decode(e),!0}catch(t){return!1}}}function E(e){var t=e.toString(16),n=t.length%2===0?t:"0".concat(t);return"0x".concat(n)}function B(e,t){var n=[];return JSON.parse(JSON.stringify(e)).reverse().forEach((function(e){var s=!1;n.forEach((function(n){var i=0;t.forEach((function(t){n[t]===e[t]&&(i+=1)})),i>=t.length&&(s=!0)})),s||n.push(e)})),n.reverse()}}.call(this,n(21).Buffer)},158:function(e,t,n){},273:function(e,t,n){"use strict";(function(e){var s=n(10),i=n(11),r=n(20),a=n(16),c=n(15),o=n(0),l=n.n(o),d=(n(51),n(158),n(136)),u=n(105),h=n(45),j=n(82),b=n(633),f=n(635),v=n(636),p=n(637),g=n(638),O=n(639),x=n(640),y=n(641),m=n(642),T=n(272),_=n(643),S=n(271),C=n(363),E=n(49),B=n(13),A=n(35),k=n(38),P=n(4),R=d.a.Content,I=d.a.Footer,w=d.a.Sider,L="loginCache",N="menu-landing",D=function(t){Object(a.a)(o,t);var n=Object(c.a)(o);function o(e){var t;Object(s.a)(this,o),(t=n.call(this,e)).context=t.context;var i=new URLSearchParams(window.location.search).get("keyring");return t.state={name:B.constants.DEFAULT_APP_NAME,menuItem:N,session:null,collapsed:!1,error:{msg:null,cb:null},loading:!1,pendingMsg:null,waiting:!1,onCancel:null,deviceID:null,password:null,lastUpdated:new Date,windowWidth:window.innerWidth,walletIsExternal:null,keyringName:i,openedByKeyring:!!i,hwCheck:null},t.handleMenuChange=t.handleMenuChange.bind(Object(r.a)(t)),t.handleLogout=t.handleLogout.bind(Object(r.a)(t)),t.handleKeyringOpener=t.handleKeyringOpener.bind(Object(r.a)(t)),t.syncActiveWalletState=t.syncActiveWalletState.bind(Object(r.a)(t)),t.cancelConnect=t.cancelConnect.bind(Object(r.a)(t)),t.connectSession=t.connectSession.bind(Object(r.a)(t)),t.handlePair=t.handlePair.bind(Object(r.a)(t)),t.fetchBtcData=t.fetchBtcData.bind(Object(r.a)(t)),t.setError=t.setError.bind(Object(r.a)(t)),t.refreshWallets=t.refreshWallets.bind(Object(r.a)(t)),t.handlePageTurn=t.handlePageTurn.bind(Object(r.a)(t)),t.retry=t.retry.bind(Object(r.a)(t)),t.updateWidth=t.updateWidth.bind(Object(r.a)(t)),t}return Object(i.a)(o,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.updateWidth),this.isMobile()&&this.setState({collapsed:!0});var t=new URLSearchParams(window.location.search),n=this.state.keyringName,s=t.get("hwCheck"),i=t.get("forceLogin");if(t.get(L))this.setState({waiting:!0,pendingMsg:"Connecting..."});else if(n)window.onload=this.handleKeyringOpener(),this.setState({keyringName:n},(function(){var t=A.a.getKeyringItem(n),s=(new Date).getTime()-B.constants.KEYRING_LOGOUT_MS;!i&&t&&t.lastLogin>s?e.connect(t.deviceID,t.password,(function(){return e.connectSession(t)})):A.a.removeKeyringItem(n)}));else if(s)this.setState({hwCheck:s});else{var r=A.a.getLogin(),a=r.deviceID,c=r.password;a&&c&&this.connect(a,c,(function(){return e.connectSession()}))}}},{key:"componentDidUpdate",value:function(){this.context.session&&this.syncActiveWalletState()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWidth)}},{key:"updateWidth",value:function(){this.setState({windowWidth:window.innerWidth}),this.isMobile()&&!this.state.collapsed?this.setState({collapsed:!0}):!this.isMobile()&&this.state.collapsed&&this.setState({collapsed:!1})}},{key:"isMobile",value:function(){return this.context.isMobile}},{key:"connect",value:function(e,t,n){var s={deviceID:e,password:t},i=this.state.keyringName?this.state.keyringName:this.state.name;if(!this.context.session){var r=A.a.getSettings();this.context.setSession(new C.a(e,this.setError,i,r))}this.setState(s,n)}},{key:"cancelConnect",value:function(){this.context.session&&this.context.session.client&&this.context.session.client.pair("",(function(){})),this.setState({deviceID:null,password:null,session:null}),this.unwait()}},{key:"isConnected",value:function(){return!!this.context.session&&this.context.session.isConnected()}},{key:"handleKeyringOpener",value:function(){this.setState({openedByKeyring:!0})}},{key:"returnKeyringData",value:function(){if(this.state.openedByKeyring){A.a.setKeyringItem(this.state.keyringName,{deviceID:this.state.deviceID,password:this.state.password,lastLogin:(new Date).getTime()});var t={deviceID:this.state.deviceID,password:this.state.password,endpoint:B.constants.BASE_SIGNING_URL},n=A.a.getSettings();if(n.customEndpoint&&""!==n.customEndpoint&&(t.endpoint=n.customEndpoint),this.handleLogout(),window.opener)window.opener.postMessage(JSON.stringify(t),"*"),window.close();else{var s=e.from(JSON.stringify(t)).toString("base64");window.location.href="".concat(window.location.href,"&").concat(L,"=").concat(s)}}}},{key:"wait",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.setState({pendingMsg:e,waiting:!0,onCancel:t})}},{key:"unwait",value:function(){this.setState({pendingMsg:null,waiting:!1,onCancel:null})}},{key:"handlePageTurn",value:function(e){this.context.session.setPage(e)}},{key:"handleMenuChange",value:function(e){var t={menuItem:e.key};this.isMobile()&&(t.collapsed=!0),this.setState(t)}},{key:"handleLogout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.unwait(),this.context.session.disconnect(),this.setState({session:null}),A.a.removeLogin(),e&&e===B.constants.LOST_PAIRING_MSG&&this.setError({err:e})}},{key:"setError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{msg:null,cb:null};if(e.msg===B.constants.LOST_PAIRING_ERR)return this.handleLostPairing();this.setState({error:e,loading:!1})}},{key:"connectSession",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=t.deviceID,i=t.password;if(!s||!i)return this.setError({msg:"You must provide a deviceID and password. Please refresh and log in again. "});this.setError(),this.connect(s,i,(function(){!0===n&&e.wait("Looking for your Lattice",e.cancelConnect),e.context.session.connect(s,i,(function(n,r){if(e.unwait(),e.context.session&&e.state.deviceID===s)if(n)e.setError({msg:n,cb:function(){e.connectSession(t)}});else if(e.state.openedByKeyring||A.a.setLogin({deviceID:s,password:i}),e.setError(),r&&e.state.openedByKeyring)return e.returnKeyringData()}))}))}},{key:"fetchBtcData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.unwait(),this.setError(),this.wait("Fetching addresses"),this.context.session.fetchBtcAddresses((function(n,s){if(n)return console.error("Error fetching BTC addresses",n),e.unwait(),void e.setError({msg:"Failed to fetch BTC addresses. Please try again.",cb:e.fetchBtcData});if(e.unwait(),!(t&&0===s.regular&&0===s.change)){t||e.context.session.clearUtxos(),e.wait("Syncing chain data");var i=t?s:null;e.context.session.fetchBtcStateData(i,(function(t){if(t)return console.error("Error fetching BTC state data",t),e.unwait(),void e.setError({msg:"Failed to fetch BTC state data. Please try again.",cb:e.fetchBtcData});e.fetchBtcData(!0)}))}}))}},{key:"handleLostPairing",value:function(){var e=this;this.context.session.client.pair("x",(function(){e.handleLogout(B.constants.LOST_PAIRING_MSG)}))}},{key:"refreshWallets",value:function(){var e=this;!0!==this.state.waiting&&(this.wait("Refreshing wallets"),this.setState({waiting:!0}),this.context.session.refreshWallets((function(t){return t===B.constants.LOST_PAIRING_ERR?e.handleLostPairing():(e.syncActiveWalletState(!0),e.unwait(),t?e.setError({msg:t,cb:e.refreshWallets}):(e.setError(),void(B.constants.BTC_PURPOSE_NONE!==Object(B.getBtcPurpose)()&&e.fetchBtcData())))})))}},{key:"syncActiveWalletState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.context.session.getActiveWallet();if(t){var n=t.external;if(this.state.walletIsExternal!==n){var s=null!==this.state.walletIsExternal;this.setState({walletIsExternal:n}),!0===s&&!0!==e&&this.refreshWallets()}}}},{key:"handlePair",value:function(e){var t=this;"_"!==e[0]&&"["!==e[0]||(e=e.slice(1)),this.wait("Establishing connection with your Lattice"),this.context.session.client.pair(e,(function(e){if(t.unwait(),e){t.setError({msg:"Failed to pair. You either entered the wrong code or have already connected to this app.",cb:t.connectSession})}else t.state.openedByKeyring&&t.returnKeyringData()}))}},{key:"renderMenu",value:function(){var e=B.constants.BTC_PURPOSE_NONE===Object(B.getBtcPurpose)();return Object(P.jsx)(w,{collapsed:this.state.collapsed,collapsedWidth:0,children:Object(P.jsx)(u.a,{theme:"dark",mode:"inline",onSelect:this.handleMenuChange,items:function(){var t=[{key:"menu-landing",label:"Home",icon:Object(P.jsx)(v.a,{})},{key:"menu-kv-records",label:"Address Tags",icon:Object(P.jsx)(p.a,{})},{key:"menu-settings",label:"Settings",icon:Object(P.jsx)(g.a,{})}];return e||t.push({key:"submenu-wallet",label:"BTC Wallet",children:[{key:"menu-wallet",label:"History",icon:Object(P.jsx)(O.a,{})},{key:"menu-send",label:"Send",icon:Object(P.jsx)(x.a,{})},{key:"menu-receive",label:"Receive",icon:Object(P.jsx)(y.a,{})}]}),t}()})})}},{key:"renderSidebar",value:function(){if(this.state.name===B.constants.DEFAULT_APP_NAME)return this.isConnected()?this.renderMenu():void 0}},{key:"renderHeaderText",value:function(){var e=this;return Object(P.jsxs)(P.Fragment,{children:[this.isMobile()?Object(P.jsx)(h.a,{onClick:function(){return e.setState({collapsed:!e.state.collapsed})},type:"text",size:"large",icon:Object(P.jsx)(m.a,{}),style:{backgroundColor:"transparent",marginRight:"5px"}}):null,Object(P.jsx)("a",{className:"lattice-a",href:"https://gridplus.io",target:"_blank",rel:"noopener noreferrer",children:Object(P.jsx)("img",{alt:"GridPlus",src:"/gridplus-logo.png",style:{height:"1em"}})})]})}},{key:"renderHeader",value:function(){if(this.state.name===B.constants.DEFAULT_APP_NAME){var e=[];if(this.isConnected()){var t=null,n=this.isMobile()?"small":"middle",s=this.context.session.getActiveWallet();return(t=null===s?Object(P.jsxs)(h.a,{type:"danger",ghost:!0,onClick:this.refreshWallets,size:n,children:["No Wallet ",Object(P.jsx)(T.a,{})]}):!0===s.external?Object(P.jsxs)(h.a,{type:"primary",ghost:!0,onClick:this.refreshWallets,size:n,children:[Object(P.jsx)(_.a,{})," SafeCard ",Object(P.jsx)(T.a,{})]}):Object(P.jsxs)(h.a,{type:"default",ghost:!0,onClick:this.refreshWallets,size:n,children:[Object(P.jsx)(S.a,{})," Lattice ",Object(P.jsx)(T.a,{})]}))&&e.push(Object(P.jsx)(j.a,{title:"Refresh",children:t},"WalletTagTooltip")),e.push(Object(P.jsx)(h.a,{type:"primary",onClick:this.handleLogout,size:n,children:"Logout"},"logout-button")),Object(P.jsx)(b.a,{title:this.renderHeaderText(),ghost:!0,extra:this.state.waiting?null:e})}}}},{key:"renderErrorHeader",value:function(){if(this.state.error.msg){var e=Object(P.jsx)(E.c,{msg:this.state.error.msg,retryCb:this.state.error.cb});return Object(P.jsx)(E.g,{content:e})}}},{key:"retry",value:function(e){return this.setError(),e()}},{key:"renderMenuItem",value:function(){switch(this.state.menuItem){case"menu-wallet":return Object(P.jsx)(E.m,{session:this.context.session,refreshData:this.fetchBtcData,lastUpdated:this.state.lastUpdated,pageTurnCb:this.handlePageTurn});case"menu-receive":return Object(P.jsx)(E.i,{session:this.context.session});case"menu-send":return Object(P.jsx)(E.j,{session:this.context.session});case"menu-settings":return Object(P.jsx)(E.k,{});case"menu-kv-records":return Object(P.jsx)(E.a,{});case N:return Object(P.jsx)(E.d,{});default:return}}},{key:"renderContent",value:function(){var e=this,t=!!this.context.session&&null!==this.context.session.getActiveWallet();if(this.state.waiting)return Object(P.jsx)(E.e,{msg:this.state.pendingMsg,onCancel:this.state.onCancel});if(this.isConnected()){if(this.context.session.isPaired()){if(this.state.openedByKeyring)return Object(P.jsx)(E.e,{msg:"Successfully connected to your Lattice! You may close this window.",spin:!1});if(t)return this.renderMenuItem();var n=this.context.session?this.refreshWallets:null;return Object(P.jsx)(E.c,{msg:"No active wallet present for device!",retryCb:n})}return Object(P.jsx)(E.h,{submit:this.handlePair,hide:!!this.state.error.msg})}return Object(P.jsx)(E.b,{submitCb:this.connectSession,cancelConnect:this.cancelConnect,name:this.state.name,keyringName:this.state.keyringName,setKeyringName:function(t){return e.setState({keyringName:t})},errMsg:this.state.error.msg})}},{key:"renderFooter",value:function(){return Object(P.jsxs)(I,{style:{textAlign:"center"},children:["\xa9 ",(new Date).getFullYear()," GridPlus, Inc.","dev"===B.constants.ENV?Object(P.jsx)(f.a,{color:"blue",style:{margin:"0 0 0 10px"},children:"DEV"}):null]})}},{key:"renderPage",value:function(){return null!==this.state.hwCheck?Object(P.jsx)(E.l,{data:this.state.hwCheck}):this.renderContent()}},{key:"render",value:function(){return Object(P.jsxs)(d.a,{style:{minHeight:"100vh"},children:[this.renderHeader(),Object(P.jsxs)(d.a,{id:"main-content-outer",children:[this.renderSidebar(),Object(P.jsxs)(d.a,{id:"main-content-inner",children:[Object(P.jsxs)(R,{style:{margin:"0 0 0 0"},children:[this.renderErrorHeader(),Object(P.jsx)("div",{style:{margin:"30px 0 0 0"},children:this.renderPage()})]}),this.renderFooter()]})]})]})}}]),o}(l.a.Component);D.contextType=k.a,t.a=D}).call(this,n(21).Buffer)},345:function(e,t,n){"use strict";(function(e){var s=n(10),i=n(11),r=n(16),a=n(15),c=n(0),o=n.n(c),l=(n(51),n(634)),d=n(630),u=n(631),h=n(632),j=n(148),b=n(13),f=n(38),v=n(4),p=n(340).default,g=n(221).ec,O=function(t){Object(r.a)(c,t);var n=Object(a.a)(c);function c(){var e;Object(s.a)(this,c);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return(e=n.call.apply(n,[this].concat(i))).context=e.context,e}return Object(i.a)(c,[{key:"_validate",value:function(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"secp256k1",i=new p,r=new g(s),a=i.createHash("sha256").update(e).digest(),c=r.keyFromPublic(t,"hex");return c.verify(a,n)}},{key:"getPreimage",value:function(){return Object(j.decode)(this.props.data).slice(0,32).toString()}},{key:"getCert",value:function(){var t=Object(j.decode)(this.props.data).slice(106,253),n=t.slice(2,73),s=e.from(t.slice(8,73)).toString("hex"),i=e.from(t.slice(73,147));return{pubkey:s,preimage:n,sig:i.slice(0,2+i[1])}}},{key:"validateCert",value:function(){var e=this.getCert();return this._validate(e.preimage,b.constants.LATTICE_CERT_SIGNER,e.sig)}},{key:"validateSig",value:function(){try{if(!this.validateCert())return!1;var t=this.getPreimage(),n=this.getCert(),s=e.from(Object(j.decode)(this.props.data).slice(32,106)),i=s.slice(0,2+s[1]);return this._validate(t,n.pubkey,i)}catch(r){return console.error("Encountered error validating signature: ".concat(r.message)),!1}}},{key:"renderResult",value:function(){var e={status:"warning",title:"Could not Verify Authenticity",subTitle:"We could not verify the authenticity of this signature or signer."};return!0===this.validateSig()&&(e.status="success",e.title="Verified",e.subTitle="The signer is authentic!"),Object(v.jsx)(l.a,{status:e.status,title:e.title,subTitle:e.subTitle})}},{key:"render",value:function(){var e=this.context.isMobile?18:10,t=this.context.isMobile?3:7;return Object(v.jsx)(d.a,{children:Object(v.jsx)(u.a,{span:e,offset:t,children:Object(v.jsx)("center",{children:Object(v.jsxs)(h.a,{title:"Validate Hardware",bordered:!0,children:[this.renderResult(),Object(v.jsxs)("p",{children:[Object(v.jsx)("b",{children:"Message:"})," ",this.getPreimage()]})]})})})})}}]),c}(o.a.Component);O.contextType=f.a,t.a=O}).call(this,n(21).Buffer)},35:function(e,t,n){"use strict";var s=n(1),i=n(3),r=n(133),a=n.n(r),c="gridplus_web_wallet_id",o="gridplus_web_wallet_password",l="gridplus_addresses",d="gridplus_contracts",u="gridplus_contracts_packs",h=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ROOT_STORE||"gridplus",j=function(e){var t=window.localStorage.getItem(e);try{return JSON.parse(t)}catch(n){return JSON.parse(JSON.stringify(t))}},b=function(e,t){return window.localStorage.setItem(e,JSON.stringify(t))},f=function(e){return window.localStorage.removeItem(e)},v=function(){var e;return null!==(e=j(h))&&void 0!==e?e:{}},p=function(e){var t,n;return null!==(t=null===(n=j(h))||void 0===n?void 0:n[e])&&void 0!==t?t:{}},g=function(e,t){return window.localStorage.setItem(h,JSON.stringify(Object(i.a)(Object(i.a)({},v()),{},Object(s.a)({},"".concat(e),t))))},O=function(){return p("keyring")},x=function(e){var t,n;return null!==(t=null===(n=p("keyring"))||void 0===n?void 0:n[e])&&void 0!==t?t:{}},y=function(e,t){return g("keyring",Object(s.a)({},"".concat(e),t))},m=function(e){return g("keyring",a()(O(),e))},T=function(){return j(c)},_=function(e){return b(c,e)},S=function(){return f(c)},C=function(){return j(o)},E=function(e){return b(o,e)},B=function(){return f(o)},A=function(e){var t,n=T();if(n)return null===(t=p(n))||void 0===t?void 0:t[e]},k=function(e,t){var n=T();if(n&&t)return g(n,Object(i.a)(Object(i.a)({},p(n)),{},Object(s.a)({},"".concat(e),t)))},P=function(e){var t=T();if(t)return g(t,a()(p(t),e))},R={getItem:j,setItem:b,removeItem:f,getRootStore:v,setRootStore:function(e){return window.localStorage.setItem(h,JSON.stringify(Object(i.a)(Object(i.a)({},v()),e)))},removeRootStore:function(){return f(h)},getRootStoreItem:p,setRootStoreItem:g,removeRootStoreItem:function(e){return window.localStorage.setItem(h,JSON.stringify(a()(v(),e)))},getSettings:function(){return p("settings")},setSettings:function(e){return g("settings",e)},getLoginId:T,setLoginId:_,removeLoginId:S,getLoginPassword:C,setLoginPassword:E,removeLoginPassword:B,getKeyring:O,setKeyring:function(e){return g("keyring",e)},getKeyringItem:x,setKeyringItem:y,removeKeyringItem:m,renameKeyringItem:function(e,t){if(e!==t){var n=Object(i.a)({},x(e));y(t,n),m(e)}},getLogin:function(){return{deviceID:T(),password:C()}},setLogin:function(e){var t=e.deviceID,n=e.password;_(t),E(n)},removeLogin:function(){S(),B()},getDeviceIndexedItem:A,setDeviceIndexedItem:k,removeDeviceIndexedItem:P,getAddresses:function(){return A(l)},setAddresses:function(e){return k(l,e)},removeAddresses:function(){return P(l)},getContracts:function(){return A(d)},setContracts:function(e){return k(d,e)},removeContracts:function(){return P(d)},getContractPacks:function(){var e;return null!==(e=j(u))&&void 0!==e?e:[]},setContractPacks:function(e){return b(u,e)},removeContractPacks:function(){return f(u)}};t.a=R},363:function(e,t,n){"use strict";var s=n(1),i=n(10),r=n(11),a=n(147),c=n(13),o=n(35),l=function(){function e(t,n){Object(i.a)(this,e),this.data=void 0,this.store=void 0,this.data=null,this.store=o.a.getRootStore()}return Object(r.a)(e,[{key:"isObject",value:function(e){try{return e&&"object"===typeof e&&!Array.isArray(e)}catch(t){return!1}}},{key:"updateBranch",value:function(e,t,n){var s=this;this.isObject(t)&&(this.isObject(e[n])&&!t[n]&&(t[n]={}),this.isObject(e[n])?Object.keys(e[n]).forEach((function(i){s.isObject(e[n][i])?s.updateBranch(e[n],t[n],i):t[n][i]=e[n][i]})):t[n]=e[n])}},{key:"save",value:function(e,t,n){var s=this;this.store[e]||(this.store[e]={}),this.store[e][t]||(this.store[e][t]={}),Object.keys(n).forEach((function(i){s.updateBranch(n,s.store[e][t],i)})),o.a.setRootStore(this.store)}},{key:"getWalletData",value:function(e,t){return this.store[e]||(this.store[e]={}),this.store[e][t]||(this.store[e][t]={}),this.store[e][t]}}]),e}(),d=n(21).Buffer,u=n(340).default,h=function(){function e(t,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(i.a)(this,e),this.client=void 0,this.crypto=void 0,this.name=void 0,this.storageSession=void 0,this.deviceID=void 0,this.stateUpdateHandler=void 0,this.page=void 0,this.baseUrl=void 0,this.addresses=void 0,this.btcTxs=void 0,this.btcUtxos=void 0,this.lastFetchedBtcData=void 0,this.btcPrice=void 0,this.client=null,this.crypto=null,this.name=s||c.constants.DEFAULT_APP_NAME,this.storageSession=null,this.deviceID=t,this.stateUpdateHandler=n,this.page=1,this.baseUrl=r.customEndpoint?r.customEndpoint:c.constants.BASE_SIGNING_URL,this.addresses={},this.btcTxs=[],this.btcUtxos=[],this.lastFetchedBtcData=0,this.btcPrice=0,this.getBtcWalletData()}return Object(r.a)(e,[{key:"disconnect",value:function(){this.client=null,this.saveBtcWalletData(),this.storageSession=null,this.deviceID=null}},{key:"isConnected",value:function(){return null!==this.client}},{key:"isPaired",value:function(){return this.client.isPaired||!1}},{key:"resetStateData",value:function(){this.addresses={},this.btcTxs=[],this.btcUtxos=[]}},{key:"getBtcDisplayAddress",value:function(){var e=this._getLastUsedBtcAddrIdx();return e>-1&&this.addresses.BTC[e+1]?this.addresses.BTC[e+1]:this.addresses.BTC&&this.addresses.BTC.length>0?this.addresses.BTC[0]:null}},{key:"getActiveWallet",value:function(){return this.client?this.client.getActiveWallet():null}},{key:"setPage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.page=e}},{key:"getPage",value:function(){return this.page}},{key:"dryAddresses",value:function(){var e={},t=this.addresses.BTC&&this.addresses.BTC.length>0,n=this.addresses.BTC_CHANGE&&this.addresses.BTC_CHANGE.length>0,s=Object(c.getBtcPurpose)();return s===c.constants.BTC_PURPOSE_NONE||(t&&(e.BTC={},e.BTC[s]=this.addresses.BTC||[]),n&&(e.BTC_CHANGE={},e.BTC_CHANGE[s]=this.addresses.BTC_CHANGE||[])),e}},{key:"rehydrateAddresses",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},n=Object(c.getBtcPurpose)();if(n===c.constants.BTC_PURPOSE_NONE)return t;e.BTC&&(t.BTC=e.BTC[n]),e.BTC_CHANGE&&(t.BTC_CHANGE=e.BTC_CHANGE[n]),this.addresses=t}},{key:"saveBtcWalletData",value:function(){var e;if(this.deviceID&&this.storageSession){var t=Object(c.getBtcPurpose)();if(t!==c.constants.BTC_PURPOSE_NONE){var n=Object(s.a)({},c.constants.BTC_WALLET_STORAGE_KEY,(e={},Object(s.a)(e,t,{addresses:this.dryAddresses(),btcTxs:this.btcTxs,btcUtxos:this.btcUtxos,lastFetchedBtcData:this.lastFetchedBtcData}),Object(s.a)(e,"btcPrice",this.btcPrice),e)),i=this.client?this.client.getActiveWallet():null;if(this.client&&null!==i){var r=i.uid.toString("hex");this.storageSession.save(this.deviceID,r,n)}}else console.error("Cannot save BTC wallet data when wallet is hidden")}}},{key:"getBtcWalletData",value:function(){if(this.deviceID&&!this.storageSession&&(this.storageSession=new l(this.deviceID)),this.client){var e=Object(c.getBtcPurpose)();if(e===c.constants.BTC_PURPOSE_NONE)return void console.error("Cannot get wallet data when wallet is hidden.");var t=this.getActiveWallet();if(null===t)this.addresses={};else{var n=t.uid.toString("hex"),s=this.storageSession.getWalletData(this.deviceID,n);if(!s||!s[c.constants.BTC_WALLET_STORAGE_KEY])return;var i=s[c.constants.BTC_WALLET_STORAGE_KEY];i.btcPrice&&(this.btcPrice=i.btcPrice);var r=i[e];if(!r)return;r.addresses&&this.rehydrateAddresses(r.addresses),r.btcTxs&&(this.btcTxs=r.btcTxs),r.btcUtxos&&(this.btcUtxos=r.btcUtxos),r.lastFetchedBtcData&&(this.lastFetchedBtcData=r.lastFetchedBtcData)}}}},{key:"_tryConnect",value:function(e,t,n){var s=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.baseUrl,o=c.constants.SHORT_TIMEOUT;!1===i&&(r="http://lattice-".concat(e,".local:8080"),o=5e3);var l,d=this._genPrivKey(e,t,this.name);try{l=new a.Client({name:this.name,privKey:d,baseUrl:r,timeout:o,skipRetryOnWrongWallet:!1})}catch(u){return n(u.toString())}l.connect(e,(function(r){return r?!1===i?(console.warn("Failed to connect to Lattice over LAN. Falling back to cloud routing."),s._tryConnect(e,t,n,!0)):(console.error("Failed to connect via cloud routing."),n(r)):(!1===i&&console.log("Successfully connected to Lattice over LAN."),l.timeout=c.constants.ASYNC_SDK_TIMEOUT,s.client=l,s.deviceID=e,s.getBtcWalletData(),n(null,l.isPaired))}))}},{key:"connect",value:function(e,t,n){return this._tryConnect(e,t,n,!0)}},{key:"refreshWallets",value:function(e){var t=this;if(!this.client)return e("Lost connection to Lattice. Please refresh.");var n=JSON.stringify(this.client.getActiveWallet());this.client.connect(this.deviceID,(function(s,i){return!1===t.client.isPaired?e(c.constants.LOST_PAIRING_ERR):s?e(s):(JSON.stringify(t.client.getActiveWallet())!==n&&t.resetStateData(),t.getBtcWalletData(),e(null,i))}))}},{key:"sign",value:function(e,t){this.client.sign(e,(function(e,n){if(e)return t(e);Object(c.broadcastBtcTx)(n.tx,(function(e,n){return e?t("Error broadcasting transaction: ".concat(e.message)):t(null,n)}))}))}},{key:"_genPrivKey",value:function(e,t,n){var s=d.concat([d.from(t),d.from(e),d.from(n)]);return this.crypto=new u(s),this.crypto.createHash("sha256").update(s).digest()}},{key:"getBtcTxs",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=[];return this.btcTxs.forEach((function(n){e&&n.confirmed?t.push(n):e||n.confirmed||t.push(n)})),t}},{key:"getBtcUtxos",value:function(){return this.btcUtxos}},{key:"getBtcBalance",value:function(){var e=0;return this.btcUtxos.forEach((function(t){e+=t.value})),e}},{key:"fetchBtcAddresses",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{regular:0,change:0},i=Object(c.getBtcPurpose)();if(i===c.constants.BTC_PURPOSE_NONE)return e("Cannot request BTC addresses while wallet is hidden.");var r=this._getLastUsedBtcAddrIdx(n),a=(n?this.addresses.BTC_CHANGE:this.addresses.BTC)||[],o=n?c.constants.BTC_CHANGE_GAP_LIMIT:c.constants.BTC_MAIN_GAP_LIMIT,l=r+1+o,d=l-a.length,u=Math.min(c.constants.BTC_ADDR_BLOCK_LEN,d);if(u>0){var h=n?1:0,j={startPath:[i,c.constants.BTC_COIN,Object(c.harden)(0),h,a.length],n:u,skipCache:!0};this._getAddresses(j,(function(i,r){if(i)return e(i);n?s.change+=u:s.regular+=u,n?t.addresses.BTC_CHANGE=a.concat(r):t.addresses.BTC=a.concat(r),console.log("Fetched BTC",t.addresses.BTC),console.log("Fetched BTC_CHANGE",t.addresses.BTC_CHANGE),d>u?t.fetchBtcAddresses(e,n,s):n?(t.saveBtcWalletData(),e(null,s)):t.fetchBtcAddresses(e,!0,s)}))}else n?(this.saveBtcWalletData(),e(null,s)):this.fetchBtcAddresses(e,!0,s)}},{key:"clearUtxos",value:function(){this.btcUtxos=[]}},{key:"fetchBtcStateData",value:function(e,t){var n=this,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=(s?this.addresses.BTC_CHANGE:this.addresses.BTC)||[];e&&e.regular>0?(a=this.addresses.BTC.slice(-e.regular),e.regular=0):e&&e.change>0&&(s=!0,a=this.addresses.BTC_CHANGE.slice(-e.change),e.change=0),Object(c.fetchBtcPrice)((function(o,l){o&&(console.error("Failed to fetch price:",o),l=0),Object(c.fetchBtcTxs)(a,i,(function(o,d){return o?t(o):d?(i=i.concat(d),void Object(c.fetchBtcUtxos)(a,(function(a,o){if(a)return t(a);if(!o)return t("Failed to fetch UTXOs");if(r=r.concat(o),s){n.btcPrice=l,n.lastFetchedBtcData=Math.floor(Date.now());var d=n.btcTxs.concat(i);n.btcTxs=Object(c.filterUniqueObjects)(d,["id"]),n._processBtcTxs();var u=n.btcUtxos.concat(r);n.btcUtxos=Object(c.filterUniqueObjects)(u,["id","vout"]).sort((function(e,t){return t.value-e.value})),n.saveBtcWalletData(),t(null)}else n.fetchBtcStateData(e,t,!0,i,r)}))):t("Failed to fetch transactions")}))}))}},{key:"_getAddresses",value:function(e,t){var n=this;this.client.getAddresses(e,(function(s,i){if(!s||"Device Busy"===s)return"Device Busy"===s?n._getAddresses(e,t):t(null,i);setTimeout((function(){return t(s)}),2e3)}))}},{key:"_getLastUsedBtcAddrIdx",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?"BTC_CHANGE":"BTC",n=this.addresses[t]||[],s=this.btcTxs||[],i=-1,r=0;r<s.length;r++)s[r].confirmed&&function(){var e=i;s[r].inputs.forEach((function(t){n.indexOf(t.addr)>e&&(e=n.indexOf(t.addr))})),s[r].outputs.forEach((function(t){n.indexOf(t.addr)>e&&(e=n.indexOf(t.addr))})),e>i&&(i=e)}();return i}},{key:"_processBtcTxs",value:function(){var e=this.addresses.BTC.concat(this.addresses.BTC_CHANGE),t=[];JSON.parse(JSON.stringify(this.btcTxs)).forEach((function(n){if(n.incoming=n.inputs.every((function(t){return-1===e.indexOf(t.addr)})),n.incoming?(n.outputs.forEach((function(t){!n.recipient&&e.indexOf(t.addr)>-1&&(n.recipient=e[e.indexOf(t.addr)])})),n.recipient||(n.recipient=n.outputs[0].addr)):n.recipient=n.outputs[0].addr,n.value=0,n.incoming)n.outputs.forEach((function(t){e.indexOf(t.addr)>-1&&(n.value+=t.value)}));else{var s=0;n.inputs.forEach((function(e){s+=e.value}));var i=0,r=0;n.outputs.forEach((function(t){e.indexOf(t.addr)>-1?i+=t.value:r+=t.value})),s===i+n.fee?n.value=0:n.value=r}t.push(n)}));var n=t.sort((function(e,t){return t.timestamp-e.timestamp}));this.btcTxs=n}}]),e}();t.a=h},38:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return j}));var s=n(3),i=n(6),r=n(0),a=n(347),c=n.n(a),o=n(348),l=n.n(o),d=n(35),u=n(4),h=Object(r.createContext)(void 0),j=function(e){var t,n=e.children,a=e.overrides,o=Object(r.useState)(window.innerWidth<500),j=Object(i.a)(o,2),b=j[0],f=j[1],v=Object(r.useState)(null),p=Object(i.a)(v,2),g=p[0],O=p[1],x=Object(r.useState)(!1),y=Object(i.a)(x,2),m=y[0],T=y[1],_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",n=Object(r.useState)(e),s=Object(i.a)(n,2),a=s[0],o=s[1];return[a,function(e){return o((function(n){return l()(n,e,t)}))},function(e){return o((function(n){return c()(n,e,t)}))},function(){return o([])}]}(null!==(t=d.a.getAddresses())&&void 0!==t?t:[]),S=Object(i.a)(_,4),C=S[0],E=S[1],B=S[2],A=S[3],k={isMobile:b,session:g,setSession:O,isLoadingAddresses:m,setIsLoadingAddresses:T,addresses:C,addAddressesToState:E,removeAddressesFromState:B,resetAddressesInState:A};return Object(r.useEffect)((function(){d.a.setAddresses(C)}),[C]),Object(r.useEffect)((function(){window.addEventListener("resize",(function(){var e=window.innerWidth<500;e&&!b&&f(!0),!e&&b&&f(!1)}))}),[b]),Object(u.jsx)(h.Provider,{value:Object(s.a)(Object(s.a)({},k),a),children:n})}},383:function(e,t){},385:function(e,t){},399:function(e,t){},401:function(e,t){},414:function(e,t){},423:function(e,t){},424:function(e,t){},49:function(e,t,n){"use strict";n.d(t,"f",(function(){return s.a})),n.d(t,"g",(function(){return f})),n.d(t,"b",(function(){return k})),n.d(t,"h",(function(){return R})),n.d(t,"k",(function(){return Q})),n.d(t,"a",(function(){return ye})),n.d(t,"d",(function(){return _e})),n.d(t,"e",(function(){return Ce})),n.d(t,"c",(function(){return Ee})),n.d(t,"l",(function(){return Be.a})),n.d(t,"m",(function(){return Me})),n.d(t,"i",(function(){return lt})),n.d(t,"j",(function(){return nt}));var s=n(273),i=n(10),r=n(11),a=n(16),c=n(15),o=n(0),l=n.n(o),d=(n(51),n(630)),u=n(631),h=n(38),j=n(4),b=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(i.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).context=e.context,e}return Object(r.a)(n,[{key:"render",value:function(){if(this.props.children||this.props.content)return this.context.isMobile?this.props.children?this.props.children:this.props.content:Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(u.a,{span:14,children:this.props.children||this.props.content})})}}]),n}(l.a.Component);b.contextType=h.a;var f=b,v=n(20),p=n(45),g=n(358),O=n(648),x=n(651),y=n(632),m=n(654),T=n(655),_=n(13),S=n(6),C=n(653),E=n(646),B=function(e){var t=e.name,n=e.setName,s=Object(o.useState)(!1),i=Object(S.a)(s,2),r=i[0],a=i[1],c=Object(o.useState)(!1),l=Object(S.a)(c,2),d=l[0],u=l[1],h=E.a.useForm(),b=Object(S.a)(h,1)[0];return r?Object(j.jsxs)(E.a,{form:b,name:"formData",layout:"inline",onFinish:function(e){a(!1),n(e.name)},style:{justifyContent:"center"},children:[Object(j.jsx)(E.a.Item,{name:"name",initialValue:t,rules:[{required:!0,message:"Name is required."}],children:Object(j.jsx)(g.a,{"data-testid":"".concat(t,"-input")})}),Object(j.jsxs)(E.a.Item,{children:[Object(j.jsx)(p.a,{type:"text",onClick:function(){b.resetFields(),a(!1)},"data-testid":"".concat(t,"-cancel"),children:"Cancel"}),Object(j.jsx)(p.a,{type:"ghost",htmlType:"submit","data-testid":"".concat(t,"-save"),children:"Save"})]})]}):Object(j.jsx)(p.a,{type:"text",size:"large",icon:d?Object(j.jsx)(C.a,{}):null,style:{fontSize:"24px"},"data-testid":"".concat(t,"-edit"),onClick:function(){return a(!0)},onMouseEnter:function(){return u(!0)},onMouseLeave:function(){return u(!1)},children:t})},A=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).context=s.context,s.state={errMsg:null,isLoading:!1,modal:!1,showSettings:!1},s.handleCancel=s.handleCancel.bind(Object(v.a)(s)),s.handleSubmit=s.handleSubmit.bind(Object(v.a)(s)),s.renderMsg=s.renderMsg.bind(Object(v.a)(s)),s.showModal=s.showModal.bind(Object(v.a)(s)),s}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.input.focus(),this.setState({isLoading:!1})}},{key:"componentDidUpdate",value:function(){this.props.name!==_.constants.DEFAULT_APP_NAME&&"Lattice Connector"!==document.title&&(document.title="Lattice Connector")}},{key:"componentWillUnmount",value:function(){this.setState({isLoading:!1})}},{key:"handleSubmit",value:function(){var e=document.getElementById("deviceIdInput").value,t=document.getElementById("passwordInput").value;t.length<8?this.setState({isLoading:!0,errMsg:"Your password must be at least 8 characters."}):(this.setState({isLoading:!0,errMsg:null}),this.props.submitCb({deviceID:e,password:t},!1))}},{key:"handleCancel",value:function(){this.props.cancelConnect(),this.setState({isLoading:!1,errMsg:null})}},{key:"renderConnectButton",value:function(){return this.state.isLoading&&null===this.state.errMsg&&null===this.props.errMsg?Object(j.jsxs)("div",{children:[Object(j.jsx)(p.a,{type:"primary",style:{margin:"20px 0 0 0"},loading:!0,children:"Connecting..."}),Object(j.jsx)("br",{}),Object(j.jsx)(p.a,{type:"link",onClick:this.handleCancel,children:"Cancel"})]}):Object(j.jsx)(p.a,{type:"primary",onClick:this.handleSubmit,style:{margin:"20px 0 0 0"},children:"Connect"})}},{key:"renderForm",value:function(e){var t=this;return Object(j.jsxs)("div",{children:[Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(g.a,{placeholder:"DeviceID",id:"deviceIdInput",ref:function(e){t.input=e},style:{margin:"10px 0 0 0",width:"70%"}})}),Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(g.a.Password,{placeholder:"Password (create for new logins)",id:"passwordInput",onPressEnter:this.handleSubmit,style:{margin:"20px 0 0 0",width:"70%"}})}),Object(j.jsx)(d.a,{justify:"center",children:this.renderConnectButton()})]})}},{key:"showModal",value:function(){this.setState({modal:!0})}},{key:"hideModal",value:function(){this.setState({modal:!1,showSettings:!1})}},{key:"renderSetupInfo",value:function(){return Object(j.jsxs)("div",{children:[Object(j.jsx)("center",{children:Object(j.jsx)("h3",{children:Object(j.jsx)("b",{children:"New User Setup"})})}),Object(j.jsxs)("p",{children:["You can use this page to establish a connection between ",Object(j.jsx)("b",{children:this.props.name}),"\xa0 and your Lattice hardware wallet device.\xa0",Object(j.jsxs)("i",{children:["For more general device setup information, please see the\xa0",Object(j.jsx)("a",{className:"lattice-a",href:"https://gridplus.io/setup",target:"_blank",rel:"noopener noreferrer",children:"Lattice setup page"}),"."]})]}),Object(j.jsx)("h3",{children:Object(j.jsx)("b",{children:"Step 1:"})}),Object(j.jsxs)("p",{children:["Unlock your Lattice and find its ",Object(j.jsx)("b",{children:"Device ID"})," on the main menu. This is a six-character code."]}),Object(j.jsx)("h3",{children:Object(j.jsx)("b",{children:"Step 2:"})}),Object(j.jsxs)("p",{children:["Once you have your Device ID, specify a ",Object(j.jsx)("b",{children:"password"}),". This does ",Object(j.jsx)("i",{children:"not"})," secure any value and is ",Object(j.jsx)("i",{children:"not"})," associated with your wallet seed - it is only used to send secure requests to your device. If you lose your password, you can remove the permission on your device and re-connect with a new one."]}),Object(j.jsx)("h3",{children:Object(j.jsx)("b",{children:"Step 3:"})}),Object(j.jsxs)("p",{children:["Please ensure your Lattice is ",Object(j.jsx)("b",{children:"online"}),' and click "Connect". Your device is online if there is a single wifi signal icon on the top-right of the screen.']})]})}},{key:"renderModal",value:function(){return this.state.showSettings?Object(j.jsx)(O.a,{title:"Settings",footer:null,visible:this.state.modal,onOk:this.hideModal.bind(this),onCancel:this.hideModal.bind(this),children:Object(j.jsx)(Q,{inModal:!0})}):Object(j.jsx)("div",{children:Object(j.jsx)(O.a,{title:this.props.name===_.constants.DEFAULT_APP_NAME?this.props.name:"Lattice Connector \ud83d\udd17",footer:null,visible:this.state.modal,onOk:this.hideModal.bind(this),onCancel:this.hideModal.bind(this),children:this.renderSetupInfo()})})}},{key:"renderMsg",value:function(){var e;if(this.state.errMsg?e=this.state.errMsg:this.props.errMsg&&(e=this.props.errMsg),e)return Object(j.jsx)(x.a,{message:Object(j.jsxs)("p",{children:[Object(j.jsx)("b",{children:"Error:"}),Object(j.jsx)("br",{}),e]}),type:"error",style:{margin:"20px 0 0 0"},closable:!0})}},{key:"render",value:function(){var e=this,t=this.context.isMobile?24:10,n=this.context.isMobile?0:7,s=null!==this.props.keyringName&&this.props.keyringName.length<5;return Object(j.jsxs)(d.a,{children:[this.renderModal(),Object(j.jsx)(u.a,{span:t,offset:n,children:Object(j.jsxs)("center",{children:[this.renderMsg(),Object(j.jsxs)(y.a,{bordered:!0,children:[Object(j.jsx)("a",{className:"lattice-a",href:"https://gridplus.io/lattice",target:"_blank",rel:"noopener noreferrer",children:this.props.keyringName?Object(j.jsxs)("h2",{style:{margin:"10px 0 0 0"},children:["Lattice Connector ",Object(j.jsx)(m.a,{})]}):Object(j.jsxs)("h2",{style:{margin:"10px 0 0 0"},children:["Lattice Manager",Object(j.jsx)("br",{}),Object(j.jsx)(T.a,{})]})}),this.props.keyringName?Object(j.jsxs)("div",{style:{margin:"2em"},children:[Object(j.jsx)("br",{}),Object(j.jsx)("i",{children:Object(j.jsx)("h3",{children:"Connect to:"})}),Object(j.jsx)(B,{name:this.props.keyringName,setName:this.props.setKeyringName})]}):null,s?Object(j.jsx)("p",{children:Object(j.jsx)("b",{children:"Error: App name must be more than 4 characters."})}):this.renderForm()]}),Object(j.jsx)(p.a,{type:"link",onClick:this.showModal.bind(this),style:{margin:"20px 0 0 0"},children:"New User Info"}),Object(j.jsx)("br",{}),Object(j.jsx)(p.a,{type:"link",onClick:function(){e.setState({showSettings:!0},e.showModal)},children:"Settings"}),Object(j.jsx)("br",{}),Object(j.jsx)(p.a,{type:"link",href:"https://gridplus.io/lattice",target:"_blank",rel:"noopener noreferrer",children:"About the Lattice"})]})})]})}}]),n}(l.a.Component);A.contextType=h.a;var k=A,P=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).context=s.context,s.state={code:""},s}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.setState({code:""}),this.input.focus()}},{key:"componentWillUnmount",value:function(){this.setState({code:""})}},{key:"handleUpdate",value:function(e){var t=this;try{this.setState({code:e.target.value.toUpperCase()},(function(){t.state.code.length>=8&&t.props.submit(t.state.code)}))}catch(n){}}},{key:"getBoxWidth",value:function(){var e=document.getElementById("secret-card");if(e)return.8*e.clientWidth}},{key:"getBoxFontHeight",value:function(){var e=this.getBoxWidth();if(e)return e/8*.6}},{key:"render",value:function(){var e=this;if(this.props.hide)return null;var t=this.context.isMobile?"small":"large",n=this.getBoxWidth(),s=this.getBoxFontHeight(),i=Object(j.jsx)("center",{children:Object(j.jsxs)(y.a,{title:"Enter Secret",bordered:!0,id:"secret-card",children:[Object(j.jsx)("p",{}),Object(j.jsx)("p",{children:"Please enter the pairing secret displayed on your Lattice screen:"}),Object(j.jsx)(g.a,{className:"lattice-pairing-box",size:t,id:"secret",ref:function(t){e.input=t},onChange:this.handleUpdate.bind(this),style:{width:n,fontSize:s},value:this.state.code})]})});return Object(j.jsx)(f,{content:i})}}]),n}(l.a.Component);P.contextType=h.a;var R=P,I=n(198),w=n(157),L=n(105),N=n(199),D=n(72),U=n(367),W=(n(158),n(101)),M=3600,F={ETH:{name:"ETH",decimals:18},BTC:{name:"BTC",decimals:8}},G=(l.a.Component,n(205)),H=n(364),K=n(135),V=n(649),Y=n(645),z=n(656),J=n(133),q=n.n(J),X=n(35),Z=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).state={settings:X.a.getSettings(),keyring:X.a.getKeyring()},s.getBtcPurposeName=s.getBtcPurposeName.bind(Object(v.a)(s)),s}return Object(r.a)(n,[{key:"submit",value:function(){X.a.setSettings(this.state.settings),window.location.reload()}},{key:"updateUseCustomEndpoint",value:function(e){var t=this.state.settings;!0!==e&&(t.customEndpoint=""),this.setState({settings:t})}},{key:"updateCustomEndpoint",value:function(e){var t=this.state.settings;t.customEndpoint=e.target.value,this.setState({settings:t})}},{key:"updateUseDevLattice",value:function(e){var t=this.state.settings;t.devLattice=e.target.checked,this.setState({settings:t},this.submit)}},{key:"removeKeyring",value:function(e){var t=e.name;X.a.removeKeyringItem(t),this.setState({keyring:q()(this.state.keyring,t)})}},{key:"resetState",value:function(){X.a.removeRootStore(),window.location.reload()}},{key:"renderCustomEndpointSetting",value:function(){var e=this.state.settings.customEndpoint,t=void 0===e?"":e;return Object(j.jsx)(y.a,{children:Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsxs)(u.a,{span:20,children:[Object(j.jsx)("h3",{children:"Connection Endpoint:"}),Object(j.jsxs)("p",{children:["If you wish to route messages and connections through your own endpoint, you may specify it here.\xa0 Otherwise leave blank.\xa0 See\xa0",Object(j.jsx)("a",{href:"https://github.com/GridPlus/lattice-connect",className:"lattice-a",target:"_blank",rel:"noopener noreferrer",children:"this"})," for more information."]}),Object(j.jsx)("div",{children:Object(j.jsx)(g.a,{placeholder:"host:port",defaultValue:t,onChange:this.updateCustomEndpoint.bind(this)})})]})})})}},{key:"handleChangeBitcoinVersionSetting",value:function(e){var t=this.state.settings;t.btcPurpose=parseInt(e.target.value),this.setState({settings:t},this.submit)}},{key:"getBtcPurposeName",value:function(){var e=this.state.settings.btcPurpose?this.state.settings.btcPurpose:Object(_.getBtcPurpose)();return e===_.constants.BTC_PURPOSE_NONE?_.constants.BTC_PURPOSE_NONE_STR:e===_.constants.BTC_PURPOSE_LEGACY?_.constants.BTC_PURPOSE_LEGACY_STR:e===_.constants.BTC_PURPOSE_WRAPPED_SEGWIT?_.constants.BTC_PURPOSE_WRAPPED_SEGWIT_STR:e===_.constants.BTC_PURPOSE_SEGWIT?_.constants.BTC_PURPOSE_SEGWIT_STR:"Error finding BTC version"}},{key:"renderBitcoinVersionSetting",value:function(){var e=Object(_.getBtcPurpose)()||_.constants.BTC_PURPOSE_NONE;return Object(j.jsxs)(y.a,{children:[Object(j.jsx)("h4",{children:"Bitcoin Wallet Type"}),Object(j.jsx)(G.a.Group,{onChange:this.handleChangeBitcoinVersionSetting.bind(this),defaultValue:e,children:Object(j.jsxs)(H.b,{direction:"vertical",children:[Object(j.jsx)(G.a,{value:_.constants.BTC_PURPOSE_NONE,children:"Hide BTC Wallet"}),Object(j.jsx)(G.a,{value:_.constants.BTC_PURPOSE_SEGWIT,children:_.constants.BTC_PURPOSE_SEGWIT_STR}),Object(j.jsx)(G.a,{value:_.constants.BTC_PURPOSE_WRAPPED_SEGWIT,children:_.constants.BTC_PURPOSE_WRAPPED_SEGWIT_STR}),Object(j.jsx)(G.a,{value:_.constants.BTC_PURPOSE_LEGACY,children:_.constants.BTC_PURPOSE_LEGACY_STR})]})})]})}},{key:"renderDevLatticeSetting",value:function(){var e=this.state.settings.devLattice;return Object(j.jsxs)(y.a,{children:[Object(j.jsx)("h4",{children:"Debug Settings"}),Object(j.jsx)(d.a,{justify:"center",style:{margin:"10px 0 0 0"},children:Object(j.jsxs)(p.a,{type:"link",onClick:this.resetState,className:"warning-a",children:[Object(j.jsx)(z.a,{}),"\xa0Reset App State"]})}),Object(j.jsx)(d.a,{justify:"center",style:{margin:"20px 0 0 0"},children:Object(j.jsx)(K.a,{onChange:this.updateUseDevLattice.bind(this),checked:e,children:"Using Dev Lattice"})})]})}},{key:"renderKeyringsSetting",value:function(){var e=this,t=X.a.getKeyring(),n=[{title:"App Name",dataIndex:"name",key:"name"},{title:"Action",dataIndex:"action",key:"action",render:function(t,n){return Object(j.jsx)(p.a,{type:"link",onClick:function(){e.removeKeyring(n)},children:"Forget"})}}],s=[];return Object.keys(t).sort((function(e,t){return e.toLowerCase()>t.toLowerCase()?1:-1})).forEach((function(e){s.push({name:e,key:e})})),Object(j.jsx)(y.a,{children:Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsxs)(u.a,{span:20,children:[Object(j.jsx)("h3",{children:"Third Party Connections"}),Object(j.jsx)("p",{children:"Manage connections to your Lattice. Third party apps should be listed here if they are connected to your device."}),Object(j.jsx)(V.a,{children:Object(j.jsx)(V.a.Panel,{header:"Connections List (".concat(s.length,")"),children:Object(j.jsx)(Y.a,{dataSource:s,columns:n})})})]})})})}},{key:"renderCard",value:function(){return Object(j.jsxs)("div",{children:[this.renderKeyringsSetting(),this.renderCustomEndpointSetting(),this.renderBitcoinVersionSetting(),this.renderDevLatticeSetting(),Object(j.jsx)("br",{}),Object(j.jsx)(p.a,{type:"primary",onClick:this.submit.bind(this),children:"Update and Reload"})]})}},{key:"render",value:function(){var e=Object(j.jsx)("center",{children:Object(j.jsx)(y.a,{title:"Settings",bordered:!0,children:this.renderCard()})});return this.props.inModal?Object(j.jsx)("center",{children:this.renderCard()}):Object(j.jsx)(f,{content:e})}}]),n}(l.a.Component),Q=Z,$=n(658),ee=n(41),te=n(62),ne=n(201),se=n.n(ne),ie=_.constants.ADDRESSES_PER_PAGE,re=function(){var e=Object(o.useContext)(h.a),t=e.session,n=e.isLoadingAddresses,s=e.setIsLoadingAddresses,i=e.addresses,r=e.addAddressesToState,a=e.removeAddressesFromState,c=e.resetAddressesInState,l=function(){var e=Object(o.useState)(void 0),t=Object(S.a)(e,2),n=t[0],s=t[1],i=Object(o.useState)(void 0),r=Object(S.a)(i,2),a=r[0],c=r[1],l=Object(o.useCallback)((function(e){return c((function(){return function(){e(),s(null),c(null)}}))}),[c]);return{error:n,setError:s,retryFunction:a,setRetryFunction:c,setRetryFunctionWithReset:l}}(),d=l.error,u=l.setError,j=l.retryFunction,b=l.setRetryFunctionWithReset,f=Object(o.useCallback)(Object(te.a)(Object(ee.a)().mark((function e(){var n,i,a=arguments;return Object(ee.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>0&&void 0!==a[0]?a[0]:0,i=a.length>1&&void 0!==a[1]?a[1]:1,s(!0),e.abrupt("return",t.client.getKvRecords({start:n,n:ie}).then((function(e){r(e.records);var t=e.fetched+n;e.total-t>0?f(n+e.fetched):(u(null),s(!1))})).catch((function(e){i>0?(u(null),f(n,i-1)):(u(e),s(!1),b(f))})));case 4:case"end":return e.stop()}}),e)}))),[r,t.client,u,s,b]),v=function(){var e=Object(te.a)(Object(ee.a)().mark((function e(n){return Object(ee.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(!0),e.abrupt("return",t.client.addKvRecords({caseSensitive:!1,type:0,records:n}).then((function(){f()})).catch((function(e){throw u(e),b((function(){return v(n)})),e})).finally((function(){s(!1)})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{fetchAddresses:f,addresses:i,addAddresses:v,addAddressesToState:r,removeAddresses:function e(n){var i=n.map((function(e){return parseInt(e.id)}));if(!se()(i))return s(!0),t.client.removeKvRecords({ids:i}).then((function(){a(n),u(null)})).catch((function(t){u(t),b((function(){return e(n)}))})).finally((function(){s(!1)}))},removeAddressesFromState:a,resetAddressesInState:c,isLoadingAddresses:n,error:d,setError:u,retryFunction:j}},ae=n(3),ce=n(12),oe=n(368),le=n(657),de=n(352),ue=n.n(de),he=function(e){var t=e.error,n=e.retryFunction;return t?Object(j.jsx)(x.a,{message:"Error",description:t,type:"error",closable:!0,action:Object(j.jsx)(p.a,{type:"danger",onClick:function(){n&&n()},children:"Retry"})}):null},je=["key","name"],be=function(){var e=re(),t=e.addresses,n=e.addAddresses,s=e.isLoadingAddresses,i=e.error,r=e.setError,a=e.retryFunction,c=E.a.useForm(),l=Object(S.a)(c,1)[0],d=Object(o.useState)(!1),u=Object(S.a)(d,2),h=u[0],b=u[1],f=function(){b(!1)},v=function(){f()};return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(p.a,{type:"ghost",onClick:function(){b(!0)},icon:Object(j.jsx)(oe.a,{}),children:"Add"}),Object(j.jsx)(O.a,{title:"Add Address Tags",visible:h,maskClosable:!1,onOk:l.submit,onCancel:v,destroyOnClose:!0,footer:[Object(j.jsx)(p.a,{type:"link",onClick:v,children:"Cancel"},"cancel"),Object(j.jsx)(p.a,{type:"primary",loading:s,onClick:l.submit,children:"Add"},"add")],children:Object(j.jsxs)(H.b,{direction:"vertical",style:{width:"100%"},children:[Object(j.jsx)(he,{error:i,retryFunction:a}),Object(j.jsx)(E.a,{form:l,name:"formData",onFinish:function(){l.validateFields().then((function(e){var t=e.recordsToAdd,s=ue.a.chain(t).keyBy("key").mapValues("val").value();n(s).then(f).catch(console.error)}))},onFinishFailed:function(){r("Unable to submit. Fix errors in form and try again.")},onFieldsChange:function(){r(null)},autoComplete:"off",preserve:!1,layout:"vertical",children:Object(j.jsx)(E.a.List,{name:"recordsToAdd",initialValue:[{key:null,val:null}],children:function(e,n){var i=n.add,r=n.remove;return Object(j.jsxs)(j.Fragment,{children:[e.map((function(e){e.key;var n=e.name,i=Object(ce.a)(e,je);return Object(j.jsxs)("div",{style:{display:"flex",flexDirection:"row",marginBottom:"1em",width:"100%"},children:[Object(j.jsxs)("div",{style:{display:"flex",flexDirection:"column",flexGrow:1},children:[Object(j.jsx)(E.a.Item,Object(ae.a)(Object(ae.a)({},i),{},{name:[n,"key"],validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"Address is required."},{max:63,type:"string",message:"Must be shorter than ".concat(63," characters.")},{validator:function(e,n){return null!==t&&void 0!==t&&t.some((function(e){return e.key===n}))?Promise.reject(new Error("You already have a tag with this address on your device.")):Promise.resolve()},validateTrigger:["onChange","onBlur"]}],children:Object(j.jsx)(g.a,{addonBefore:"Address","data-testid":"".concat(n,"-address-input")})})),Object(j.jsx)(E.a.Item,Object(ae.a)(Object(ae.a)({},i),{},{name:[n,"val"],validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"Name is required"},{max:63,type:"string",message:"Must be shorter than ".concat(63," characters.")},{validator:function(e,n){return null!==t&&void 0!==t&&t.some((function(e){return e.val===n}))?Promise.reject(new Error("You already have a tag with this name on your device.")):Promise.resolve()},validateTrigger:["onChange","onBlur"]}],children:Object(j.jsx)(g.a,{addonBefore:"Name","data-testid":"".concat(n,"-name-input")})}))]}),n>0?Object(j.jsx)(p.a,{type:"text",icon:Object(j.jsx)(le.a,{}),disabled:s,style:{height:"auto",marginLeft:"1em",marginBottom:"1.2em"},onClick:function(){return r(n)}}):null]},"".concat(n,"-inputs"))})),Object(j.jsx)(E.a.Item,{children:Object(j.jsx)(p.a,{type:"dashed",block:!0,icon:Object(j.jsx)(oe.a,{}),disabled:s,onClick:i,children:"Add Another Address Tag"})})]})}})})]})})]})},fe=n(353),ve=n.n(fe),pe=n(354),ge=n.n(pe),Oe=_.constants.ADDRESSES_PER_PAGE,xe=function(){var e=re(),t=e.isLoadingAddresses,n=e.addresses,s=e.removeAddresses,i=Object(o.useState)(""),r=Object(S.a)(i,2),a=r[0],c=r[1],l=Object(o.useState)([]),d=Object(S.a)(l,2),u=d[0],h=d[1],b=Object(o.useState)([]),f=Object(S.a)(b,2),v=f[0],O=f[1];Object(o.useEffect)((function(){c(""),h(n)}),[n,t]);var x=Object(o.useCallback)((function(e){return ve.a.go(e,n,{keys:["key","val"]}).map((function(e){return e.obj}))}),[n]);return Object(j.jsxs)("div",{children:[Object(j.jsxs)("div",{style:{display:"flex"},children:[Object(j.jsx)(g.a,{value:a,placeholder:"Filter",disabled:t,onChange:function(e){var t=e.target.value;c(t);var s=t?x(t):n;h(s),O(ge()(v,s,"key"))},style:{marginBottom:"1em"},allowClear:!0}),Object(j.jsx)(p.a,{danger:!0,type:"text",disabled:0===v.length,onClick:function(){return s(v).then((function(){O([])}))},style:{marginLeft:"1em"},children:"Remove Selected"})]}),Object(j.jsxs)(Y.a,{dataSource:u,tableLayout:"fixed",loading:{spinning:t,tip:"Loading...",indicator:Object(j.jsx)(D.a,{})},pagination:{position:["bottomCenter"],pageSize:Oe,defaultCurrent:1,showSizeChanger:!1},rowSelection:{type:"checkbox",onSelect:function(e,t,n){O(n)},onSelectAll:function(e,t){O(t)},selectedRowKeys:v.map((function(e){return e.key}))},children:[Object(j.jsx)(Y.a.Column,{title:"Name",dataIndex:"val",defaultSortOrder:"ascend",sorter:function(e,t){return e.val.localeCompare(t.val)}},"val"),Object(j.jsx)(Y.a.Column,{title:"Address",dataIndex:"key",render:function(e){return(t=e)&&t.length>24?"".concat(t.slice(0,10),"...").concat(t.slice(t.length-8,t.length)):null!==t&&void 0!==t?t:"";var t},sorter:function(e,t){return e.key.localeCompare(t.key)}},"key")]})]})},ye=function(){var e=re(),t=e.fetchAddresses,n=e.isLoadingAddresses,s=e.addresses,i=e.resetAddressesInState,r=e.error,a=e.retryFunction;Object(o.useEffect)((function(){se()(s)&&!n&&t()}),[]);var c=[Object(j.jsx)(p.a,{type:"link",icon:Object(j.jsx)($.a,{}),disabled:n,onClick:function(){i(),t()},children:"Sync"},"sync-button"),Object(j.jsx)(be,{},"add-addresses-button")];return Object(j.jsxs)(f,{children:[Object(j.jsx)(he,{error:r,retryFunction:a}),Object(j.jsx)(y.a,{title:"Saved Addresses",extra:c,bordered:!0,children:Object(j.jsx)(xe,{})})]})},me=n(637),Te=n(644),_e=function(){var e=function(){var e=Object(o.useContext)(h.a).session.client.getFwVersion(),t=e.fix,n=e.minor,s=e.major;return Object.fromEntries(Object.entries({CAN_VIEW_CONTRACTS:[0,14,0],USES_AUTO_ABI:[0,15,0]}).map((function(e){var i=Object(S.a)(e,2),r=i[0],a=Object(S.a)(i[1],3),c=a[0],o=a[1],l=a[2];return[r,t>=c&&n>=o&&s>=l]})))}().USES_AUTO_ABI;return Object(j.jsx)(f,{children:Object(j.jsxs)(y.a,{bordered:!0,style:{textAlign:"center"},children:[Object(j.jsxs)("div",{children:[Object(j.jsxs)("h1",{className:"lattice-h1",children:[Object(j.jsx)(T.a,{}),"\xa0Lattice Manager"]}),Object(j.jsx)("p",{className:"lattice-h4",children:"Manage secure data on your Lattice hardware wallet device for a better web3 experience:"})]}),Object(j.jsx)("div",{style:{margin:"25px"},children:Object(j.jsx)("p",{children:Object(j.jsxs)("a",{href:_.constants.TAGS_HELP_LINK,className:"lattice-a",target:"_blank",rel:"noopener noreferrer",children:[Object(j.jsx)(me.a,{}),"\xa0",Object(j.jsx)("b",{children:"Address Tags"}),"\xa0"]})})}),Object(j.jsx)("p",{children:Object(j.jsx)("i",{children:"Give names to your favorite contracts or recipient addresses."})}),e?null:Object(j.jsx)(x.a,{style:{maxWidth:"500px",margin:"auto"},message:"Lattice firmware is out of date",description:Object(j.jsxs)("div",{style:{padding:"0 25px 0 25px"},children:[Object(j.jsx)("p",{children:"Please update immediately to receive automatic contract decoding, which ensures you know what you're signing."}),Object(j.jsxs)("div",{style:{margin:"auto",width:"66%",textAlign:"left"},children:[Object(j.jsx)("p",{children:"To update your firmware:"}),Object(j.jsxs)("ol",{children:[Object(j.jsx)("li",{children:"Unlock your device"}),Object(j.jsxs)("li",{children:["Tap ",Object(j.jsx)("strong",{children:"Settings"})]}),Object(j.jsxs)("li",{children:["Tap ",Object(j.jsx)("strong",{children:"Software Update"})]}),Object(j.jsxs)("li",{children:["Tap ",Object(j.jsx)("strong",{children:"Update"})]})]})]})]}),type:"warning",showIcon:!0}),Object(j.jsx)(Te.a,{}),Object(j.jsx)("img",{src:"lattice-landing.jpg",style:{maxHeight:"500px",maxWidth:"100%"},alt:"lattice-one-device"})]})})},Se=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"render",value:function(){var e=Object(j.jsx)("center",{children:Object(j.jsxs)(y.a,{title:"Loading",bordered:!0,children:[!1!==this.props.spin?Object(j.jsx)(I.a,{indicator:Object(j.jsx)(D.a,{})}):null,Object(j.jsx)("p",{children:this.props.msg?this.props.msg:"Waiting for data from your Lattice"}),this.props.onCancel?Object(j.jsx)(p.a,{type:"link",onClick:this.props.onCancel,children:"Cancel"}):null]})});return Object(j.jsx)(f,{content:e})}}]),n}(l.a.Component),Ce=Se,Ee=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).keyPressListener=s.keyPressListener.bind(Object(v.a)(s)),s.submit=s.submit.bind(Object(v.a)(s)),s}return Object(r.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("keypress",this.keyPressListener)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keypress",this.keyPressListener)}},{key:"keyPressListener",value:function(e){"Enter"===e.key&&this.submit()}},{key:"submit",value:function(){this.props.retryCb()}},{key:"render",value:function(){return Object(j.jsx)("center",{children:Object(j.jsxs)(y.a,{title:"Error",bordered:!0,children:[Object(j.jsx)("p",{children:this.props.msg}),this.props.retryCb?Object(j.jsx)(p.a,{id:"submitButton",onClick:this.submit,type:"danger",children:this.props.btnMsg||"Retry"}):null]})})}}]),n}(l.a.Component),Be=n(345),Ae=n(652),ke=n(360),Pe=n(635),Re=n(650),Ie=n(641),we=n(640),Le=n(659),Ne=n(660),De=n(661),Ue=n(272),We=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(i.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).context=e.context,e}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.props.session&&this.props.session.getBtcWalletData()}},{key:"getInnerWidth",value:function(){var e;return null===(e=document.getElementById("main-content-inner"))||void 0===e?void 0:e.offsetWidth}},{key:"ensureTrimmedText",value:function(e){if(!this.context.isMobile)return e;var t=this.getInnerWidth()/22;return e.length>t?"".concat(e.slice(0,t),"..."):e}},{key:"renderListItem",value:function(e){var t=Object(j.jsxs)("div",{align:this.context.isMobile?"left":"right",children:[e.confirmed?Object(j.jsxs)("p",{children:[e.incoming?"Received ":"Sent ",Fe(e.timestamp)," ago"]}):null,Object(j.jsx)(p.a,{size:"small",href:"".concat(_.constants.BTC_TX_BASE_URL,"/").concat(e.id),target:"_blank",children:"View"})]});if(0===e.value)return Object(j.jsxs)(Ae.b.Item,{children:[Object(j.jsx)(Ae.b.Item.Meta,{avatar:Object(j.jsx)(ke.a,{src:"/BTC.png"}),title:"Internal Transaction",description:"This transaction sender and recipient are your addresses."}),t]},e.hash);var n="".concat(e.value/Math.pow(10,8)," BTC"),s="\t".concat(this.ensureTrimmedText(e.recipient)),i=Object(j.jsx)(Ae.b.Item.Meta,{avatar:Object(j.jsx)(ke.a,{src:"/BTC.png"}),title:e.confirmed?Object(j.jsx)("p",{children:"".concat(n)}):Object(j.jsx)("p",{children:Object(j.jsx)("i",{children:"".concat(n)})}),description:e.confirmed?Object(j.jsxs)("p",{children:[e.incoming?Object(j.jsx)(Ie.a,{}):Object(j.jsx)(we.a,{}),"".concat(s)]}):Object(j.jsxs)("p",{children:[e.incoming?Object(j.jsx)(Ie.a,{}):Object(j.jsx)(we.a,{}),Object(j.jsx)("i",{children:"".concat(s)})]})});return this.context.isMobile?Object(j.jsxs)(Ae.b.Item,{children:[Object(j.jsx)(d.a,{justify:"center",children:i}),Object(j.jsx)(d.a,{justify:"center",children:t})]},e.hash):Object(j.jsxs)(Ae.b.Item,{children:[i,t]},e.hash)}},{key:"renderLastUpdatedTag",value:function(){if(this.props.session){var e=this.props.session.lastFetchedBtcData;if(!e)return Object(j.jsx)(Pe.a,{color:"red",children:"Never"});var t,n,s,i=Math.floor((new Date-e)/1e3);return i<60?(t="",n="seconds",s="green"):i<3600?(n=1===(t=Math.floor(i/60))?"min":"mins",s="green"):i<172800?(n=1===(t=Math.floor(i/3600))?"hour":"hours",s="orange"):(t=Math.floor(i/86400),n="days",s="red"),Object(j.jsx)(Pe.a,{color:s,children:"".concat(t," ").concat(n," ago")})}}},{key:"renderList",value:function(){var e=this,t={confirmed:this.props.session.getBtcTxs(),pending:this.props.session.getBtcTxs(!1)};return Object(j.jsxs)("div",{children:[t.pending.length>0?Object(j.jsx)(y.a,{title:Object(j.jsxs)("p",{children:[Object(j.jsx)(Le.a,{})," Pending"]}),bordered:!0,style:{margin:"0 0 30px 0"},children:Object(j.jsx)(Ae.b,{itemLayout:"horizontal",dataSource:t.pending,renderItem:function(t){return e.renderListItem(t)}})}):null,Object(j.jsx)(y.a,{title:"Transactions",bordered:!0,children:Object(j.jsx)(Ae.b,{itemLayout:"horizontal",dataSource:t.confirmed,renderItem:function(t){return e.renderListItem(t)}})})]})}},{key:"renderHeader",value:function(){var e=this.props.session.getBtcBalance()/_.constants.SATS_TO_BTC,t=this.props.session.btcPrice;return Object(j.jsxs)("div",{children:[Object(j.jsx)(d.a,{justify:"center",style:{margin:"20px 0 0 0"},children:Object(j.jsx)(Re.a,{title:"Balance",value:"".concat(e," BTC")})}),Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(Re.a,{title:"USD Value",value:e*t,precision:2})})]})}},{key:"renderPages",value:function(){var e=this,t=this.props.session.getPage(),n=this.props.session.getBtcTxs();return Object(j.jsxs)("center",{style:{margin:"20px 0 0 0"},children:[t>1?Object(j.jsx)(p.a,{onClick:function(){e.props.pageTurnCb(t-1)},children:Object(j.jsx)(Ne.a,{})}):null,n.length>=_.constants.PAGE_SIZE?Object(j.jsx)(p.a,{onClick:function(){e.props.pageTurnCb(t+1)},children:Object(j.jsx)(De.a,{})}):null]})}},{key:"renderStartCard",value:function(){var e=this;return Object(j.jsx)(y.a,{title:"BTC Wallet",bordered:!0,children:Object(j.jsxs)("center",{children:[Object(j.jsx)("p",{children:"You have not loaded any addresses yet."}),Object(j.jsx)(p.a,{size:"large",type:"primary",ghost:!0,onClick:function(){e.props.refreshData()},children:"Start"})]})})}},{key:"renderContent",value:function(){var e=this;return this.props.session.lastFetchedBtcData?Object(j.jsxs)("div",{children:[Object(j.jsxs)(y.a,{title:"BTC Wallet",bordered:!0,children:[Object(j.jsxs)(d.a,{justify:"center",children:["Last Update\xa0",this.renderLastUpdatedTag(),Object(j.jsxs)(p.a,{size:"small",type:"primary",ghost:!0,onClick:function(){e.props.refreshData()},children:["Refresh ",Object(j.jsx)(Ue.a,{})]})]}),Object(j.jsx)(d.a,{justify:"center",style:{margin:"20px 0 0 0"},children:this.renderHeader()})]}),Object(j.jsx)(Te.a,{}),Object(j.jsxs)("div",{children:[this.renderList(),this.renderPages()]})]}):this.renderStartCard()}},{key:"render",value:function(){var e=Object(j.jsx)("center",{children:this.renderContent()});return Object(j.jsx)(f,{content:e})}}]),n}(l.a.Component);We.contextType=h.a;var Me=We;function Fe(e){var t=new Date(e),n=6e4,s=60*n,i=24*s,r=7*i,a=4*r,c=12*a,o=new Date-t;return o/n<1?"seconds":o/s<1?"".concat(Math.floor(o/n)," minutes"):o/i<1?"".concat(Math.floor(o/s)," hours"):o/r<1?"".concat(Math.floor(o/i)," days"):o/a<1?"".concat(Math.floor(o/r)," weeks"):o/c<1?"".concat(Math.floor(o/a)," months"):"".concat(Math.floor(o/c)," years")}var Ge=n(365),He=n(647),Ke=n(85),Ve=n(130),Ye=n(132),ze=n(21).Buffer,Je=n(13).validateBtcAddr,qe={ETH:{full:function(e){return Xe(e,Ze)},recipient:Ze,value:Qe},BTC:{full:function(e){return Xe(e,Je)},recipient:Je,value:Qe}};function Xe(e,t){return!0===t(e.recipient)&&!0===Qe(e.value)}function Ze(e){if(""===e)return null;try{var t="0x"===e.slice(0,2),n=20===ze.from(e.slice(2),"hex").length;return!0===t&&!0===n}catch(s){return!1}}function Qe(e){if(""===e)return!1;try{var t=Number(e);return!isNaN(t)&&t>=0}catch(n){return!1}}var $e="recipient",et="value",tt=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).context=s.context,s.state={recipient:"",value:null,recipientCheck:null,valueCheck:null,error:null,isLoading:!1,txHash:null,btcFeeRate:_.constants.BTC_DEFAULT_FEE_RATE,ensResolvedAddress:null},s.handleENSResolution=s.handleENSResolution.bind(Object(v.a)(s)),s.renderBanner=s.renderBanner.bind(Object(v.a)(s)),s.renderSubmitButton=s.renderSubmitButton.bind(Object(v.a)(s)),s.renderValueLabel=s.renderValueLabel.bind(Object(v.a)(s)),s.submit=s.submit.bind(Object(v.a)(s)),s.buildBtcRequest=s.buildBtcRequest.bind(Object(v.a)(s)),s.updateBtcFeeRate=s.updateBtcFeeRate.bind(Object(v.a)(s)),s}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this;fetch("https://blockstream.info/api/fee-estimates").then((function(e){return e.json()})).then((function(t){t[1]&&e.setState({btcFeeRate:Math.ceil(Number(t[1]))}),e.props.session&&e.props.session.getBtcWalletData()})).catch((function(e){console.error("Error from fetching fee rates: ".concat(e.toString()))}))}},{key:"handleENSResolution",value:function(e,t){return e||null===t?this.setState({recipientCheck:!1,ensResolvedAddress:null}):this.setState({recipientCheck:!0,ensResolvedAddress:t})}},{key:"updateRecipient",value:function(e){var t=e.target.value,n=qe.BTC.recipient(t);this.setState({recipient:t,ensResolvedAddress:null,recipientCheck:n})}},{key:"checkValue",value:function(e){var t=this.props.session.getBtcBalance()/_.constants.SATS_TO_BTC;return""===e||null===e||void 0===e?null:Number(t)>=Number(e)}},{key:"updateValue",value:function(e){var t=e.target.value,n=Number(t),s="0"===t[0],i=s&&"."===t[1];if("0"===t);else if(isNaN(n)){if("."!==t)return;t="0"+t}else s&&!i&&(t=t.slice(1));this.setState({value:t,valueCheck:this.checkValue(t)})}},{key:"updateBtcFeeRate",value:function(e){this.setState({btcFeeRate:e})}},{key:"buildBtcRequest",value:function(){var e=Object(_.buildBtcTxReq)(this.state.recipient,this.state.value,this.props.session.btcUtxos,this.props.session.addresses.BTC,this.props.session.addresses.BTC_CHANGE,this.state.btcFeeRate,this.state.value===this.calculateMaxValue());return e.error?(this.setState({error:e.error}),null):e.data?e:(this.setState({error:"Invalid response when building BTC transaction request. "}),null)}},{key:"submit",value:function(){var e=this,t=this.buildBtcRequest();t&&(Ge.a.open({message:"Waiting for signature...",key:"signNotification",description:"We have sent the transaction to your Lattice for signing.\n                      After approval, the transaction will be broadcast.",duration:0}),this.setState({isLoading:!0}),this.props.session.sign(t,(function(t,n){Ge.a.close("signNotification"),t?e.setState({error:t,isLoading:!1,txHash:null}):e.setState({recipient:"",recipientCheck:null,value:null,valueCheck:null,txHash:n,error:null,isLoading:!1})})))}},{key:"getUrl",value:function(){return"".concat(_.constants.BTC_TX_BASE_URL,"/").concat(this.state.txHash)}},{key:"renderValueLabelTitle",value:function(){var e=this;return Object(j.jsxs)("p",{style:{textAlign:"left"},children:[Object(j.jsx)("b",{children:"Value"}),Object(j.jsx)(p.a,{type:"link",onClick:function(){e.updateValue({target:{value:e.calculateMaxValue()}})},children:"Max"}),this.renderIcon(et)]})}},{key:"renderValueLabel",value:function(){var e=Object(j.jsx)(g.a,{type:"text",id:et,value:this.state.value,onChange:this.updateValue.bind(this)});return Object(j.jsxs)(d.a,{justify:"center",children:[this.renderValueLabelTitle(),e]})}},{key:"renderRecipientLabel",value:function(){return Object(j.jsxs)(d.a,{justify:"center",children:[Object(j.jsxs)("p",{style:{textAlign:"left"},children:[Object(j.jsx)("b",{children:"Recipient"}),"\xa0\xa0\xa0",this.renderIcon($e)]}),Object(j.jsx)(g.a,{type:"text",id:$e,value:this.state.recipient,onChange:this.updateRecipient.bind(this)})]})}},{key:"renderIcon",value:function(e){var t="".concat(e,"Check"),n=this.state[t];return!0===n?Object(j.jsx)(Ve.a,{style:{color:"green"}}):!1===n?Object(j.jsx)(Ye.a,{style:{color:"red"}}):void 0}},{key:"renderBanner",value:function(){var e=this;if(this.state.error)return Object(j.jsx)(x.a,{message:"Failed to Send Transaction",description:this.state.error,type:"error",closable:!0,onClose:function(){e.setState({error:null})}});if(this.state.txHash){var t=this.context.isMobile?Object(j.jsxs)("p",{children:["Transaction signed and broadcast successfully.\xa0",Object(j.jsx)("a",{className:"lattice-a",target:"_blank",rel:"noopener noreferrer",href:this.getUrl(),children:"View"})]}):Object(j.jsx)("p",{children:"Your transaction was signed and broadcast successfully. Please return to your History tab and refresh to see status."});return Object(j.jsx)(x.a,{type:"success",message:"Success",description:t})}}},{key:"renderExtra",value:function(){return Object(j.jsxs)("div",{children:[Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)("b",{children:Object(j.jsx)("p",{children:"Fee (sat/byte):"})})}),Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(He.a,{min:1,max:100,onChange:this.updateBtcFeeRate,value:this.state.btcFeeRate})})]})}},{key:"calculateMaxValue",value:function(){var e=this.props.session.getBtcBalance(),t=this.props.session.getBtcUtxos(),n=Object(_.getBtcNumTxBytes)(t.length),s=Math.floor(this.state.btcFeeRate*n);return Math.max(((e-s)/_.constants.SATS_TO_BTC).toFixed(8),0)}},{key:"renderSubmitButton",value:function(){var e=!0===this.state.valueCheck&&(qe.BTC.full(this.state)||null!==this.state.ensResolvedAddress);return this.state.isLoading?Object(j.jsx)(p.a,{type:"primary",style:{margin:"30px 0 0 0"},loading:!0,children:"Waiting..."}):e?Object(j.jsx)(p.a,{type:"primary",onClick:this.submit,style:{margin:"30px 0 0 0"},children:"Send"}):Object(j.jsx)(p.a,{type:"primary",style:{margin:"30px 0 0 0"},disabled:!0,children:"Send"})}},{key:"renderBalance",value:function(){var e=this.props.session.getBtcBalance()/_.constants.SATS_TO_BTC;return Object(j.jsx)(d.a,{justify:"center",style:{margin:"0 0 20px 0"},children:Object(j.jsx)(Re.a,{title:"Balance",value:"".concat(e," BTC")})})}},{key:"renderCard",value:function(){return!!this.props.session.addresses.BTC&&this.props.session.addresses.BTC.length>0?Object(j.jsxs)("div",{children:[this.renderBalance(),Object(j.jsx)("div",{children:this.renderRecipientLabel()}),Object(j.jsx)("div",{style:{margin:"20px 0 0 0"},children:this.renderValueLabel()}),Object(j.jsx)("div",{style:{margin:"20px 0 0 0"},children:this.renderExtra()}),this.renderSubmitButton()]}):Object(j.jsxs)("div",{children:[Object(j.jsx)("p",{children:"No addresses found from your Lattice. If you have your wallet setup, please try logging out and reconnecting."}),Object(j.jsx)(Ke.a,{image:Ke.a.PRESENTED_IMAGE_SIMPLE})]})}},{key:"render",value:function(){var e=Object(j.jsxs)("center",{children:[this.renderBanner(),Object(j.jsx)(y.a,{title:"Send BTC",bordered:!0,children:this.renderCard()})]});return Object(j.jsx)(f,{content:e})}}]),n}(l.a.Component);tt.contextType=h.a;var nt=tt,st=n(662),it=n(366),rt=g.a.Search,at=g.a.TextArea,ct="address-data",ot=function(e){Object(a.a)(n,e);var t=Object(c.a)(n);function n(e){var s,r;return Object(i.a)(this,n),(r=t.call(this,e)).context=r.context,r.state={address:null,windowWidth:null===(s=document.getElementById("main-content-inner"))||void 0===s?void 0:s.offsetWidth},r.updateWidth=r.updateWidth.bind(Object(v.a)(r)),r}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.updateDisplayAddress(),this.props.session&&this.props.session.getBtcWalletData(),window.addEventListener("resize",this.updateWidth)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWidth)}},{key:"updateWidth",value:function(){var e;this.setState({windowWidth:null===(e=document.getElementById("main-content-inner"))||void 0===e?void 0:e.offsetWidth})}},{key:"updateDisplayAddress",value:function(){var e=this.props.session.getBtcDisplayAddress();e&&this.setState({address:e})}},{key:"copyAddress",value:function(){document.getElementById(ct).select(),document.execCommand("copy")}},{key:"renderAddrBox",value:function(){return this.context.isMobile?Object(j.jsxs)("div",{children:[Object(j.jsx)(at,{id:ct,value:this.state.address,autoSize:{minRows:1,maxRows:3},style:{margin:"30px 0 0 0",textAlign:"center"}}),Object(j.jsxs)(p.a,{type:"primary",style:{margin:"20px 0 0 0"},onClick:this.copyAddress,children:["Copy ",Object(j.jsx)(st.a,{})]})]}):Object(j.jsx)(rt,{type:"text",id:ct,value:this.state.address,enterButton:Object(j.jsx)(st.a,{}),onSearch:this.copyAddress,style:{margin:"30px 0 0 0",textAlign:"center"}})}},{key:"renderCard",value:function(){if(this.state.address){var e;if(!Object(_.validateBtcAddr)(this.state.address))return;var t=null===(e=document.getElementById("receive-card"))||void 0===e?void 0:e.offsetWidth,n=Math.min(300,.8*t);return Object(j.jsxs)("div",{children:[Object(j.jsx)(d.a,{justify:"center",children:Object(j.jsx)(it.a,{value:this.state.address,size:n,style:{margin:"30px 0 0 0"}})}),Object(j.jsx)(d.a,{justify:"center",children:this.renderAddrBox()})]})}return Object(j.jsxs)("div",{children:[Object(j.jsx)("p",{children:"No addresses found"}),Object(j.jsx)(Ke.a,{image:Ke.a.PRESENTED_IMAGE_SIMPLE})]})}},{key:"render",value:function(){var e=Object(j.jsx)("center",{children:Object(j.jsx)(y.a,{title:"Receive BTC",bordered:!0,id:"receive-card",children:Object(j.jsx)("center",{children:this.renderCard()})})});return Object(j.jsx)(f,{content:e})}}]),n}(l.a.Component);ot.contextType=h.a;var lt=ot},629:function(e,t,n){"use strict";n.r(t);n(0),n(51);var s=n(49),i=n(38),r=n(4);var a=function(){return Object(r.jsx)("div",{className:"App",children:Object(r.jsx)(i.b,{children:Object(r.jsx)(s.f,{})})})},c=n(357),o=document.getElementById("root");Object(c.createRoot)(o).render(Object(r.jsx)(a,{}))}},[[629,1,2]]]);
//# sourceMappingURL=main.f8df03fc.chunk.js.map